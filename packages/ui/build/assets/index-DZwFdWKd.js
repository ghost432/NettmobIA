import{af as ve,s as re,t as oe,r,f as O,v as We,H as ee,j as e,D as G,m as Ce,aL as Se,n as Y,B as _,o as U,a5 as se,p as Ie,q as b,aa as Ae,w as Ee,au as M,i as I,bi as L,bl as Te,L as ne,N as ie,P,u as Ne,a as ce,b as Be,c as H,bm as Me,M as Oe,S as z,e as Ue,Q as le,R as de,U as pe,V as he,W as K,_ as B,X as xe,b8 as te,av as Re,C as $,b6 as Pe,h as q,a0 as ae,Y as ze,bn as Le,a_ as _e,ae as S}from"./index-B5bgjFPS.js";import{m as Fe}from"./moment-BDbvUjbq.js";import{E as Ve}from"./ErrorBoundary-x4bZaoHs.js";import{V as $e}from"./ViewHeader-t5dVj9Vk.js";import{C as ue,u as qe}from"./ConfirmDialog-Dfe34hOz.js";import{S as X,a as o}from"./TableStyles-gXDYNr-F.js";import{I as Ge}from"./IconPlus-j8jP5X4Z.js";import{S as w}from"./Skeleton-DJP3nnUt.js";import{I as Ye}from"./IconEyeOff-CPUbKGOq.js";import{I as He}from"./IconEye-Ci4p6xvE.js";import{I as Ke}from"./IconSearch-4bUU90FL.js";import{I as Xe}from"./IconTrash-CekgWF9B.js";import"./IconCopy-bbAsun7S.js";import"./StyledFab-DFomU4Vk.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M3 3l18 18",key:"svg-0"}],["path",{d:"M4 7h3m4 0h9",key:"svg-1"}],["path",{d:"M10 11l0 6",key:"svg-2"}],["path",{d:"M14 14l0 3",key:"svg-3"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l.077 -.923",key:"svg-4"}],["path",{d:"M18.384 14.373l.616 -7.373",key:"svg-5"}],["path",{d:"M9 5v-1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-6"}]],Qe=ve("outline","trash-off","TrashOff",Je),me=({show:s,dialogProps:i,onCancel:y,onConfirm:c})=>{const v=document.getElementById("portal"),d=re();oe();const h=(...a)=>d(ne(...a)),x=(...a)=>d(ie(...a)),[m,p]=r.useState(""),[u,g]=r.useState(""),[W,n]=r.useState("ADD"),[D,T]=r.useState({}),C=O(a=>a.auth.user);r.useEffect(()=>(i.type==="EDIT"&&i.data?(p(i.data.name),g(i.data.description),n("EDIT"),T(i.data)):i.type==="ADD"&&(p(""),g(""),n("ADD"),T({})),()=>{p(""),g(""),n("ADD"),T({})}),[i]),r.useEffect(()=>(d(s?{type:We}:{type:ee}),()=>d({type:ee})),[s,d]);const A=async()=>{if(m==="Default Workspace"||m==="Personal Workspace"){h({message:"Workspace name cannot be Default Workspace or Personal Workspace - this is a reserved name",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(b,{style:{color:"white"},onClick:()=>x(a),children:e.jsx(I,{})})}});return}try{const a={name:m,description:u,createdBy:C.id,organizationId:C.activeOrganizationId,existingWorkspaceId:C.activeWorkspaceId},l=await M.createWorkspace(a);l.data&&(h({message:"New Workspace added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:N=>e.jsx(b,{style:{color:"white"},onClick:()=>x(N),children:e.jsx(I,{})})}}),c(l.data.id))}catch(a){h({message:`Failed to add new Workspace: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:l=>e.jsx(b,{style:{color:"white"},onClick:()=>x(l),children:e.jsx(I,{})})}}),y()}},F=async()=>{try{const a={id:D.id,name:m,description:u,updatedBy:C.id},l=await M.updateWorkspace(a);l.data&&(L.dispatch(Te(l.data)),h({message:"Workspace saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:N=>e.jsx(b,{style:{color:"white"},onClick:()=>x(N),children:e.jsx(I,{})})}}),c())}catch(a){h({message:`Failed to save Workspace: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:l=>e.jsx(b,{style:{color:"white"},onClick:()=>x(l),children:e.jsx(I,{})})}}),y()}},R=s?e.jsxs(G,{fullWidth:!0,maxWidth:"sm",open:s,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ce,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Se,{style:{marginRight:"10px"}}),i.type==="ADD"?"Add Workspace":"Edit Workspace"]})}),e.jsxs(Y,{children:[e.jsxs(_,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(U,{children:["Name",e.jsx("span",{style:{color:"red"},children:"Â *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(se,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,onChange:a=>p(a.target.value),value:m??""},"workspaceName")]}),e.jsxs(_,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx(U,{children:"Description"}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(se,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,multiline:!0,rows:4,onChange:a=>g(a.target.value),value:u??""},"workspaceDescription")]})]}),e.jsxs(Ie,{children:[e.jsx(b,{onClick:()=>y(),children:i.cancelButtonName}),e.jsx(Ae,{disabled:!m,variant:"contained",onClick:()=>W==="ADD"?A():F(),children:i.confirmButtonName})]}),e.jsx(ue,{})]}):null;return Ee.createPortal(R,v)};me.propTypes={show:P.bool,dialogProps:P.object,onCancel:P.func,onConfirm:P.func};const Ze="/assets/workspaces_empty-Bc1rx9Ju.svg";function ke(s){var W;const i=O(n=>n.customization),y=O(n=>n.auth.user),[c,v]=r.useState(!1),[d,h]=r.useState(""),[x,m]=r.useState([]),p=ce(),u=H(Re.getAllUsersByWorkspaceId),g=n=>{v(!c),h(n)};return r.useEffect(()=>{u.data&&m(u.data)},[u.data]),r.useEffect(()=>{c&&d?u.request(d):(v(!1),h(""))},[c]),e.jsxs(r.Fragment,{children:[e.jsxs(X,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsxs(o,{component:"th",scope:"row",children:[s.workspace.name,y.activeWorkspaceId===s.workspace.id&&e.jsx($,{sx:{ml:2,my:"auto",width:"max-content",background:p.palette.teal.main,color:"white"},label:"Active"})]}),e.jsx(o,{style:{wordWrap:"break-word",flexWrap:"wrap",width:"30%"},children:Pe(((W=s.workspace)==null?void 0:W.description)||"",200)}),e.jsxs(o,{sx:{textAlign:"center"},children:[s.workspace.userCount," ",s.workspace.userCount>0&&e.jsx(q,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>g(s.workspace.id),children:s.workspace.userCount>0&&c?e.jsx(Ye,{}):e.jsx(He,{})})]}),e.jsx(o,{children:Fe(s.workspace.updatedDate).format("MMMM Do YYYY, hh:mm A")}),e.jsxs(o,{children:[s.workspace.name!=="Default Workspace"&&e.jsx(ae,{permissionId:"workspace:update",title:"Edit",color:"primary",onClick:()=>s.onEditClick(s.workspace),children:e.jsx(Ke,{})}),e.jsx(ze,{to:`/workspace-users/${s.workspace.id}`,children:e.jsx(q,{title:"Workspace Users",color:"primary",children:e.jsx(Le,{})})}),s.workspace.name!=="Default Workspace"&&(s.workspace.userCount>1||s.workspace.isOrgDefault===!0?e.jsx(q,{title:"Delete",disabled:!0,color:"error",onClick:()=>s.onDeleteClick(s.workspace),children:e.jsx(Qe,{})}):e.jsx(ae,{permissionId:"workspace:delete",title:"Delete",color:"error",onClick:()=>s.onDeleteClick(s.workspace),children:e.jsx(Xe,{})}))]})]}),e.jsx(_e,{anchor:"right",open:c,onClose:()=>v(!1),sx:{minWidth:320},children:e.jsxs(_,{sx:{p:4,height:"auto",width:650},children:[e.jsx(U,{sx:{textAlign:"left",mb:2},variant:"h2",children:"Users"}),e.jsx(le,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:p.palette.grey[900]+25,borderRadius:2},component:de,children:e.jsxs(pe,{"aria-label":"workspace users table",children:[e.jsx(he,{sx:{backgroundColor:i.isDarkMode?p.palette.common.black:p.palette.grey[100],height:56},children:e.jsxs(K,{children:[e.jsx(o,{sx:{width:"60%"},children:"User"}),e.jsx(o,{sx:{width:"40%"},children:"Role"})]})}),e.jsx(xe,{children:x&&x.length>0&&x.map((n,D)=>e.jsxs(K,{children:[e.jsx(o,{children:n.user.name||n.user.email}),e.jsx(o,{children:n.isOrgOwner?e.jsx($,{label:"ORGANIZATION OWNER",size:"small"}):n.role.name==="personal workspace"?e.jsx($,{label:"PERSONAL WORKSPACE",size:"small"}):n.role.name})]},D))})]})})]})})]},s.rowKey)}ke.propTypes={rowKey:S.any,workspace:S.any,onEditClick:S.func,onDeleteClick:S.func,onViewUsersClick:S.func,open:S.bool,theme:S.any};const us=()=>{const s=Ne(),i=ce(),{confirm:y}=qe(),c=O(t=>t.auth.user),v=O(t=>t.customization);oe();const d=(...t)=>p(ne(...t)),h=(...t)=>p(ie(...t)),[x,m]=r.useState(""),p=re(),{error:u,setError:g}=Be(),[W,n]=r.useState(!0),[D,T]=r.useState([]),[C,A]=r.useState(!1),[F,R]=r.useState({}),[a,l]=r.useState(!1),[N,J]=r.useState(!1),k=H(M.getAllWorkspacesByOrganizationId),E=H(M.switchWorkspace),je=t=>{s(`/workspace-users/${t.id}`)},fe=t=>{m(t.target.value)},we=()=>{R({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",data:{}}),A(!0)},ge=t=>{R({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",data:t}),A(!0)},ye=async t=>{const j={title:`Delete Workspace ${t.name}`,description:"This is irreversible and will remove all associated data inside the workspace. Are you sure you want to delete?",confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await y(j)){J(!0);try{const f=t.id;(await M.deleteWorkspace(f)).data&&(d({message:"Workspace deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:be=>e.jsx(b,{style:{color:"white"},onClick:()=>h(be),children:e.jsx(I,{})})}}),Q(f,!0))}catch(f){console.error("Failed to delete workspace:",f),d({message:`Failed to delete workspace: ${typeof f.response.data=="object"?f.response.data.message:f.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Z=>e.jsx(b,{style:{color:"white"},onClick:()=>h(Z),children:e.jsx(I,{})})}})}finally{J(!1)}}},Q=(t,j)=>{if(A(!1),k.request(c.activeOrganizationId),!(c.assignedWorkspaces.length===0||D.length===0))if(j&&c.activeWorkspaceId===t){l(!0);const f=D[0].id;E.request(f)}else!j&&t&&(l(!0),E.request(t))};function De(t){return t.name.toLowerCase().indexOf(x.toLowerCase())>-1}return r.useEffect(()=>{if(E.data){l(!1);const t=new Promise(j=>{const V=L.subscribe(()=>{L.getState().auth.user.activeWorkspaceId===E.data.activeWorkspaceId&&(V(),j())})});L.dispatch(Me(E.data)),t.then(()=>{s("/",{replace:!0}),s(0)})}},[E.data,s]),r.useEffect(()=>{k.data&&T(k.data)},[k.data]),r.useEffect(()=>{n(k.loading)},[k.loading]),r.useEffect(()=>{k.error&&g(k.error)},[k.error,g]),r.useEffect(()=>{k.request(c.activeOrganizationId)},[]),e.jsxs(e.Fragment,{children:[e.jsx(Oe,{children:u?e.jsx(Ve,{error:u}):e.jsxs(z,{flexDirection:"column",sx:{gap:3},children:[e.jsx($e,{isBackButton:!1,isEditButton:!1,onSearchChange:fe,search:!0,title:"Workspaces",searchPlaceholder:"Search Workspaces",children:e.jsx(Ue,{permissionId:"workspace:create",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:we,startIcon:e.jsx(Ge,{}),children:"Add New"})}),!W&&D.length<=0?e.jsxs(z,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(_,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:Ze,alt:"workspaces_emptySVG"})}),e.jsx("div",{children:"No Workspaces Yet"})]}):e.jsx(le,{sx:{border:1,borderColor:i.palette.grey[900]+25,borderRadius:2},component:de,children:e.jsxs(pe,{sx:{minWidth:650},children:[e.jsx(he,{sx:{backgroundColor:v.isDarkMode?i.palette.common.black:i.palette.grey[100],height:56},children:e.jsxs(K,{children:[e.jsx(B,{children:"Name"}),e.jsx(B,{children:"Description"}),e.jsx(B,{children:"Users"}),e.jsx(B,{children:"Last Updated"}),e.jsx(B,{children:" "})]})}),e.jsx(xe,{children:W?e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})})]}),e.jsxs(X,{children:[e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:D.filter(De).map((t,j)=>e.jsx(ke,{workspace:t,rowKey:j,onEditClick:ge,onDeleteClick:ye,onViewUsersClick:je},j))})})]})})]})}),C&&e.jsx(me,{show:C,dialogProps:F,onCancel:()=>A(!1),onConfirm:Q}),e.jsx(ue,{}),e.jsx(G,{open:a,PaperProps:{style:{backgroundColor:"transparent",boxShadow:"none"}},children:e.jsx(Y,{children:e.jsxs(z,{spacing:2,alignItems:"center",children:[e.jsx(te,{}),e.jsx(U,{variant:"body1",style:{color:"white"},children:"Switching workspace..."})]})})}),e.jsx(G,{open:N,PaperProps:{style:{backgroundColor:"transparent",boxShadow:"none"}},children:e.jsx(Y,{children:e.jsxs(z,{spacing:2,alignItems:"center",children:[e.jsx(te,{}),e.jsx(U,{variant:"body1",style:{color:"white"},children:"Deleting workspace..."})]})})})]})};export{us as default};
