import{af as W,b4 as q,a as ce,f as le,s as de,t as he,b as xe,r as a,c as ue,j as e,M as pe,S as P,B as ge,a1 as je,a2 as me,a3 as k,a4 as ye,a5 as fe,h as E,ac as ve,Q as be,R as Se,U as we,V as ke,W as Ce,X as De,bk as Ie,aB as Re,q as B,i as F,L as Le,N as Me,P as U}from"./index-B5bgjFPS.js";import{m as Ae}from"./moment-BDbvUjbq.js";import{u as Te,C as Pe}from"./ConfirmDialog-Dfe34hOz.js";import{V as Ee}from"./ViewHeader-t5dVj9Vk.js";import{E as Be}from"./ErrorBoundary-x4bZaoHs.js";import{a as s,S as C}from"./TableStyles-gXDYNr-F.js";import{e as N}from"./react-datepicker-B1KQuNsR.js";import{F as Fe}from"./FormControl-o0rphY-g.js";import{I as Ue}from"./InputLabel-BtU13bbu.js";import{I as Ne}from"./IconChevronLeft-DxxY-T-U.js";import{I as ze}from"./IconChevronRight-D55BXkrb.js";import{I as We}from"./IconTrash-CekgWF9B.js";import{S as r}from"./Skeleton-DJP3nnUt.js";import"./StyledFab-DFomU4Vk.js";import"./IconSearch-4bUU90FL.js";import"./IconCopy-bbAsun7S.js";import"./toPropertyKey-C9c9JG92.js";import"./unsupportedIterableToArray-Bh0GkvIo.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M10 10l4 4m0 -4l-4 4",key:"svg-1"}]],Oe=W("outline","circle-x","CircleX",qe);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M15 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M21 12h-13l3 -3",key:"svg-1"}],["path",{d:"M11 15l-3 -3",key:"svg-2"}]],Ve=W("outline","login","Login",$e),He=l=>q.post("/audit/login-activity",l),Xe=l=>q.post("/audit/login-activity/delete",l),z={fetchLoginActivity:He,deleteLoginActivity:Xe},Ye=["Login Success","Logout Success","Unknown User","Incorrect Credential","User Disabled","No Assigned Workspace","Unknown Activity"],_e={PaperProps:{style:{width:160}}},Qe={"& .MuiOutlinedInput-notchedOutline":{borderRadius:2}},D=a.forwardRef(function({value:p,onClick:m},y){return e.jsx(Re,{style:{borderRadius:15,border:"1px solid #e0e0e0"},onClick:m,ref:y,children:p})});D.propTypes={value:U.string,onClick:U.func};const pt=()=>{const l=ce(),p=le(t=>t.customization),m=de();he();const{error:y,setError:I}=xe(),R=(...t)=>m(Le(...t)),L=(...t)=>m(Me(...t)),[O,S]=a.useState(!0),{confirm:$}=Te(),d=ue(z.fetchLoginActivity),[w,V]=a.useState([]),[g,H]=a.useState([]),[j,X]=a.useState(0),[h,M]=a.useState(1),[Y,_]=a.useState(1),[f,Q]=a.useState(50),[x,G]=a.useState(new Date(new Date().setMonth(new Date().getMonth()-1))),[u,J]=a.useState(new Date),[o,v]=a.useState([]),K=t=>{G(t),b(h,t,u,g)},Z=t=>{J(t),b(h,x,t,g)},ee=t=>{if(t.target.checked){const c=w.map(i=>i.id);v(c);return}v([])},te=(t,c)=>{const i=o.indexOf(c);let n=[];i===-1?n=n.concat(o,c):i===0?n=n.concat(o.slice(1)):i===o.length-1?n=n.concat(o.slice(0,-1)):i>0&&(n=n.concat(o.slice(0,i),o.slice(i+1))),v(n)},b=(t,c,i,n)=>{const T=[];n.length>0&&n.forEach(oe=>{T.push(ne(oe))}),d.request({pageNo:t,startDate:c,endDate:i,activityCodes:T})},A=t=>{S(!0),M(t),b(t,x,u,g)},se=t=>{const{target:{value:c}}=t;let i=typeof c=="string"?c.split(","):c;H(i),b(h,x,u,i)};function ie(t){switch(t){case 0:return"Login Success";case 1:return"Logout Success";case-1:return"Unknown User";case-2:return"Incorrect Credential";case-3:return"User Disabled";case-4:return"No Assigned Workspace";default:return"Unknown Activity"}}function ne(t){switch(t){case"Login Success":return 0;case"Logout Success":return 1;case"Unknown User":return-1;case"Incorrect Credential":return-2;case"User Disabled":return-3;case"No Assigned Workspace":return-4;default:return-99}}const re=async()=>{const t={title:"Delete",description:`Delete ${o.length} ${o.length>1?"records":"record"}? `,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await $(t))try{(await z.deleteLoginActivity({selected:o})).data&&(R({message:o.length+" Login Activity Records Deleted Successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:n=>e.jsx(B,{style:{color:"white"},onClick:()=>L(n),children:e.jsx(F,{})})}}),ae())}catch(i){R({message:`Failed to delete records: ${typeof i.response.data=="object"?i.response.data.message:i.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:n=>e.jsx(B,{style:{color:"white"},onClick:()=>L(n),children:e.jsx(F,{})})}})}},ae=()=>{d.request()};return a.useEffect(()=>{d.request({pageNo:1})},[]),a.useEffect(()=>{S(d.loading)},[d.loading]),a.useEffect(()=>{d.error&&I(d.error)},[d.error,I]),a.useEffect(()=>{if(d.data){const t=d.data;X(t.count),S(!1),M(t.currentPage),_(t.currentPage*t.pageSize-(t.pageSize-1)),Q(t.currentPage*t.pageSize>t.count?t.count:t.currentPage*t.pageSize),V(t.data),v([])}},[d.data]),e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:y?e.jsx(Be,{error:y}):e.jsxs(P,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Ee,{search:!1,title:"Login Activity"}),e.jsx(P,{flexDirection:"row",children:e.jsxs(ge,{sx:{p:2,height:"auto",width:"100%"},children:[e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",overflow:"hidden",marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"From: "}),e.jsx(N,{selected:x,onChange:t=>K(t),selectsStart:!0,startDate:x,endDate:u,customInput:e.jsx(D,{})})]}),e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"To: "}),e.jsx(N,{selected:u,onChange:t=>Z(t),selectsEnd:!0,startDate:x,endDate:u,minDate:x,maxDate:new Date,customInput:e.jsx(D,{})})]}),e.jsx("div",{children:e.jsxs(Fe,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:300,maxWidth:300},children:[e.jsx(Ue,{size:"small",id:"type-label",children:"Filter By"}),e.jsx(je,{size:"small",labelId:"type-label",multiple:!0,value:g,onChange:se,id:"type-checkbox",input:e.jsx(fe,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:_e,sx:Qe,children:Ye.map(t=>e.jsxs(me,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(k,{checked:g.indexOf(t)>-1,sx:{p:0}}),e.jsx(ye,{primary:t})]},t))})]})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs("div",{style:{marginRight:10,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(E,{size:"small",onClick:()=>A(h-1),style:{marginRight:10},variant:"outlined",disabled:h===1,children:e.jsx(Ne,{color:p.isDarkMode?h===1?"#616161":"white":h===1?"#e0e0e0":"black"})}),"Showing ",Math.min(Y,j),"-",f," of ",j," Records",e.jsx(E,{size:"small",onClick:()=>A(h+1),style:{marginLeft:10},variant:"outlined",disabled:f>=j,children:e.jsx(ze,{color:p.isDarkMode?f>=j?"#616161":"white":f>=j?"#e0e0e0":"black"})})]}),e.jsx(ve,{permissionId:"loginActivity:delete",sx:{mt:1,mb:2},variant:"outlined",disabled:o.length===0,onClick:re,color:"error",startIcon:e.jsx(We,{}),children:"Delete Selected"})]})]}),e.jsx(be,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},component:Se,children:e.jsxs(we,{sx:{minWidth:650},"aria-label":"users table",children:[e.jsx(ke,{sx:{backgroundColor:p.isDarkMode?l.palette.common.black:l.palette.grey[100],height:40},children:e.jsxs(Ce,{children:[e.jsx(s,{style:{width:"5%"},children:e.jsx(k,{color:"primary",checked:o.length===(w||[]).length,onChange:ee})}),e.jsx(s,{children:"Activity"}),e.jsx(s,{children:"User"}),e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Method"}),e.jsx(s,{children:"Message"})]})}),e.jsx(De,{children:O?e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})})]}),e.jsxs(C,{children:[e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:w.map((t,c)=>e.jsxs(C,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{component:"th",scope:"row",style:{width:"5%"},children:e.jsx(k,{color:"primary",checked:o.indexOf(t.id)!==-1,onChange:i=>te(i,t.id)})}),e.jsx(s,{component:"th",scope:"row",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"left"},children:[e.jsxs("div",{style:{width:25,height:25,borderRadius:"50%",marginRight:10},children:[t.activityCode===0&&e.jsx(Ve,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain",color:l.palette.success.dark}}),t.activityCode===1&&e.jsx(Ie,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain",color:l.palette.secondary.dark}}),t.activityCode<0&&e.jsx(Oe,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain",color:l.palette.error.dark}})]}),e.jsx("div",{children:ie(t.activityCode)})]})}),e.jsx(s,{children:t.username}),e.jsx(s,{children:Ae(t.attemptedDateTime).format("MMMM Do, YYYY, HH:mm")}),e.jsx(s,{children:t.loginMode?t.loginMode:"Email/Password"}),e.jsx(s,{children:t.message})]},c))})})]})})]})})]})}),e.jsx(Pe,{})]})};export{pt as default};
