import{af as Ae,a as De,t as Ye,c as W,r,j as e,D as ht,m as ut,n as mt,S as Z,E as Fe,o as v,C as A,B as D,a5 as Ie,a8 as xt,aE as ft,a3 as ee,p as gt,h as ue,q as Q,aa as vt,w as jt,P as ge,f as pt,s as Ve,b as bt,M as wt,T as yt,e as ze,Q as Ct,R as St,U as We,V as qe,W as he,_ as y,X as Je,L as Ue,i as me,u as Et,az as Be,aF as kt,ad as At,N as Ge,ae as X}from"./index-B5bgjFPS.js";import{m as je}from"./moment-BDbvUjbq.js";import{e as ve}from"./evaluations-HmLULvFK.js";import{C as He,u as Xe}from"./ConfirmDialog-Dfe34hOz.js";import{B as Dt}from"./BackdropLoader-Ch3nVEPr.js";import{E as Nt}from"./ErrorBoundary-x4bZaoHs.js";import{V as Mt}from"./ViewHeader-t5dVj9Vk.js";import{S as ke,a as d}from"./TableStyles-gXDYNr-F.js";import{D as Ce}from"./Dropdown-D8Rr64ju.js";import{C as Lt}from"./CredentialInputHandler-C4W2GUgN.js";import{T as Rt}from"./TooltipWithParser-D26Faoyy.js";import{M as Se}from"./MultiDropdown-BUXEvYds.js";import{c as Oe}from"./chatflows-CbGmw0-v.js";import{d as _t}from"./dataset-DMHJH1v5.js";import{e as Tt,I as Pt}from"./evaluators-DeqtpQ_m.js";import{n as $e}from"./nodes-Qb-8otVq.js";import{a as Ft}from"./assistants-DZYxhrU8.js";import{e as It}from"./evaluatorConstant-DqyckRrE.js";import{I as zt}from"./IconAlertTriangle-7YQ2ldQl.js";import{D as Bt}from"./DialogContentText-BpMKEgw2.js";import{a as Ot}from"./IconSearch-4bUU90FL.js";import{S as $t,a as Yt,b as Vt}from"./Stepper-BCbMjc86.js";import{D as Wt,T as qt}from"./TablePagination-DXVFzOgw.js";import{I as Jt}from"./IconRefresh-CtZoTUkg.js";import{I as Ut}from"./IconPlus-j8jP5X4Z.js";import{I as Qe}from"./IconTrash-CekgWF9B.js";import{S as k}from"./Skeleton-DJP3nnUt.js";import{I as Gt,a as Ht}from"./IconChevronsUp-DG3lzKhL.js";import"./IconCopy-bbAsun7S.js";import"./StyledFab-DFomU4Vk.js";import"./FormControl-o0rphY-g.js";import"./Autocomplete-CinIIKT5.js";import"./Close-DT9tpzn1.js";import"./TextField-OmGdqrIf.js";import"./InputLabel-BtU13bbu.js";import"./CredentialListDialog-ZkUPpHPz.js";import"./Input-CajAyvOv.js";import"./ListItem-BfStHUI0.js";import"./Switch-D5M093wC.js";import"./main-Dw2W3SKo.js";import"./IconArrowsMaximize-BLCViMbK.js";import"./InputAdornment-v58Edx4J.js";import"./Tooltip-CXmeiPEa.js";import"./index-D--Rb2MU.js";import"./Pagination-BU6C4W3P.js";import"./LastPage--XaxDP-k.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=[["path",{d:"M3 13a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M15 9a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M9 5a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20h14",key:"svg-3"}]],Qt=Ae("outline","chart-bar","ChartBar",Xt);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=[["path",{d:"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}]],Zt=Ae("outline","player-pause","PlayerPause",Kt);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]],ta=Ae("outline","player-play","PlayerPlay",ea),Ee=["Datasets","Evaluators","LLM Graded Metrics"],Ke=({show:l,dialogProps:P,onCancel:te,onConfirm:F})=>{var Le,Re;const ae=document.getElementById("portal"),x=De();Ye();const N=W(Oe.getAllChatflows),j=W(Oe.getAllAgentflows),C=W(_t.getAllDatasets),I=W(Tt.getAllEvaluators),L=W($e.getNodesByCategory),O=W($e.executeNodeLoadMethod),q=W(Ft.getAllAssistants),[S,J]=r.useState([]),[z,B]=r.useState(""),[$,K]=r.useState(!1),[u,R]=r.useState([]),[b,se]=r.useState([]),[_,ne]=r.useState([]),[E,T]=r.useState(""),[Y,U]=r.useState(""),[le,G]=r.useState([]),[re,n]=r.useState([]),[w,f]=r.useState([]),[g,M]=r.useState([]),[m,a]=r.useState(0),[o,s]=r.useState(!1),[p,oe]=r.useState(!1),[ie,et]=r.useState([]),[H,xe]=r.useState("no_grading"),[pe,tt]=r.useState([]),[de,ce]=r.useState("");r.useEffect(()=>{if(P.type==="NEW"&&P.data){const t=P.data,i=[];JSON.parse(t.chatflowId).map(c=>{i.push(c)}),J(i),B(t.datasetId),T(""),ce(""),xe("no_grading"),U(""),f([]),M([]),a(0),s(!1),T("")}else Ne();return()=>{Ne()}},[P]);const Ne=()=>{B(""),T(""),U(""),f([]),M([]),a(0),J([]),ce(""),xe("no_grading"),s(!1),K(!1)},at=()=>m===0?Y&&z&&S.length>0:m===1?!0:m===2?o?E&&H&&de:!0:!1,be=async t=>{const i=at();oe(!i),i&&(t===Ee.length-1?nt():a(c=>c+1))},st=async()=>{a(t=>t-1)},nt=async()=>{var _e,Te,Pe;const t=JSON.parse(S),i=[];for(let V=0;V<t.length;V+=1)i.push((_e=b.find(ye=>ye.name===t[V]))==null?void 0:_e.label);const c=[];for(let V=0;V<t.length;V+=1)c.push((Te=b.find(ye=>ye.name===t[V]))==null?void 0:Te.type);const h=JSON.stringify(i),fe=(Pe=_.find(V=>V.name===z))==null?void 0:Pe.label,dt={name:Y,evaluationType:E?"llm":"benchmarking",credentialId:E,datasetId:z,datasetName:fe,chatflowId:S,chatflowName:h,chatflowType:JSON.stringify(c),selectedSimpleEvaluators:w,selectedLLMEvaluators:g,model:de,llm:H,datasetAsOneConversation:$};F(dt)},lt=()=>{var t;if(m===0)return!Y||!z||S.length===0;if(m===2)return!!(o&&(!de||!H||g.length===0||(t=ie.find(i=>i.name===H))!=null&&t.credential&&!E))},rt=()=>e.jsx(D,{sx:{width:"100%"},children:e.jsx($t,{activeStep:m,alternativeLabel:!0,children:Ee.map(t=>e.jsx(Yt,{children:e.jsx(Vt,{children:t})},t))})});r.useEffect(()=>{L.request("Chat Models"),b.length===0&&(N.request(),q.request("CUSTOM"),j.request("AGENTFLOW")),_.length===0&&C.request(),I.request()},[]),r.useEffect(()=>{if(j.data&&N.data&&q.data)try{const t=Me(j.data,"Agentflow v2"),i=Me(N.data,"Chatflow"),c=it(q.data);se([...t,...i,...c]),R(["Agentflow v2","Chatflow","Custom Assistant"])}catch(t){console.error(t)}},[j.data,N.data,q.data]),r.useEffect(()=>{if(L.data){const t=[];try{const i=L.data;t.push({label:"No Grading",name:"no_grading",credential:{}});for(let c=0;c<i.length;c+=1){const h=i[c];(!h.tags||!h.tags.indexOf("[LlamaIndex]")===-1)&&t.push({label:h.label,name:h.name,credential:h.credential})}et(t),xe("no_grading"),ce(""),T("")}catch(i){console.error(i)}}},[L.data]),r.useEffect(()=>{if(O.data)try{const t=O.data;tt(t)}catch(t){console.error(t)}},[O.data]),r.useEffect(()=>{if(I.data)try{const t=[],i=[];for(let c=0;c<I.data.length;c+=1){const h=I.data[c];h.label=h.name,h.name=h.id,h.type==="llm"?i.push(h):t.push(h)}G(t),n(i)}catch(t){console.error(t)}},[I.data]),r.useEffect(()=>{if(C.data)try{const t=C.data;let i=[];for(let c=0;c<t.length;c+=1){const h=t[c];i.push({label:h.name,name:h.id})}ne(i)}catch(t){console.error(t)}},[C.data]);const ot=t=>{s(t!=="no_grading"),xe(t),ce(""),T(""),t!=="no_grading"&&O.request(t,{loadMethod:"listModels"})},we=t=>{const i=t.target.checked,c=t.target.value;R(i?[...u,c]:u.filter(h=>h!==c))},Me=(t,i)=>{let c=[];for(let h=0;h<t.length;h+=1){const fe=t[h];c.push({label:fe.name,name:fe.id,type:i,description:i})}return c},it=t=>{let i=[];for(let c=0;c<t.length;c+=1){const h=t[c];i.push({label:JSON.parse(h.details).name||"",name:h.id,type:"Custom Assistant",description:"Custom Assistant"})}return i},ct=l?e.jsxs(ht,{fullWidth:!0,maxWidth:"md",open:l,onClose:te,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ut,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Pt,{style:{marginRight:"10px"}}),"Start New Evaluation"]})}),e.jsx(mt,{children:e.jsxs(Z,{direction:"column",spacing:2,children:[e.jsx(Fe,{}),p&&e.jsxs("div",{style:{display:"flex",minHeight:40,flexDirection:"row",alignItems:"center",backgroundColor:"lightcoral",color:"white",padding:10},children:[e.jsx("div",{style:{width:25,height:25,marginRight:10,borderRadius:"50%"},children:e.jsx(zt,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain"}})}),"Fill all the mandatory fields"]}),e.jsx(rt,{}),e.jsxs(Bt,{align:"center",children:[m===0&&e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mt:2},variant:"h4",children:"Select dataset to be tested on flows"}),e.jsxs(v,{sx:{mt:2},variant:"body2",children:["Uses the ",e.jsx("span",{style:{fontStyle:"italic"},children:"input"})," column from the dataset to execute selected Chatflow(s), and compares the results with the output column."]}),e.jsx(v,{variant:"body2",children:"The following metrics will be computed:"}),e.jsx(Z,{flexDirection:"row",sx:{mt:2,gap:1,alignItems:"center",justifyContent:"center",flexWrap:"wrap"},children:It.filter(t=>t.type==="numeric"&&t.name!=="chain").map((t,i)=>e.jsx(A,{variant:"outlined",label:t.label},i))})]}),m===1&&e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mt:2},variant:"h4",children:"Unit Test your flows by adding custom evaluators"}),e.jsx(v,{sx:{mt:2,mb:2},variant:"body2",children:"Post execution, all the chosen evaluators will be executed on the results. Each evaluator will grade the results based on the criteria defined and return a pass/fail indicator."}),e.jsx(A,{variant:"contained",color:"success",sx:{background:x.palette.teal.main,color:"white"},label:"pass"}),e.jsx(A,{variant:"contained",color:"error",style:{margin:5},label:"fail"})]}),m===2&&e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mt:2},variant:"h4",children:"Grade flows using an LLM"}),e.jsx(v,{sx:{mt:2},variant:"body2",children:"Post execution, grades the answers by using an LLM. Used to generate comparative scores or reasoning or other custom defined criteria."})]})]}),m===0&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsxs(v,{variant:"overline",children:["Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(Rt,{style:{marginLeft:10},title:"Friendly name to tag this run."}),e.jsx(Ie,{id:"evaluationName",type:"string",size:"small",fullWidth:!0,placeholder:"Evaluation",value:Y,name:"evaluationName",onChange:t=>U(t.target.value)})]}),e.jsxs(D,{children:[e.jsxs(v,{variant:"overline",children:["Dataset to use",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(Ce,{name:"dataset",defaultOption:"Select Dataset",options:_,onSelect:t=>B(t),value:z})]}),e.jsxs(D,{children:[e.jsx(v,{variant:"overline",sx:{mr:2},children:"Treat all dataset rows as one conversation ?"}),e.jsx(xt,{label:"",control:e.jsx(ft,{}),value:$,onChange:()=>K(!$)})]}),e.jsxs(D,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(v,{variant:"overline",children:["Select your flows to Evaluate",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsxs(v,{variant:"overline",children:[e.jsx(ee,{defaultChecked:!0,size:"small",label:"All",value:"Chatflow",onChange:we})," ","Chatflows",e.jsx(ee,{defaultChecked:!0,size:"small",label:"All",value:"Agentflow v2",onChange:we})," ","Agentflows (v2)",e.jsx(ee,{defaultChecked:!0,size:"small",label:"All",value:"Custom Assistant",onChange:we})," ","Custom Assistants"]})]}),e.jsx(Se,{name:"chatflow1",options:b.filter(t=>u.includes(t.type)),onSelect:t=>J(t),value:S??S??"choose an option"})]})]}),m===1&&e.jsx(e.Fragment,{children:e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select the Evaluators"}),e.jsx(Se,{name:"selectEvals",options:le,onSelect:t=>f(t),value:w})]})}),m===2&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(v,{variant:"overline",sx:{mr:2},children:"Use an LLM to grade the results ?"}),e.jsx(Ce,{name:"chatLLM",defaultOption:"no_grading",options:ie,value:H,onSelect:t=>ot(t)})]}),o&&pe.length>0&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select Model"}),e.jsx(Ce,{name:"selectedModel",defaultOption:"",options:pe,value:de,onSelect:t=>ce(t)})]}),o&&pe.length===0&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Enter the Model Name"}),e.jsx(Ie,{id:"selectedModel",type:"string",size:"small",fullWidth:!0,placeholder:"Model Name",value:de,name:"selectedModel",onChange:t=>ce(t.target.value)})]}),o&&((Le=ie.find(t=>t.name===H))==null?void 0:Le.credential)&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select Credential"}),e.jsx(Lt,{size:"small",sx:{flexGrow:1,marginBottom:3},data:E?{credential:E}:{},inputParam:{label:"Connect Credential",name:"credential",type:"credential",credentialNames:[(Re=ie.find(t=>t.name===H))==null?void 0:Re.credential.credentialNames[0]]},onSelect:t=>{T(t)}},H)]}),o&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select Evaluators"}),e.jsx(Se,{name:"selectLLMEvals",options:re,onSelect:t=>M(t),value:g})]})]}),e.jsx(Fe,{})]})}),e.jsxs(gt,{style:{justifyContent:"space-between",marginBottom:10},children:[m>0&&e.jsx(ue,{sx:{ml:2},color:"secondary",title:"Previous Step",onClick:()=>st(),children:e.jsx(Ot,{})}),e.jsx("div",{style:{flex:1}}),m===1&&w.length===0&&e.jsx(Q,{title:"Skip Evaluators",color:"primary",sx:{mr:2,borderRadius:25},variant:"outlined",onClick:()=>be(m),children:"Skip"}),m===1&&w.length>0&&e.jsx(Q,{color:"primary",sx:{mr:2,borderRadius:25},variant:"contained",onClick:()=>be(m),children:"Next"}),m!==1&&e.jsx(vt,{disabled:lt(),sx:{mr:2,borderRadius:25},variant:"contained",onClick:()=>be(m),children:m===Ee.length-1?"Start Evaluation":"Next"})]}),e.jsx(He,{})]}):null;return jt.createPortal(ct,ae)};Ke.propTypes={show:ge.bool,dialogProps:ge.object,onCancel:ge.func,onConfirm:ge.func};const aa="/assets/empty_evals-ClL3epFs.svg",Ha=()=>{const l=De(),P=pt(a=>a.customization),{confirm:te}=Xe(),F=Ve();Ye();const{error:ae}=bt(),x=(...a)=>F(Ue(...a)),N=(...a)=>F(Ge(...a)),j=W(ve.createEvaluation),C=W(ve.getAllEvaluations),[I,L]=r.useState(!1),[O,q]=r.useState({}),[S,J]=r.useState([]),[z,B]=r.useState(!1),[$,K]=r.useState(!1),[u,R]=r.useState([]),[b,se]=r.useState(!1),[_,ne]=r.useState(1),[E,T]=r.useState(Wt),[Y,U]=r.useState(0),le=(a,o)=>{ne(a),T(o),G(a,o)},G=(a,o)=>{const s={page:a||_,limit:o||E};C.request(s)},re=a=>{if(a.target.checked){const o=S.filter(s=>s==null?void 0:s.latestEval).map(s=>s.id);R(o);return}R([])},n=(a,o)=>{const s=u.indexOf(o);let p=[];s===-1?p=p.concat(u,o):s===0?p=p.concat(u.slice(1)):s===u.length-1?p=p.concat(u.slice(0,-1)):s>0&&(p=p.concat(u.slice(0,s),u.slice(s+1))),R(p)},w=()=>{q({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Start New Evaluation",data:{}}),L(!0)},f=async()=>{const a={title:"Delete",description:`Delete ${u.length} ${u.length>1?"evaluations":"evaluation"}? This will delete all versions of the evaluation.`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await te(a)){try{(await ve.deleteEvaluations(u,!0)).data&&(x({message:`${u.length} ${u.length>1?"evaluations":"evaluation"} deleted`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:oe=>e.jsx(Q,{style:{color:"white"},onClick:()=>N(oe),children:e.jsx(me,{})})}}),M())}catch(s){x({message:`Failed to delete ${u.length>1?"evaluations":"evaluation"}: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:p=>e.jsx(Q,{style:{color:"white"},onClick:()=>N(p),children:e.jsx(me,{})})}})}R([])}};r.useEffect(()=>{G(_,E)},[]),r.useEffect(()=>{if(C.data){const a=C.data.data;if(U(C.data.total),a){for(let o=0;o<a.length;o++){const s=a[o];a[o].runDate=je(s.runDate).format("DD-MMM-YYYY, hh:mm:ss A"),a[o].average_metrics=typeof s.average_metrics=="object"?s.average_metrics:JSON.parse(s.average_metrics),a[o].usedFlows=typeof s.chatflowName=="object"?s.chatflowName:JSON.parse(s.chatflowName),a[o].chatIds=typeof s.chatflowId=="object"?s.chatflowId:JSON.parse(s.chatflowId)}J(a)}}},[C.data]),r.useEffect(()=>{if(j.data){const a=j.data;for(let o=0;o<a.length;o++){const s=a[o];a[o].runDate=je(s.runDate).format("DD-MMM-YYYY, hh:mm:ss A"),a[o].average_metrics=typeof s.average_metrics=="object"?s.average_metrics:JSON.parse(s.average_metrics),a[o].usedFlows=typeof s.chatflowName=="object"?s.chatflowName:JSON.parse(s.chatflowName),a[o].chatIds=typeof s.chatflowId=="object"?s.chatflowId:JSON.parse(s.chatflowId)}J(a)}B(!1)},[j.data]);const g=a=>{L(!1),B(!0),j.request(a)};r.useEffect(()=>{var a,o;j.error&&(x({message:`Failed to create new evaluation: ${typeof((a=j.error.response)==null?void 0:a.data)=="object"?j.error.response.data.message:((o=j.error.response)==null?void 0:o.data)||j.error.message||"Unknown error"}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>e.jsx(Q,{style:{color:"white"},onClick:()=>N(s),children:e.jsx(me,{})})}}),B(!1))},[j.error]);const M=r.useCallback(()=>{G(_,E)},[C]);r.useEffect(()=>{K(C.loading)},[C.loading]),r.useEffect(()=>{let a=null;return b&&(a=setInterval(()=>{M()},5e3)),()=>{a&&clearInterval(a)}},[b,M]);const m=()=>{se(!b)};return e.jsxs(e.Fragment,{children:[e.jsx(wt,{children:ae?e.jsx(Nt,{error:ae}):e.jsxs(Z,{flexDirection:"column",sx:{gap:3},children:[e.jsxs(Mt,{isBackButton:!1,isEditButton:!1,search:!1,title:"Evaluations",description:"",children:[e.jsx(yt,{value:"auto-refresh",selected:b,onChange:m,size:"small",sx:{borderRadius:2,height:"100%",backgroundColor:"transparent",color:b?"#ff9800":"#4caf50",border:"1px solid transparent","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)",color:b?"#f57c00":"#388e3c",border:"1px solid transparent"},"&.Mui-selected":{backgroundColor:"transparent",color:"#ff9800",border:"1px solid transparent","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)",color:"#f57c00",border:"1px solid transparent"}}},title:b?"Disable auto-refresh":"Enable auto-refresh (every 5s)",children:b?e.jsx(Zt,{}):e.jsx(ta,{})}),e.jsx(ue,{sx:{borderRadius:2,height:"100%",color:l.palette.secondary.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)",color:l.palette.secondary.dark}},onClick:M,title:"Refresh",children:e.jsx(Jt,{})}),e.jsx(ze,{permissionId:"evaluations:create",sx:{borderRadius:2,height:"100%"},onClick:w,startIcon:e.jsx(Ut,{}),children:"New Evaluation"})]}),u.length>0&&e.jsxs(ze,{permissionId:"evaluations:delete",sx:{mt:1,mb:2,width:"max-content"},variant:"outlined",onClick:f,color:"error",startIcon:e.jsx(Qe,{}),children:["Delete ",u.length," ",u.length===1?"evaluation":"evaluations"]}),!$&&S.length<=0?e.jsxs(Z,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(D,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:aa,alt:"empty_evalSVG"})}),e.jsx("div",{children:"No Evaluations Yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{sx:{border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},component:St,children:e.jsxs(We,{sx:{minWidth:650},children:[e.jsx(qe,{sx:{backgroundColor:P.isDarkMode?l.palette.common.black:l.palette.grey[100],height:56},children:e.jsxs(he,{children:[e.jsx(y,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:u.length===(S.filter(a=>a==null?void 0:a.latestEval)||[]).length,onChange:re,inputProps:{"aria-label":"select all"}})}),e.jsx(y,{width:10,children:" "}),e.jsx(y,{children:"Name"}),e.jsx(y,{children:"Latest Version"}),e.jsx(y,{children:"Average Metrics"}),e.jsx(y,{children:"Last Evaluated"}),e.jsx(y,{children:"Flow(s)"}),e.jsx(y,{children:"Dataset"}),e.jsx(y,{children:" "})]})}),e.jsx(Je,{children:$?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})})]}),e.jsxs(ke,{children:[e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:S.filter(a=>a==null?void 0:a.latestEval).map((a,o)=>e.jsx(Ze,{rows:S.filter(s=>s.name===a.name),item:a,theme:l,selected:u,customization:P,onRefresh:M,handleSelect:n},o))})})]})}),e.jsx(qt,{currentPage:_,limit:E,total:Y,onChange:le})]})]})}),I&&e.jsx(Ke,{show:I,dialogProps:O,onCancel:()=>L(!1),onConfirm:g}),e.jsx(He,{}),z&&e.jsx(Dt,{open:z})]})};function Ze(l){var K,u,R,b,se,_,ne,E,T,Y,U,le,G,re;const P=(...n)=>L(Ue(...n)),te=(...n)=>L(Ge(...n)),[F,ae]=r.useState(!1),[x,N]=r.useState([]),j=De(),C=Et(),{confirm:I}=Xe(),L=Ve(),O=n=>{C(`/evaluation_results/${n.id}`)},q=n=>{window.open(`/dataset_rows/${n}`,"_blank")},S=n=>{if(n.target.checked){const w=((l==null?void 0:l.rows)||[]).map(f=>f.id);N(w);return}N([])},J=(n,w)=>{const f=x.indexOf(w);let g=[];f===-1?g=g.concat(x,w):f===0?g=g.concat(x.slice(1)):f===x.length-1?g=g.concat(x.slice(0,-1)):f>0&&(g=g.concat(x.slice(0,f),x.slice(f+1))),N(g)},z=async()=>{const n={title:"Delete",description:`Delete ${x.length} ${x.length>1?"evaluations":"evaluation"}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await I(n))try{(await ve.deleteEvaluations(x)).data&&(P({message:`${x.length} evaluations deleted.`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:g=>e.jsx(Q,{style:{color:"white"},onClick:()=>te(g),children:e.jsx(me,{})})}}),l.onRefresh())}catch(f){P({message:`Failed to delete Evaluation: ${typeof f.response.data=="object"?f.response.data.message:f.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:g=>e.jsx(Q,{style:{color:"white"},onClick:()=>te(g),children:e.jsx(me,{})})}})}},B=n=>{switch(n){case"pending":return"#ffc107";case"completed":return"#52b69a";case"error":return"#f44336";default:return"#bcbcbc"}},$=n=>n>90?"#52b69a":n>=50?"#f48c06":"#f44336";return e.jsxs(Be.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(d,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:l.selected.indexOf(l.item.id)!==-1,onChange:n=>l.handleSelect(n,l.item.id)})}),e.jsx(d,{children:e.jsx("div",{style:{display:"flex",width:"20px",height:"20px",backgroundColor:B(l.item.status),borderRadius:"50%"},title:((K=l.item)==null?void 0:K.status)==="error"?(R=(u=l.item)==null?void 0:u.average_metrics)==null?void 0:R.error:""})}),e.jsx(d,{children:l.item.name}),e.jsxs(d,{children:[l.item.version," ",l.item.version>0&&e.jsx(ue,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>ae(!F),children:l.item.version>0&&F?e.jsx(Gt,{}):e.jsx(Ht,{})})]}),e.jsx(d,{children:e.jsxs(Z,{flexDirection:"row",sx:{gap:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(b=l.item.average_metrics)!=null&&b.totalRuns?"Total Runs: "+((se=l.item.average_metrics)==null?void 0:se.totalRuns):"Total Runs: N/A"}),((_=l.item.average_metrics)==null?void 0:_.averageCost)&&e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(ne=l.item.average_metrics)==null?void 0:ne.averageCost}),e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(E=l.item.average_metrics)!=null&&E.averageLatency?"Avg Latency: "+((T=l.item.average_metrics)==null?void 0:T.averageLatency)+"ms":"Avg Latency: N/A"}),((Y=l.item.average_metrics)==null?void 0:Y.passPcnt)>=0&&e.jsx(A,{variant:"raised",size:"small",sx:{color:"white",backgroundColor:$((U=l.item.average_metrics)==null?void 0:U.passPcnt)},label:(le=l.item.average_metrics)!=null&&le.passPcnt?"Pass Rate: "+l.item.average_metrics.passPcnt+"%":"Pass Rate: N/A"})]})}),e.jsx(d,{children:je(l.item.runDate).format("DD-MMM-YYYY, hh:mm:ss A")}),e.jsx(d,{children:e.jsx(Z,{flexDirection:"row",sx:{gap:2,alignItems:"center",flexWrap:"wrap"},children:(re=(G=l.item)==null?void 0:G.usedFlows)==null?void 0:re.map((n,w)=>e.jsx(A,{style:{width:"max-content",borderRadius:"25px"},label:n},w))})}),e.jsx(d,{children:e.jsx(A,{clickable:!0,style:{border:"none",width:"max-content",borderRadius:"25px",boxShadow:l.customization.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 10%)":"0 2px 14px 0 rgb(32 40 45 / 10%)"},variant:"outlined",label:l.item.datasetName,onClick:()=>q(l.item.datasetId)})}),e.jsx(y,{children:e.jsx(ue,{title:"View Results",color:"primary",disabled:l.item.status==="pending",onClick:()=>O(l.item),children:e.jsx(kt,{})})})]}),F&&x.length>0&&e.jsx(he,{sx:{"& td":{border:0}},children:e.jsx(d,{colSpan:12,children:e.jsxs(Q,{sx:{mt:2,width:"max-content"},variant:"outlined",onClick:z,color:"error",startIcon:e.jsx(Qe,{}),children:["Delete ",x.length," ",x.length===1?"evaluation":"evaluations"]})})}),F&&e.jsx(e.Fragment,{children:e.jsx(he,{sx:{"& td":{border:0}},children:e.jsx(d,{colSpan:12,sx:{p:2},children:e.jsx(At,{in:F,timeout:"auto",unmountOnExit:!0,children:e.jsx(D,{sx:{borderRadius:2,border:1,borderColor:j.palette.grey[900]+25,overflow:"hidden"},children:e.jsxs(We,{"aria-label":"chatflow table",children:[e.jsx(qe,{style:{height:10},children:e.jsxs(he,{children:[e.jsx(y,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:x.length===(l.rows||[]).length,onChange:S})}),e.jsx(y,{children:"Version"}),e.jsx(y,{children:"Last Run"}),e.jsx(y,{children:"Average Metrics"}),e.jsx(y,{children:"Status"}),e.jsx(y,{children:" "})]})}),e.jsx(Je,{children:l.rows.length>0&&l.rows.map((n,w)=>{var f,g,M,m,a,o,s,p,oe;return e.jsx(Be.Fragment,{children:e.jsxs(he,{sx:{"& td":{border:0}},children:[e.jsx(d,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:x.indexOf(n.id)!==-1,onChange:ie=>J(ie,n.id)})}),e.jsx(d,{children:n.version}),e.jsx(d,{children:je(n.runDate).format("DD-MMM-YYYY, hh:mm:ss A")}),e.jsx(d,{children:e.jsxs(Z,{flexDirection:"row",sx:{gap:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(f=n.average_metrics)!=null&&f.totalRuns?"Total Runs: "+((g=n.average_metrics)==null?void 0:g.totalRuns):"Total Runs: N/A"}),((M=n.average_metrics)==null?void 0:M.averageCost)&&e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(m=n.average_metrics)==null?void 0:m.averageCost}),e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(a=n.average_metrics)!=null&&a.averageLatency?"Avg Latency: "+((o=n.average_metrics)==null?void 0:o.averageLatency)+"ms":"Avg Latency: N/A"}),((s=n.average_metrics)==null?void 0:s.passPcnt)>=0&&e.jsx(A,{variant:"raised",size:"small",sx:{color:"white",backgroundColor:$((p=n.average_metrics)==null?void 0:p.passPcnt)},label:(oe=n.average_metrics)!=null&&oe.passPcnt?"Pass rate: "+n.average_metrics.passPcnt+"%":"Pass rate: N/A"})]})}),e.jsx(d,{children:e.jsx(A,{variant:"contained",size:"small",sx:{color:"white",backgroundColor:B(n.status)},label:n.status,title:n.status==="error"?n.average_metrics.error:""})}),e.jsx(d,{children:e.jsx(ue,{title:"View Results",color:"primary",disabled:n.status==="pending",onClick:()=>O(n),children:e.jsx(Qt,{})})})]})},w)})})]})})})})})})]})}Ze.propTypes={item:X.object,selected:X.array,rows:X.arrayOf(X.object),theme:X.any,customization:X.object,onRefresh:X.func,handleSelect:X.func};export{Ha as default};
