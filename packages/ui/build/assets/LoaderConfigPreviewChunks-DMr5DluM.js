import{af as ke,f as ye,u as Ce,a as ve,b as we,O as Se,c as E,ak as De,r as n,s as Ie,t as Pe,aq as R,ar as X,j as e,M as Z,S as Ne,B as c,am as Ee,o as m,d as K,aa as Re,aj as b,as as w,g as Me,a5 as Fe,y as Ae,ah as Te,ag as Oe,q as S,i as D,L as Be,N as $e}from"./index-B5bgjFPS.js";import{R as qe}from"./main-Dw2W3SKo.js";import{B as We}from"./BackdropLoader-Ch3nVEPr.js";import{D as U}from"./DocStoreInputHandler-BDJBQrwa.js";import{D as ze}from"./Dropdown-D8Rr64ju.js";import{S as M}from"./StyledFab-DFomU4Vk.js";import{E as Le}from"./ErrorBoundary-x4bZaoHs.js";import{E as Ge}from"./ExpandedChunkDialog-DigJE3y9.js";import{n as Q}from"./nodes-Qb-8otVq.js";import{d as I}from"./documentstore-CRtiIDJT.js";import{v as V}from"./v4-CtRu48qb.js";import{a as He}from"./IconSearch-4bUU90FL.js";import{I as _e}from"./IconDatabaseImport-DrfswHAv.js";import{T as Je}from"./TextField-OmGdqrIf.js";import{I as Xe}from"./IconScissors-BD95L9kC.js";import{S as u}from"./Skeleton-DJP3nnUt.js";import{I as Y}from"./IconEye-Ci4p6xvE.js";import"./MultiDropdown-BUXEvYds.js";import"./FormControl-o0rphY-g.js";import"./Autocomplete-CinIIKT5.js";import"./Close-DT9tpzn1.js";import"./CredentialInputHandler-C4W2GUgN.js";import"./CredentialListDialog-ZkUPpHPz.js";import"./TooltipWithParser-D26Faoyy.js";import"./index-D--Rb2MU.js";import"./Tooltip-CXmeiPEa.js";import"./ConfirmDialog-Dfe34hOz.js";import"./Input-CajAyvOv.js";import"./ListItem-BfStHUI0.js";import"./Switch-D5M093wC.js";import"./IconArrowsMaximize-BLCViMbK.js";import"./IconAlertTriangle-7YQ2ldQl.js";import"./InputAdornment-v58Edx4J.js";import"./Delete-4D-T7tnN.js";import"./IconPlus-j8jP5X4Z.js";import"./GridActionsCellItem-B3aQ_RGo.js";import"./Grid-DGDGmzGP.js";import"./toPropertyKey-C9c9JG92.js";import"./createStyled-DlEbU-rO.js";import"./InputLabel-BtU13bbu.js";import"./KeyboardArrowRight-BvTOCIXU.js";import"./LastPage--XaxDP-k.js";import"./File-km8sc6Tq.js";import"./CodeEditor-BbQJOBPh.js";import"./index-C-cusT-F.js";import"./suggestionOption-DCQ-1oAJ.js";import"./TabPanel-C-h4h7GL.js";import"./ExpandMore-BZIzyY2F.js";import"./MemoizedReactMarkdown-mGWPD7hJ.js";import"./unsupportedIterableToArray-Bh0GkvIo.js";import"./ExpandTextDialog-XWdUWqGp.js";import"./LoadingButton-CJHvS9bV.js";import"./IconTrash-CekgWF9B.js";import"./IconRefresh-CtZoTUkg.js";import"./ToolDialog-DZ6z_iak.js";import"./ExportAsTemplateDialog-481ESzFy.js";import"./AssistantDialog-CJzYVebb.js";import"./assistants-DZYxhrU8.js";import"./Stepper-BCbMjc86.js";import"./IconLanguage-BXvwKb3u.js";import"./string-BbYD24iH.js";import"./IconBulb-BQTovKvQ.js";import"./IconCopy-bbAsun7S.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-0"}],["path",{d:"M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-1"}],["path",{d:"M3 6l0 13",key:"svg-2"}],["path",{d:"M12 6l0 13",key:"svg-3"}],["path",{d:"M21 6l0 13",key:"svg-4"}]],Ue=ke("outline","book","Book",Ke),Qe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ve(l){return typeof l=="string"&&Qe.test(l)}const Ye=Ae(Z)(({theme:l})=>({background:l.palette.card.main,color:l.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:l.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),la=()=>{var _,J;const l=ye(t=>t.customization),P=Ce(),ee=ve(),{error:F}=we(),{hasAssignedWorkspace:te}=Se(),x=E(Q.getSpecificNode),g=E(Q.getNodesByCategory),h=E(I.getSpecificDocumentStore),{storeId:N,name:k}=De(),[s,A]=n.useState({}),[T,f]=n.useState(!1),[O,B]=n.useState(""),[y,ae]=n.useState([]),[$,se]=n.useState([]),[r,j]=n.useState({}),[p,oe]=n.useState([]),[ie,re]=n.useState(0),[ne,le]=n.useState(0),[q,de]=n.useState(20),[d,ce]=n.useState(),[pe,W]=n.useState(!1),[me,he]=n.useState({}),z=Ie();Pe();const C=(...t)=>z(Be(...t)),v=(...t)=>z($e(...t)),fe=({inputParam:t,newValue:a})=>{A(o=>{const i={...o};return i.inputs[t.name]=a,i.inputParams=w(i),i})},ue=({inputParam:t,newValue:a})=>{j(o=>{const i={...o};return i.inputs[t.name]=a,i.inputParams=w(i),i})},xe=t=>{const a=(y??[]).find(o=>o.name===t);j(a||{})},ge=(t,a)=>{he({data:{selectedChunk:t,selectedChunkNumber:a}}),W(!0)},L=()=>{let t=!0;const a=[],o=(s.inputParams??[]).filter(i=>!i.hidden);for(const i of o)!i.optional&&(!s.inputs[i.name]||!s.credential)&&(i.type==="credential"&&!s.credential&&!s.inputs.FLOWISE_CREDENTIAL_ID||i.type!=="credential"&&!s.inputs[i.name])&&(t=!1,a.push(i.label||i.name));if(!t){const i=a.join(", ");C({message:`Please fill in the following mandatory fields: ${i}`,options:{key:new Date().getTime()+Math.random(),variant:"warning",action:be=>e.jsx(S,{style:{color:"white"},onClick:()=>v(be),children:e.jsx(D,{})})}})}return t},G=async()=>{if(L()){f(!0);const t=H();t.previewChunkCount=q;try{const a=await I.previewChunks(t);a.data&&(re(a.data.totalChunks),oe(Array.isArray(a.data.chunks)?a.data.chunks:[]),le(a.data.previewChunkCount)),f(!1)}catch(a){f(!1),C({message:`Failed to preview chunks: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:o=>e.jsx(S,{style:{color:"white"},onClick:()=>v(o),children:e.jsx(D,{})})}})}}},je=async()=>{var t;if(L()){f(!0);const a=H();try{const o=await I.saveProcessingLoader(a);f(!1),o.data&&(C({message:"File submitted for processing. Redirecting to Document Store..",options:{key:new Date().getTime()+Math.random(),variant:"success",action:i=>e.jsx(S,{style:{color:"white"},onClick:()=>v(i),children:e.jsx(D,{})})}}),I.processLoader(a,(t=o.data)==null?void 0:t.id),P("/document-stores/"+N))}catch(o){f(!1),C({message:`Failed to process chunking: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:i=>e.jsx(S,{style:{color:"white"},onClick:()=>v(i),children:e.jsx(D,{})})}})}}},H=()=>{const t={};if(d?(t.loaderId=d.loaderId,t.id=d.id):t.loaderId=k,t.storeId=N,t.loaderName=O||(s==null?void 0:s.label),s.inputs&&(t.loaderConfig={},Object.keys(s.inputs).map(a=>{t.loaderConfig[a]=s.inputs[a]})),r.inputs&&r.name&&Object.keys(r).length>0){t.splitterId=r.name,t.splitterConfig={},Object.keys(r.inputs).map(o=>{t.splitterConfig[o]=r.inputs[o]});const a=y.find(o=>o.name===r.name);a&&(t.splitterName=a.label)}return s.credential&&(t.credential=s.credential),t};return n.useEffect(()=>{Ve(k)?h.request(N):x.request(k)},[]),n.useEffect(()=>{if(x.data){const t=R.cloneDeep(X(x.data,V()));d&&d.loaderConfig&&(t.inputs=d.loaderConfig,B(d.loaderName)),A(t),t.inputAnchors.find(o=>o.name==="textSplitter")&&g.request("Text Splitters")}},[x.data]),n.useEffect(()=>{if(g.data){const t=[];for(const o of g.data)t.push(R.cloneDeep(X(o,V())));ae(t);const a=g.data.map(o=>({label:o.label,name:o.name}));if(a.unshift({label:"None",name:"none"}),se(a),d&&d.splitterConfig&&d.splitterId){const o=t.find(i=>i.name===d.splitterId);o?(o.inputs=R.cloneDeep(d.splitterConfig),j(o)):j({})}}},[g.data]),n.useEffect(()=>{var t;if(h.data){const a=h.data.workspaceId;if(!te(a)){P("/unauthorized");return}if(((t=h.data)==null?void 0:t.loaders.length)>0){const o=h.data.loaders.find(i=>i.id===k);o&&(ce(o),x.request(o.loaderId))}}},[h.data]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:F?e.jsx(Le,{error:F}):e.jsxs(Ne,{flexDirection:"column",children:[e.jsx(c,{sx:{flexGrow:1,py:1.25,width:"100%"},children:e.jsxs(Ee,{disableGutters:!0,sx:{p:0,display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",flexDirection:"row"},children:[e.jsx(M,{size:"small",color:"secondary","aria-label":"back",title:"Back",onClick:()=>P(-1),children:e.jsx(He,{})}),e.jsx(m,{sx:{ml:2,mr:2},variant:"h3",children:s==null?void 0:s.label}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:s!=null&&s.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(s==null?void 0:s.name)??"docloader",src:`${K}/api/v1/node-icon/${s==null?void 0:s.name}`}):e.jsx(Ue,{color:"black"})})]}),e.jsx(c,{children:e.jsx(Re,{variant:"contained",onClick:je,sx:{borderRadius:2,height:"100%"},startIcon:e.jsx(_e,{}),children:"Process"})})]})}),e.jsx(c,{children:e.jsxs(b,{container:!0,spacing:"2",children:[e.jsx(b,{item:!0,xs:4,md:6,lg:6,sm:4,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15},children:[e.jsx(c,{sx:{p:2},children:e.jsx(Je,{fullWidth:!0,sx:{mt:1},size:"small",label:(_=s==null?void 0:s.label)!=null&&_.toLowerCase().includes("loader")?s.label+" name":(s==null?void 0:s.label)+" Loader Name",value:O,onChange:t=>B(t.target.value)})}),s&&Object.keys(s).length>0&&w(s).filter(t=>!t.hidden&&t.display!==!1).map((t,a)=>e.jsx(U,{inputParam:t,data:s,onNodeDataChange:fe},a)),y&&y.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:2,mt:5},children:[e.jsx(m,{sx:{mr:2},variant:"h3",children:((J=($??[]).find(t=>t.name===(r==null?void 0:r.name)))==null?void 0:J.label)??"Select Text Splitter"}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:r!=null&&r.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(r==null?void 0:r.name)??"textsplitter",src:`${K}/api/v1/node-icon/${r==null?void 0:r.name}`}):e.jsx(Xe,{color:"black"})})]}),e.jsxs(c,{sx:{p:2},children:[e.jsx(m,{children:"Splitter"}),e.jsx(ze,{name:"textSplitter",options:$,onSelect:t=>xe(t),value:(r==null?void 0:r.name)??"none"},JSON.stringify(r))]})]}),Object.keys(r).length>0&&w(r).filter(t=>!t.hidden&&t.display!==!1).map((t,a)=>e.jsx(U,{data:r,inputParam:t,onNodeDataChange:ue},a))]})}),e.jsxs(b,{item:!0,xs:8,md:6,lg:6,sm:8,children:[!p||p.length===0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsxs(c,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:Me,children:[e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160})]}),e.jsx("div",{style:{position:"absolute",top:0,right:0,width:"100%",height:"100%",backdropFilter:"blur(1px)",background:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:G,children:[e.jsx(Y,{style:{marginRight:"5px"}}),"Preview Chunks"]})})]}),p&&p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{sx:{wordWrap:"break-word",textAlign:"left",mb:2},variant:"h3",children:[ne," of ",ie," Chunks"]}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(m,{children:"Show Chunks in Preview"}),e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx(Fe,{size:"small",multiline:!1,sx:{mt:1,flex:1,mr:2},type:"number",onChange:t=>de(t.target.value),value:q??25},"previewChunkCount"),e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:G,children:[e.jsx(Y,{style:{marginRight:"5px"}}),"Preview"]})]})]}),e.jsx("div",{style:{height:"800px",overflow:"scroll",padding:"5px"},children:e.jsx(b,{container:!0,spacing:2,children:p==null?void 0:p.map((t,a)=>e.jsx(b,{item:!0,lg:6,md:6,sm:6,xs:6,children:e.jsx(Ye,{content:!1,onClick:()=>ge(t,a+1),sx:{border:1,borderColor:ee.palette.grey[900]+25,borderRadius:2},children:e.jsx(Te,{children:e.jsxs(Oe,{sx:{p:1},children:[e.jsx(m,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${a+1}. Characters: ${t.pageContent.length}`}),e.jsx(m,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(qe,{theme:l.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata,name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:1})]})})})},a))})})]})]})]})})]})}),e.jsx(Ge,{show:pe,isReadOnly:!0,dialogProps:me,onCancel:()=>W(!1)}),T&&e.jsx(We,{open:T})]})};export{la as default};
