import{af as ue,r as l,az as J,w as Ue,k as ht,l as gt,j as t,a as fe,f as ce,bI as pe,y as ne,h as q,aC as Ie,ao as te,cW as Se,B as _,d as ae,o as de,ba as Y,M as Ne,K as re,c5 as se,A as Ke,P as N,s as Je,i as Qe,cO as xt,v as mt,H as Ge,D as ft,n as yt,S as ve,an as we,as as bt}from"./index-B5bgjFPS.js";import{N as Ze,I as vt}from"./NodeInfoDialog-BuAc37BO.js";import{I as et,d as tt}from"./StopCircle-Dr72dSBy.js";import{B as Ee}from"./ButtonGroup-DgM5AEGL.js";import{I as Me}from"./IconCopy-bbAsun7S.js";import{I as Te}from"./IconTrash-CekgWF9B.js";import{T as je}from"./Tooltip-CXmeiPEa.js";import{I as wt}from"./ToolDialog-DZ6z_iak.js";import{r as ot,e as Ce,o as jt,t as ke,h as rt,j as U,s as Ct,d as kt,v as It,k as St,w as Nt,x as Ye,i as Ae,H as me,g as Et,q as Mt,N as Tt}from"./DocStoreInputHandler-BDJBQrwa.js";import{B as At}from"./style-CyLs_DYe.js";import{I as Dt}from"./Input-CajAyvOv.js";import{T as Pt}from"./TextField-OmGdqrIf.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"M12 19v.01",key:"svg-0"}],["path",{d:"M12 15v-10",key:"svg-1"}]],st=ue("outline","exclamation-mark","ExclamationMark",Rt);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M15 8h.01",key:"svg-0"}],["path",{d:"M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z",key:"svg-1"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5",key:"svg-2"}],["path",{d:"M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3",key:"svg-3"}]],zt=ue("outline","photo","Photo",$t);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M19.5 7a9 9 0 0 0 -7.5 -4a8.991 8.991 0 0 0 -7.484 4",key:"svg-0"}],["path",{d:"M11.5 3a16.989 16.989 0 0 0 -1.826 4",key:"svg-1"}],["path",{d:"M12.5 3a16.989 16.989 0 0 1 1.828 4",key:"svg-2"}],["path",{d:"M19.5 17a9 9 0 0 1 -7.5 4a8.991 8.991 0 0 1 -7.484 -4",key:"svg-3"}],["path",{d:"M11.5 21a16.989 16.989 0 0 1 -1.826 -4",key:"svg-4"}],["path",{d:"M12.5 21a16.989 16.989 0 0 0 1.828 -4",key:"svg-5"}],["path",{d:"M2 10l1 4l1.5 -4l1.5 4l1 -4",key:"svg-6"}],["path",{d:"M17 10l1 4l1.5 -4l1.5 4l1 -4",key:"svg-7"}],["path",{d:"M9.5 10l1 4l1.5 -4l1.5 4l1 -4",key:"svg-8"}]],_t=ue("outline","world-www","WorldWww",Ot);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["path",{d:"M12 2c5.523 0 10 4.477 10 10a10 10 0 0 1 -19.995 .324l-.005 -.324l.004 -.28c.148 -5.393 4.566 -9.72 9.996 -9.72zm.01 13l-.127 .007a1 1 0 0 0 0 1.986l.117 .007l.127 -.007a1 1 0 0 0 0 -1.986l-.117 -.007zm-.01 -8a1 1 0 0 0 -.993 .883l-.007 .117v4l.007 .117a1 1 0 0 0 1.986 0l.007 -.117v-4l-.007 -.117a1 1 0 0 0 -.993 -.883z",key:"svg-0"}]],Bt=ue("filled","alert-circle-filled","AlertCircleFilled",Ht);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["path",{d:"M12 2c5.523 0 10 4.477 10 10a10 10 0 0 1 -20 0c0 -5.523 4.477 -10 10 -10m-.293 6.293a1 1 0 0 0 -1.414 0l-.083 .094a1 1 0 0 0 .083 1.32l2.292 2.293l-2.292 2.293a1 1 0 0 0 1.414 1.414l3 -3a1 1 0 0 0 0 -1.414z",key:"svg-0"}]],nt=ue("filled","circle-chevron-right-filled","CircleChevronRightFilled",Lt),Ft=e=>{var o;return(o=e.domNode)==null?void 0:o.querySelector(".react-flow__renderer")};function Wt({children:e}){const o=Ce(Ft);return o?Ue.createPortal(e,o):null}const Vt=(e,o)=>{var a,c,u,n,m,r;return((a=e==null?void 0:e.positionAbsolute)==null?void 0:a.x)===((c=o==null?void 0:o.positionAbsolute)==null?void 0:c.x)&&((u=e==null?void 0:e.positionAbsolute)==null?void 0:u.y)===((n=o==null?void 0:o.positionAbsolute)==null?void 0:n.y)&&(e==null?void 0:e.width)===(o==null?void 0:o.width)&&(e==null?void 0:e.height)===(o==null?void 0:o.height)&&(e==null?void 0:e.selected)===(o==null?void 0:o.selected)&&((m=e==null?void 0:e[ke])==null?void 0:m.z)===((r=o==null?void 0:o[ke])==null?void 0:r.z)},Xt=(e,o)=>e.length===o.length&&e.every((a,c)=>Vt(a,o[c])),Gt=e=>({transform:e.transform,nodeOrigin:e.nodeOrigin,selectedNodesCount:e.getNodes().filter(o=>o.selected).length});function Yt(e,o,a,c,u){let n=.5;u==="start"?n=0:u==="end"&&(n=1);let m=[(e.x+e.width*n)*o[2]+o[0],e.y*o[2]+o[1]-c],r=[-100*n,-100];switch(a){case U.Right:m=[(e.x+e.width)*o[2]+o[0]+c,(e.y+e.height*n)*o[2]+o[1]],r=[0,-100*n];break;case U.Bottom:m[1]=(e.y+e.height)*o[2]+o[1]+c,r[1]=0;break;case U.Left:m=[e.x*o[2]+o[0]-c,(e.y+e.height*n)*o[2]+o[1]],r=[-100,-100*n];break}return`translate(${m[0]}px, ${m[1]}px) translate(${r[0]}%, ${r[1]}%)`}function ye({nodeId:e,children:o,className:a,style:c,isVisible:u,position:n=U.Top,offset:m=10,align:r="center",...h}){const y=ot(),E=l.useCallback(k=>(Array.isArray(e)?e:[e||y||""]).reduce((s,v)=>{const B=k.nodeInternals.get(v);return B&&s.push(B),s},[]),[e,y]),p=Ce(E,Xt),{transform:g,nodeOrigin:w,selectedNodesCount:j}=Ce(Gt,Ct);if(!(typeof u=="boolean"?u:p.length===1&&p[0].selected&&j===1)||!p.length)return null;const M=jt(p,w),C=Math.max(...p.map(k=>{var b;return(((b=k[ke])==null?void 0:b.z)||1)+1})),A={position:"absolute",transform:Yt(M,g,n,m,r),zIndex:C,...c};return J.createElement(Wt,null,J.createElement("div",{style:A,className:rt(["react-flow__node-toolbar",a]),...h},o))}var oe;(function(e){e.Line="line",e.Handle="handle"})(oe||(oe={}));function qt({width:e,prevWidth:o,height:a,prevHeight:c,invertX:u,invertY:n}){const m=e-o,r=a-c,h=[m>0?1:m<0?-1:0,r>0?1:r<0?-1:0];return m&&u&&(h[0]=h[0]*-1),r&&n&&(h[1]=h[1]*-1),h}const it={width:0,height:0,x:0,y:0},Ut={...it,pointerX:0,pointerY:0,aspectRatio:1};function Kt({nodeId:e,position:o,variant:a=oe.Handle,className:c,style:u={},children:n,color:m,minWidth:r=10,minHeight:h=10,maxWidth:y=Number.MAX_VALUE,maxHeight:E=Number.MAX_VALUE,keepAspectRatio:p=!1,shouldResize:g,onResizeStart:w,onResize:j,onResizeEnd:S}){const M=ot(),C=typeof e=="string"?e:M,A=kt(),k=l.useRef(null),b=l.useRef(Ut),s=l.useRef(it),v=It(),B=a===oe.Line?"right":"bottom-right",D=o??B;l.useEffect(()=>{if(!k.current||!C)return;const x=St(k.current),i=D.includes("right")||D.includes("left"),d=D.includes("bottom")||D.includes("top"),I=D.includes("left"),T=D.includes("top"),L=Nt().on("start",R=>{const f=A.getState().nodeInternals.get(C),{xSnapped:V,ySnapped:$}=v(R);s.current={width:(f==null?void 0:f.width)??0,height:(f==null?void 0:f.height)??0,x:(f==null?void 0:f.position.x)??0,y:(f==null?void 0:f.position.y)??0},b.current={...s.current,pointerX:V,pointerY:$,aspectRatio:s.current.width/s.current.height},w==null||w(R,{...s.current})}).on("drag",R=>{const{nodeInternals:f,triggerNodeChanges:V}=A.getState(),{xSnapped:$,ySnapped:Q}=v(R),Z=f.get(C);if(Z){const X=[],{pointerX:F,pointerY:ee,width:ie,height:Re,x:$e,y:ze,aspectRatio:G}=b.current,{x:Oe,y:_e,width:He,height:Be}=s.current,Le=Math.floor(i?$-F:0),Fe=Math.floor(d?Q-ee:0);let z=Ye(ie+(I?-Le:Le),r,y),O=Ye(Re+(T?-Fe:Fe),h,E);if(p){const K=z/O,le=i&&d,he=i&&!d,ge=d&&!i;z=K<=G&&le||ge?O*G:z,O=K>G&&le||he?z/G:O,z>=y?(z=y,O=y/G):z<=r&&(z=r,O=r/G),O>=E?(O=E,z=E*G):O<=h&&(O=h,z=h*G)}const We=z!==He,Ve=O!==Be;if(I||T){const K=I?$e-(z-ie):$e,le=T?ze-(O-Re):ze,he=K!==Oe&&We,ge=le!==_e&&Ve;if(he||ge){const be={id:Z.id,type:"position",position:{x:he?K:Oe,y:ge?le:_e}};X.push(be),s.current.x=be.position.x,s.current.y=be.position.y}}if(We||Ve){const K={id:C,type:"dimensions",updateStyle:!0,resizing:!0,dimensions:{width:z,height:O}};X.push(K),s.current.width=z,s.current.height=O}if(X.length===0)return;const pt=qt({width:s.current.width,prevWidth:He,height:s.current.height,prevHeight:Be,invertX:I,invertY:T}),Xe={...s.current,direction:pt};if((g==null?void 0:g(R,Xe))===!1)return;j==null||j(R,Xe),V(X)}}).on("end",R=>{const f={id:C,type:"dimensions",resizing:!1};S==null||S(R,{...s.current}),A.getState().triggerNodeChanges([f])});return x.call(L),()=>{x.on(".drag",null)}},[C,D,r,h,y,E,p,v,w,j,S]);const P=D.split("-"),H=a===oe.Line?"borderColor":"backgroundColor",W=m?{...u,[H]:m}:u;return J.createElement("div",{className:rt(["react-flow__resize-control","nodrag",...P,a,c]),ref:k,style:W},n)}var qe=l.memo(Kt);const Jt=["top-left","top-right","bottom-left","bottom-right"],Qt=["top","right","bottom","left"];function Zt({nodeId:e,isVisible:o=!0,handleClassName:a,handleStyle:c,lineClassName:u,lineStyle:n,color:m,minWidth:r=10,minHeight:h=10,maxWidth:y=Number.MAX_VALUE,maxHeight:E=Number.MAX_VALUE,keepAspectRatio:p=!1,shouldResize:g,onResizeStart:w,onResize:j,onResizeEnd:S}){return o?J.createElement(J.Fragment,null,Qt.map(M=>J.createElement(qe,{key:M,className:u,style:n,nodeId:e,position:M,variant:oe.Line,color:m,minWidth:r,minHeight:h,maxWidth:y,maxHeight:E,onResizeStart:w,keepAspectRatio:p,shouldResize:g,onResize:j,onResizeEnd:S})),Jt.map(M=>J.createElement(qe,{key:M,className:a,style:c,nodeId:e,position:M,color:m,minWidth:r,minHeight:h,maxWidth:y,maxHeight:E,onResizeStart:w,keepAspectRatio:p,shouldResize:g,onResize:j,onResizeEnd:S}))):null}var De={},eo=ht;Object.defineProperty(De,"__esModule",{value:!0});var Pe=De.default=void 0,to=eo(gt()),oo=t,ro=(0,to.default)((0,oo.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");Pe=De.default=ro;const so=ne(Ne)(({theme:e})=>({background:e.palette.card.main,color:e.darkTextPrimary,border:"solid 1px",width:"max-content",height:"auto",padding:"10px",boxShadow:"none"})),no=ne(ye)(({theme:e})=>({backgroundColor:e.palette.card.main,color:e.darkTextPrimary,padding:"5px",borderRadius:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)"})),lt=({data:e})=>{const o=fe(),a=ce(x=>x.customization),c=ce(x=>x.canvas),u=l.useRef(null),n=Ae(),[m,r]=l.useState(0),[h,y]=l.useState(!1),[E,p]=l.useState(""),{deleteNode:g,duplicateNode:w}=l.useContext(pe),[j,S]=l.useState(!1),[M,C]=l.useState({}),k=e.color||"#666666",b=()=>e.selected?k:h?re(k,.8):re(k,.5),s=()=>e.outputAnchors??[],v=x=>{var T;const I=(((T=u.current)==null?void 0:T.clientHeight)||0)/(s().length+1)*(x+1);return I>0&&n(e.id),I},B=()=>{const x=s().length;return Math.max(60,x*20+40)},D=()=>a.isDarkMode?h?Y(k,.7):Y(k,.8):h?se(k,.8):se(k,.9),P=x=>{switch(x){case"ERROR":return o.palette.error.dark;case"INPROGRESS":return o.palette.warning.dark;case"STOPPED":case"TERMINATED":return o.palette.error.main;case"FINISHED":return o.palette.success.dark;default:return o.palette.primary.dark}},H=x=>{const i=Ke.find(d=>d.name===x.name);return i?t.jsx(i.icon,{size:24,color:"white"}):null},W=x=>{switch(x){case"web_search_preview":return t.jsx(_t,{size:14,color:"white"});case"code_interpreter":return t.jsx(wt,{size:14,color:"white"});case"image_generation":return t.jsx(zt,{size:14,color:"white"});default:return null}};return l.useEffect(()=>{u.current&&setTimeout(()=>{var x,i;r(((x=u.current)==null?void 0:x.offsetTop)+((i=u.current)==null?void 0:i.clientHeight)/2),n(e.id)},10)},[e,u,n]),l.useEffect(()=>{const x=(I,T)=>`Node version ${I} outdated
Update to latest version ${T}`,i=I=>`Node outdated
Update to latest version ${I}`,d=c.componentNodes.find(I=>I.name===e.name);d&&(e.version?e.version&&d.version>e.version?p(x(e.version,d.version)):d.badge==="DEPRECATING"?p((d==null?void 0:d.deprecateMessage)??"This node will be deprecated in the next release. Change to a new node tagged with NEW"):p(""):p(i(d.version)))},[c.componentNodes,e.name,e.version]),t.jsxs("div",{ref:u,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:[t.jsx(no,{children:t.jsxs(Ee,{sx:{gap:1},variant:"outlined","aria-label":"Basic button group",children:[e.name!=="startAgentflow"&&t.jsx(q,{size:"small",title:"Duplicate",onClick:()=>{w(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.primary.main}},children:t.jsx(Me,{size:20})}),t.jsx(q,{size:"small",title:"Delete",onClick:()=>{g(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.error.main}},children:t.jsx(Te,{size:20})}),t.jsx(q,{size:"small",title:"Info",onClick:()=>{C({data:e}),S(!0)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.info.main}},children:t.jsx(Ie,{size:20})})]})}),t.jsxs(so,{content:!1,sx:{borderColor:b(),borderWidth:"1px",boxShadow:e.selected?`0 0 0 1px ${b()} !important`:"none",minHeight:B(),height:"auto",backgroundColor:D(),display:"flex",alignItems:"center","&:hover":{boxShadow:e.selected?`0 0 0 1px ${b()} !important`:"none"}},border:!1,children:[e&&e.status&&t.jsx(je,{title:e.status==="ERROR"?e.error||"Error":"",children:t.jsx(te,{variant:"rounded",sx:{...o.typography.smallAvatar,borderRadius:"50%",background:e.status==="STOPPED"||e.status==="TERMINATED"?"white":P(e.status),color:"white",ml:2,position:"absolute",top:-10,right:-10},children:e.status==="INPROGRESS"?t.jsx(et,{className:"spin-animation"}):e.status==="ERROR"?t.jsx(st,{}):e.status==="TERMINATED"?t.jsx(Pe,{sx:{color:P(e.status)}}):e.status==="STOPPED"?t.jsx(tt,{sx:{color:P(e.status)}}):t.jsx(Se,{})})}),E&&t.jsx(je,{placement:"right-start",title:t.jsx("span",{style:{whiteSpace:"pre-line"},children:E}),children:t.jsx(te,{variant:"rounded",sx:{...o.typography.smallAvatar,borderRadius:"50%",background:"white",position:"absolute",top:-10,left:-10},children:t.jsx(Bt,{color:"orange"})})}),t.jsxs(_,{sx:{width:"100%"},children:[!e.hideInput&&t.jsx(me,{type:"target",position:U.Left,id:e.id,style:{width:5,height:20,backgroundColor:"transparent",border:"none",position:"absolute",left:-2},children:t.jsx("div",{style:{width:5,height:20,backgroundColor:k,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[t.jsx(_,{item:!0,style:{width:50},children:e.color&&!e.icon?t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"15px",backgroundColor:e.color,cursor:"grab",display:"flex",justifyContent:"center",alignItems:"center",background:e.color},children:H(e)}):t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"50%",backgroundColor:"white",cursor:"grab"},children:t.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:`${ae}/api/v1/node-icon/${e.name}`,alt:e.name})})}),t.jsxs(_,{children:[t.jsx(de,{sx:{fontSize:"0.85rem",fontWeight:500},children:e.label}),(()=>{var i,d,I,T,L,R;return[{model:(i=e.inputs)==null?void 0:i.llmModel,config:(d=e.inputs)==null?void 0:d.llmModelConfig},{model:(I=e.inputs)==null?void 0:I.agentModel,config:(T=e.inputs)==null?void 0:T.agentModelConfig},{model:(L=e.inputs)==null?void 0:L.conditionAgentModel,config:(R=e.inputs)==null?void 0:R.conditionAgentModelConfig}].filter(f=>f.model&&f.config).map((f,V)=>t.jsx(_,{sx:{display:"flex",gap:1,mt:1},children:t.jsxs(_,{sx:{backgroundColor:a.isDarkMode?"rgba(255, 255, 255, 0.2)":"rgba(255, 255, 255, 0.9)",borderRadius:"16px",width:"max-content",height:24,pl:1,pr:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[t.jsx("img",{style:{width:20,height:20,objectFit:"contain"},src:`${ae}/api/v1/node-icon/${f.model}`,alt:f.model}),t.jsx(de,{sx:{fontSize:"0.7rem",ml:.5},children:f.config.modelName||f.config.model})]})},`model-${V}`))})(),(()=>{var i,d,I,T,L,R,f,V;return[{tools:(i=e.inputs)==null?void 0:i.llmTools,toolProperty:"llmSelectedTool"},{tools:(d=e.inputs)==null?void 0:d.agentTools,toolProperty:"agentSelectedTool"},{tools:((I=e.inputs)==null?void 0:I.selectedTool)??((T=e.inputs)==null?void 0:T.toolAgentflowSelectedTool)?[{selectedTool:((L=e.inputs)==null?void 0:L.selectedTool)??((R=e.inputs)==null?void 0:R.toolAgentflowSelectedTool)}]:[],toolProperty:["selectedTool","toolAgentflowSelectedTool"]},{tools:(f=e.inputs)==null?void 0:f.agentKnowledgeVSEmbeddings,toolProperty:["vectorStore","embeddingModel"]},{tools:(V=e.inputs)!=null&&V.agentToolsBuiltInOpenAI?(typeof e.inputs.agentToolsBuiltInOpenAI=="string"?JSON.parse(e.inputs.agentToolsBuiltInOpenAI):e.inputs.agentToolsBuiltInOpenAI).map($=>({builtInTool:$})):[],toolProperty:"builtInTool",isBuiltInOpenAI:!0}].filter($=>$.tools&&$.tools.length>0).map(($,Q)=>t.jsx(_,{sx:{display:"flex",gap:1,mt:1},children:$.tools.flatMap((Z,X)=>{if(Array.isArray($.toolProperty))return $.toolProperty.filter(F=>Z[F]).map((F,ee)=>{const ie=Z[F];return t.jsx(_,{component:"img",src:`${ae}/api/v1/node-icon/${ie}`,alt:ie,sx:{width:20,height:20,borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.2)",padding:.3}},`tool-${Q}-${X}-${ee}`)});{const F=Z[$.toolProperty];if(!F)return[];if($.isBuiltInOpenAI){const ee=W(F);return ee?[t.jsx(_,{sx:{width:20,height:20,borderRadius:"50%",backgroundColor:a.isDarkMode?Y(e.color,.5):Y(e.color,.2),display:"flex",justifyContent:"center",alignItems:"center",padding:.2},children:ee},`tool-${Q}-${X}`)]:[]}return[t.jsx(_,{component:"img",src:`${ae}/api/v1/node-icon/${F}`,alt:F,sx:{width:20,height:20,borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.2)",padding:.3}},`tool-${Q}-${X}`)]}})},`tools-${Q}`))})()]})]}),s().map((x,i)=>t.jsxs(me,{type:"source",position:U.Right,id:x.id,style:{height:20,width:20,top:v(i),backgroundColor:"transparent",border:"none",position:"absolute",right:-10,opacity:h?1:0,transition:"opacity 0.2s"},children:[t.jsx("div",{style:{position:"absolute",width:20,height:20,borderRadius:"50%",backgroundColor:o.palette.background.paper,pointerEvents:"none"}}),t.jsx(nt,{size:20,color:k,style:{pointerEvents:"none",position:"relative",zIndex:1}})]},x.id))]})]}),t.jsx(Ze,{show:j,dialogProps:M,onCancel:()=>S(!1)})]})};lt.propTypes={data:N.object};const Io=l.memo(lt),io=ne(Ne)(({theme:e})=>({background:e.palette.card.main,color:e.darkTextPrimary,border:"solid 1px",width:"max-content",height:"auto",padding:"10px",boxShadow:"none"})),lo=ne(ye)(({theme:e})=>({backgroundColor:e.palette.card.main,color:e.darkTextPrimary,padding:"5px",borderRadius:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)"})),at=({data:e})=>{const o=fe(),a=ce(i=>i.customization),c=l.useRef(null),u=l.useRef(null),n=Ae(),[m,r]=l.useState(0),[h,y]=l.useState(!1),{deleteNode:E,duplicateNode:p,reactFlowInstance:g}=l.useContext(pe),[w,j]=l.useState(!1),[S,M]=l.useState({}),[C,A]=l.useState({width:"300px",height:"250px"});l.useEffect(()=>{if(g){const i=g.getNodes().find(d=>d.id===e.id);i&&i.width&&i.height&&A({width:`${i.width}px`,height:`${i.height}px`})}},[g,e.id]);const b=e.color||"#666666",s=()=>e.selected?b:h?re(b,.8):re(b,.5),v=()=>e.outputAnchors??[],B=i=>{var L;const T=(((L=c.current)==null?void 0:L.clientHeight)||0)/(v().length+1)*(i+1);return T>0&&n(e.id),T},D=()=>{const i=v().length;return Math.max(60,i*20+40)},P=()=>a.isDarkMode?h?Y(b,.7):Y(b,.8):h?se(b,.8):se(b,.9),H=i=>{switch(i){case"ERROR":return o.palette.error.dark;case"INPROGRESS":return o.palette.warning.dark;case"STOPPED":case"TERMINATED":return o.palette.error.main;case"FINISHED":return o.palette.success.dark;default:return o.palette.primary.dark}},W=i=>{const d=Ke.find(I=>I.name===i.name);return d?t.jsx(d.icon,{size:24,color:"white"}):null};l.useEffect(()=>{c.current&&setTimeout(()=>{var i,d;r(((i=c.current)==null?void 0:i.offsetTop)+((d=c.current)==null?void 0:d.clientHeight)/2),n(e.id)},10)},[e,c,n]);const x=l.useCallback((i,d)=>{c.current&&A({width:`${d.width}px`,height:`${d.height}px`})},[c,A]);return t.jsxs("div",{ref:c,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:[t.jsx(ye,{align:"start",isVisible:!0,children:t.jsxs(_,{style:{display:"flex",alignItems:"center",flexDirection:"row"},children:[e.color&&!e.icon?t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"15px",backgroundColor:e.color,cursor:"grab",display:"flex",justifyContent:"center",alignItems:"center",background:e.color},children:W(e)}):t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"50%",backgroundColor:"white",cursor:"grab"},children:t.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:`${ae}/api/v1/node-icon/${e.name}`,alt:e.name})}),t.jsx(de,{sx:{fontSize:"0.85rem",fontWeight:500,ml:1},children:e.label})]})}),t.jsx(lo,{align:"end",children:t.jsxs(Ee,{sx:{gap:1},variant:"outlined","aria-label":"Basic button group",children:[t.jsx(q,{size:"small",title:"Duplicate",onClick:()=>{p(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.primary.main}},children:t.jsx(Me,{size:20})}),t.jsx(q,{size:"small",title:"Delete",onClick:()=>{E(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.error.main}},children:t.jsx(Te,{size:20})}),t.jsx(q,{size:"small",title:"Info",onClick:()=>{M({data:e}),j(!0)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.info.main}},children:t.jsx(Ie,{size:20})})]})}),t.jsx(Zt,{minWidth:300,minHeight:Math.max(D(),250),onResizeEnd:x}),t.jsxs(io,{content:!1,sx:{borderColor:s(),borderWidth:"1px",boxShadow:e.selected?`0 0 0 1px ${s()} !important`:"none",minHeight:Math.max(D(),250),minWidth:300,width:C.width,height:C.height,backgroundColor:P(),display:"flex","&:hover":{boxShadow:e.selected?`0 0 0 1px ${s()} !important`:"none"}},border:!1,children:[e&&e.status&&t.jsx(je,{title:e.status==="ERROR"?e.error||"Error":"",children:t.jsx(te,{variant:"rounded",sx:{...o.typography.smallAvatar,borderRadius:"50%",background:e.status==="STOPPED"||e.status==="TERMINATED"?"white":H(e.status),color:"white",ml:2,position:"absolute",top:-10,right:-10},children:e.status==="INPROGRESS"?t.jsx(et,{className:"spin-animation"}):e.status==="ERROR"?t.jsx(st,{}):e.status==="TERMINATED"?t.jsx(Pe,{sx:{color:H(e.status)}}):e.status==="STOPPED"?t.jsx(tt,{sx:{color:H(e.status)}}):t.jsx(Se,{})})}),t.jsxs(_,{sx:{width:"100%"},children:[!e.hideInput&&t.jsx(me,{type:"target",position:U.Left,id:e.id,style:{width:5,height:20,backgroundColor:"transparent",border:"none",position:"absolute",left:-2},children:t.jsx("div",{style:{width:5,height:20,backgroundColor:b,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})}),t.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:t.jsx(_,{sx:{height:`calc(${C.height} - 20px)`,width:`${C.width}`,overflow:"hidden",position:"relative",borderRadius:"10px"},children:t.jsx("div",{ref:u,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:o.palette.background.default},children:t.jsx(At,{color:"#aaa",gap:16})})})}),v().map((i,d)=>t.jsxs(me,{type:"source",position:U.Right,id:i.id,style:{height:20,width:20,top:B(d),backgroundColor:"transparent",border:"none",position:"absolute",right:-10,opacity:h?1:0,transition:"opacity 0.2s"},children:[t.jsx("div",{style:{position:"absolute",width:20,height:20,borderRadius:"50%",backgroundColor:o.palette.background.paper,pointerEvents:"none"}}),t.jsx(nt,{size:20,color:b,style:{pointerEvents:"none",position:"relative",zIndex:1}})]},i.id))]})]}),t.jsx(Ze,{show:w,dialogProps:S,onCancel:()=>j(!1)})]})};at.propTypes={data:N.object};const So=l.memo(at);function ct({transform:e,isHumanInput:o,label:a,color:c}){return t.jsx("div",{style:{position:"absolute",background:"transparent",left:o?10:0,paddingTop:1,color:c,fontSize:"0.5rem",fontWeight:700,transform:e,zIndex:1e3},className:"nodrag nopan",children:a})}ct.propTypes={transform:N.string,isHumanInput:N.bool,label:N.string,color:N.string};const xe=40,dt=({id:e,sourceX:o,sourceY:a,targetX:c,targetY:u,sourcePosition:n,targetPosition:m,data:r,markerEnd:h,selected:y})=>{const[E,p]=l.useState(!1),{deleteEdge:g}=l.useContext(pe),w=Je(),j=(s,v)=>{s.stopPropagation(),g(v),w({type:xt})},S=o===c,M=a===u,[C,A,k]=Et({sourceX:S?o+1e-4:o,sourceY:M?a+1e-4:a,sourcePosition:n,targetX:c,targetY:u,targetPosition:m}),b=`edge-gradient-${e}`;return t.jsxs(t.Fragment,{children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:b,children:[t.jsx("stop",{offset:"0%",stopColor:(r==null?void 0:r.sourceColor)||"#ae53ba"}),t.jsx("stop",{offset:"100%",stopColor:(r==null?void 0:r.targetColor)||"#2a8af6"})]})}),t.jsx("path",{id:`${e}-selector`,className:"agent-flow-edge-selector",style:{stroke:"transparent",strokeWidth:15,fill:"none",cursor:"pointer"},d:C,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)}),t.jsx("path",{id:e,className:"agent-flow-edge",style:{strokeWidth:y?3:2,stroke:`url(#${b})`,filter:y?"drop-shadow(0 0 3px rgba(0,0,0,0.3))":"none",cursor:"pointer",opacity:y?1:.75,fill:"none"},d:C,markerEnd:h,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1)}),(r==null?void 0:r.edgeLabel)&&t.jsx(Mt,{children:t.jsx(ct,{isHumanInput:r==null?void 0:r.isHumanInput,color:(r==null?void 0:r.sourceColor)||"#ae53ba",label:r.edgeLabel,transform:`translate(-50%, 0%) translate(${o}px,${a}px)`})}),E&&t.jsx("foreignObject",{width:xe,height:xe,x:A-xe/2,y:k-xe/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:t.jsx("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"all"},children:t.jsx("button",{className:"edgebutton",onClick:s=>j(s,e),style:{width:"12px",height:"12px",background:`linear-gradient(to right, ${(r==null?void 0:r.sourceColor)||"#ae53ba"}, ${(r==null?void 0:r.targetColor)||"#2a8af6"})`,border:"none",borderRadius:"50%",cursor:"pointer",fontSize:"10px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",boxShadow:"0 0 4px rgba(0,0,0,0.3)",transition:"all 0.2s ease-in-out",padding:"2px"},onMouseOver:s=>{s.currentTarget.style.transform="scale(1.2)",s.currentTarget.style.boxShadow="0 0 8px rgba(0,0,0,0.4)"},onFocus:s=>{s.currentTarget.style.transform="scale(1.2)",s.currentTarget.style.boxShadow="0 0 8px rgba(0,0,0,0.4)"},onMouseOut:s=>{s.currentTarget.style.transform="scale(1)",s.currentTarget.style.boxShadow="0 0 4px rgba(0,0,0,0.3)"},onBlur:s=>{s.currentTarget.style.transform="scale(1)",s.currentTarget.style.boxShadow="0 0 4px rgba(0,0,0,0.3)"},children:t.jsx(Qe,{stroke:2,size:"12",color:"white"})})})})]})};dt.propTypes={id:N.string,sourceX:N.number,sourceY:N.number,targetX:N.number,targetY:N.number,sourcePosition:N.any,targetPosition:N.any,style:N.object,data:N.object,markerEnd:N.any,selected:N.bool};const No=l.memo(dt),ao=ne(Ne)(({theme:e})=>({background:e.palette.card.main,color:e.darkTextPrimary,border:"solid 1px",width:"max-content",height:"auto",padding:"10px",boxShadow:"none"})),co=ne(ye)(({theme:e})=>({backgroundColor:e.palette.card.main,color:e.darkTextPrimary,padding:"5px",borderRadius:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)"})),uo=({data:e})=>{const o=fe(),a=ce(j=>j.customization),c=l.useRef(null),{reactFlowInstance:u,deleteNode:n,duplicateNode:m}=l.useContext(pe),[r]=e.inputParams,[h,y]=l.useState(!1),p=e.color||"#666666",g=()=>e.selected?p:h?re(p,.8):re(p,.5),w=()=>a.isDarkMode?h?Y(p,.7):Y(p,.8):h?se(p,.8):se(p,.9);return t.jsxs("div",{ref:c,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),children:[t.jsx(co,{children:t.jsxs(Ee,{sx:{gap:1},variant:"outlined","aria-label":"Basic button group",children:[t.jsx(q,{size:"small",title:"Duplicate",onClick:()=>{m(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.primary.main}},children:t.jsx(Me,{size:20})}),t.jsx(q,{size:"small",title:"Delete",onClick:()=>{n(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.error.main}},children:t.jsx(Te,{size:20})})]})}),t.jsx(ao,{content:!1,sx:{borderColor:g(),borderWidth:"1px",boxShadow:e.selected?`0 0 0 1px ${g()} !important`:"none",minHeight:60,height:"auto",backgroundColor:w(),display:"flex",alignItems:"center","&:hover":{boxShadow:e.selected?`0 0 0 1px ${g()} !important`:"none"}},border:!1,children:t.jsx(_,{children:t.jsx(Dt,{placeholder:r.placeholder,inputParam:r,onChange:j=>e.inputs[r.name]=j,value:e.inputs[r.name]??r.default??"",nodes:u?u.getNodes():[],edges:u?u.getEdges():[],nodeId:e.id},e.id)})})]})};uo.propTypes={data:N.object};const ut=({show:e,dialogProps:o,onCancel:a})=>{const c=document.getElementById("portal"),u=Je(),n=fe(),m=ce(s=>s.customization),r=l.useRef(),{reactFlowInstance:h}=l.useContext(pe),y=Ae(),[E,p]=l.useState([]),[g,w]=l.useState({}),[j,S]=l.useState(null),[M,C]=l.useState(""),A=()=>{h.setNodes(s=>s.map(v=>(v.id===g.id&&(v.data={...v.data,label:r.current.value},w(v.data)),v))),y(g.id)},k=({nodeId:s,inputParam:v,newValue:B})=>{h.setNodes(D=>D.map(P=>{if(P.id===s){const H={...P.data.inputs,[v.name]:B},W=bt({...P.data,inputs:H});Object.keys(H).forEach(x=>{const i=W.find(d=>d.name===x);i&&i.display===!1&&delete H[x]}),P.data={...P.data,inputParams:W,inputs:H},p(W),w(P.data)}return P}))};l.useEffect(()=>(o.inputParams&&p(o.inputParams),o.data&&(w(o.data),o.data.label&&C(o.data.label)),()=>{p([]),w({})}),[o]),l.useEffect(()=>(u(e?{type:mt}:{type:Ge}),()=>u({type:Ge})),[e,u]);const b=e?t.jsx(ft,{onClose:a,open:e,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:t.jsxs(yt,{children:[g&&g.name&&t.jsx(_,{sx:{width:"100%"},children:j?t.jsxs(ve,{flexDirection:"row",sx:{width:"100%"},children:[t.jsx(Pt,{autoFocus:!0,size:"small",sx:{width:"100%",ml:2},inputRef:r,defaultValue:M,onKeyDown:s=>{s.key==="Enter"?(g.label=r.current.value,C(r.current.value),A(),S(!1)):s.key==="Escape"&&S(!1)}}),t.jsx(we,{title:"Save Name",sx:{borderRadius:"50%"},children:t.jsx(te,{variant:"rounded",sx:{...n.typography.commonAvatar,...n.typography.mediumAvatar,transition:"all .2s ease-in-out",background:n.palette.success.light,color:n.palette.success.dark,ml:1,"&:hover":{background:n.palette.success.dark,color:n.palette.success.light}},color:"inherit",onClick:()=>{g.label=r.current.value,C(r.current.value),A(),S(!1)},children:t.jsx(Se,{stroke:1.5,size:"1rem"})})}),t.jsx(we,{title:"Cancel",sx:{borderRadius:"50%"},children:t.jsx(te,{variant:"rounded",sx:{...n.typography.commonAvatar,...n.typography.mediumAvatar,transition:"all .2s ease-in-out",background:n.palette.error.light,color:n.palette.error.dark,ml:1,"&:hover":{background:n.palette.error.dark,color:n.palette.error.light}},color:"inherit",onClick:()=>S(!1),children:t.jsx(Qe,{stroke:1.5,size:"1rem"})})})]}):t.jsxs(ve,{flexDirection:"row",sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(de,{sx:{ml:2,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},variant:"h4",children:M}),(g==null?void 0:g.id)&&t.jsx(we,{title:"Edit Name",sx:{borderRadius:"50%"},children:t.jsx(te,{variant:"rounded",sx:{...n.typography.commonAvatar,...n.typography.mediumAvatar,transition:"all .2s ease-in-out",ml:1,background:n.palette.secondary.light,color:n.palette.secondary.dark,"&:hover":{background:n.palette.secondary.dark,color:n.palette.secondary.light}},color:"inherit",onClick:()=>S(!0),children:t.jsx(vt,{stroke:1.5,size:"1rem"})})})]})}),(g==null?void 0:g.hint)&&t.jsxs(ve,{direction:"row",alignItems:"center",sx:{ml:2,backgroundColor:m.isDarkMode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.03)",borderRadius:"8px",mr:2,px:1.5,py:1,mt:1,mb:1,border:`1px solid ${m.isDarkMode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.08)"}`},children:[t.jsx(Ie,{size:"1rem",stroke:1.5,color:n.palette.info.main,style:{marginRight:"6px"}}),t.jsx(de,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic",lineHeight:1.2},children:g.hint})]}),E.filter(s=>s.display!==!1).map((s,v)=>t.jsx(Tt,{disabled:o.disabled,inputParam:s,data:g,isAdditionalParams:!0,onCustomDataChange:k},v))]})}):null;return Ue.createPortal(b,c)};ut.propTypes={show:N.bool,dialogProps:N.object,onCancel:N.func};const Eo=l.memo(ut);export{No as A,Eo as E,So as I,uo as S,Io as a};
