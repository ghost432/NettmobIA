import{af as ee,f as te,u as oe,a as re,s as se,r as s,O as ae,t as ie,ak as ne,c as k,aq as ce,ar as de,j as e,M as W,S as le,ac as pe,aj as c,B as g,o as m,a5 as me,h as ue,as as P,d as he,y as xe,ah as fe,ag as ge,q as F,i as $,L as ve,N as ye}from"./index-B5bgjFPS.js";import{R as je}from"./main-Dw2W3SKo.js";import{d as Se}from"./DynamicFeed-CM5XErNX.js";import{c as ke}from"./chunks_empty-fFmvGjOz.js";import{B as Ce}from"./BackdropLoader-Ch3nVEPr.js";import{C as be}from"./ConfirmDialog-Dfe34hOz.js";import{E as De}from"./ExpandedChunkDialog-DigJE3y9.js";import{V as we}from"./ViewHeader-t5dVj9Vk.js";import{D as Ee}from"./DocStoreInputHandler-BDJBQrwa.js";import{d as C}from"./documentstore-CRtiIDJT.js";import{n as Ie}from"./nodes-Qb-8otVq.js";import{v as Re}from"./v4-CtRu48qb.js";import{I as Te}from"./IconDeviceFloppy-BsK1tbgI.js";import{b as Ne}from"./IconSearch-4bUU90FL.js";import"./CodeEditor-BbQJOBPh.js";import"./index-C-cusT-F.js";import"./IconTrash-CekgWF9B.js";import"./IconLanguage-BXvwKb3u.js";import"./StyledFab-DFomU4Vk.js";import"./Dropdown-D8Rr64ju.js";import"./FormControl-o0rphY-g.js";import"./Autocomplete-CinIIKT5.js";import"./Close-DT9tpzn1.js";import"./TextField-OmGdqrIf.js";import"./InputLabel-BtU13bbu.js";import"./MultiDropdown-BUXEvYds.js";import"./CredentialInputHandler-C4W2GUgN.js";import"./CredentialListDialog-ZkUPpHPz.js";import"./TooltipWithParser-D26Faoyy.js";import"./index-D--Rb2MU.js";import"./Tooltip-CXmeiPEa.js";import"./Input-CajAyvOv.js";import"./ListItem-BfStHUI0.js";import"./Switch-D5M093wC.js";import"./IconArrowsMaximize-BLCViMbK.js";import"./IconAlertTriangle-7YQ2ldQl.js";import"./InputAdornment-v58Edx4J.js";import"./Delete-4D-T7tnN.js";import"./IconPlus-j8jP5X4Z.js";import"./GridActionsCellItem-B3aQ_RGo.js";import"./Grid-DGDGmzGP.js";import"./toPropertyKey-C9c9JG92.js";import"./createStyled-DlEbU-rO.js";import"./KeyboardArrowRight-BvTOCIXU.js";import"./LastPage--XaxDP-k.js";import"./Skeleton-DJP3nnUt.js";import"./File-km8sc6Tq.js";import"./suggestionOption-DCQ-1oAJ.js";import"./TabPanel-C-h4h7GL.js";import"./ExpandMore-BZIzyY2F.js";import"./MemoizedReactMarkdown-mGWPD7hJ.js";import"./unsupportedIterableToArray-Bh0GkvIo.js";import"./ExpandTextDialog-XWdUWqGp.js";import"./LoadingButton-CJHvS9bV.js";import"./IconRefresh-CtZoTUkg.js";import"./ToolDialog-DZ6z_iak.js";import"./ExportAsTemplateDialog-481ESzFy.js";import"./AssistantDialog-CJzYVebb.js";import"./assistants-DZYxhrU8.js";import"./Stepper-BCbMjc86.js";import"./string-BbYD24iH.js";import"./IconBulb-BQTovKvQ.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M5 21h14",key:"svg-2"}],["path",{d:"M5 18h14",key:"svg-3"}],["path",{d:"M5 15h14",key:"svg-4"}]],qe=ee("outline","file-stack","FileStack",Ve),Ae=xe(W)(({theme:x})=>({background:x.palette.card.main,color:x.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:x.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),Lt=()=>{const x=te(t=>t.customization),b=oe(),O=re(),D=se(),f=s.useRef(null),{hasAssignedWorkspace:_}=ae();ie();const w=(...t)=>D(ve(...t)),E=(...t)=>D(ye(...t)),{storeId:j}=ne(),[d,I]=s.useState([]),[R,l]=s.useState(!1),[L,T]=s.useState(!1),[H,z]=s.useState({}),[u,G]=s.useState({}),[v,Q]=s.useState(""),[N,V]=s.useState(-1),[q,A]=s.useState(void 0),h=k(C.getSpecificDocumentStore),i=k(C.queryVectorStore),y=k(Ie.getSpecificNode),[r,B]=s.useState({}),K=({inputParam:t,newValue:o})=>{B(p=>{const n={...p};return n.inputs[t.name]=o,n.inputParams=P(n),n})},U=(t,o)=>{const n={data:{selectedChunk:d.find(a=>a.id===t),selectedChunkNumber:o}};z(n),T(!0)},J=t=>{const o=t.isComposing||t.keyCode===229;t.key==="Enter"&&v&&!o?!t.shiftKey&&v&&(f.current&&f.current.blur(),M()):t.key==="Enter"&&t.preventDefault()},M=()=>{l(!0);const t={query:v,storeId:j,inputs:r.inputs};i.request(t)},X=async()=>{var o,p,n;l(!0);const t={storeId:j};r.inputs&&(t.vectorStoreConfig={},t.vectorStoreName=r.name,Object.keys(r.inputs).map(a=>{a==="FLOWISE_CREDENTIAL_ID"?t.vectorStoreConfig.credential=r.inputs[a]:t.vectorStoreConfig[a]=r.inputs[a]}));try{const a=await C.updateVectorStoreConfig(t);l(!1),a.data&&w({message:"Vector Store Config Successfully Updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:S=>e.jsx(F,{style:{color:"white"},onClick:()=>E(S),children:e.jsx($,{})})}})}catch(a){l(!1);const S=((o=a.response)==null?void 0:o.data)||`${(p=a.response)==null?void 0:p.status}: ${(n=a.response)==null?void 0:n.statusText}`;w({message:`Failed to update vector store config: ${S}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Z=>e.jsx(F,{style:{color:"white"},onClick:()=>E(Z),children:e.jsx($,{})})}})}};s.useEffect(()=>{i.data&&(I(i.data.docs),V(i.data.timeTaken),A(void 0),l(!1),f.current&&f.current.focus())},[i.data]),s.useEffect(()=>{var t,o;if(i.error){if((o=(t=i.error.response)==null?void 0:t.data)!=null&&o.message){const p=i.error.response.data.message;A(p.replace("documentStoreServices.queryVectorStore - ","")),I([]),V(-1)}l(!1)}},[i.error]),s.useEffect(()=>{if(y.data){const t=y.data;Y(t)}},[y.data]);const Y=t=>{const o=ce.cloneDeep(de(t,Re()));u.vectorStoreConfig&&(o.inputs=u.vectorStoreConfig.config,o.credential=u.vectorStoreConfig.config.credential),B(o)};return s.useEffect(()=>{h.request(j)},[]),s.useEffect(()=>{if(h.data){if(!_(h.data.workspaceId)){b("/unauthorized");return}G(h.data);const t=h.data.vectorStoreConfig;t&&y.request(t.name),l(!1)}},[h.data]),e.jsxs(e.Fragment,{children:[e.jsx(W,{style:{position:"relative"},children:e.jsxs(le,{flexDirection:"column",sx:{gap:1},children:[e.jsx(we,{isBackButton:!0,search:!1,title:(u==null?void 0:u.name)||"Document Store",description:"Retrieval Playground - Test your vector store retrieval settings",onBack:()=>b(-1),children:e.jsx(pe,{permissionId:"documentStores:upsert-config",variant:"outlined",color:"secondary",sx:{borderRadius:2,height:"100%"},startIcon:e.jsx(Te,{}),onClick:X,children:"Save Config"})}),e.jsx("div",{style:{width:"100%"}}),e.jsx("div",{children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{sx:{ml:1,mr:1},item:!0,xs:12,sm:12,md:12,lg:12,children:e.jsxs(g,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(m,{variant:"overline",children:["Enter your Query",e.jsx("span",{style:{color:"red"},children:"Â *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(me,{size:"small",multiline:!0,rows:4,sx:{mt:1},type:"string",fullWidth:!0,inputRef:f,onChange:t=>Q(t.target.value),onKeyDown:J,value:v??"",endAdornment:e.jsx(ue,{variant:"contained",onClick:M,children:e.jsx(Ne,{})})})]})}),e.jsxs(c,{sx:{ml:1,mr:1,mt:1},container:!0,spacing:1,children:[e.jsx(c,{item:!0,xs:12,sm:4,md:4,children:e.jsx(g,{children:e.jsx(c,{container:!0,spacing:"2",children:e.jsx(c,{item:!0,xs:12,md:12,lg:12,sm:12,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15,paddingTop:5},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:1},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:r.label?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:r.label??"embeddings",src:`${he}/api/v1/node-icon/${r==null?void 0:r.name}`}):e.jsx(Se,{color:"black"})}),e.jsx(m,{sx:{ml:2},variant:"h3",children:r.label}),e.jsx("div",{style:{flex:1}})]}),r&&Object.keys(r).length>0&&P(r).filter(t=>!t.hidden&&t.display!==!1).map((t,o)=>e.jsx(Ee,{data:r,inputParam:t,isAdditionalParams:t.additionalParams,onNodeDataChange:K},o))]})})})})}),e.jsxs(c,{item:!0,xs:12,sm:8,md:8,children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:1,paddingTop:2,marginBottom:4},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:e.jsx(qe,{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"}})}),e.jsxs(m,{sx:{ml:2},variant:"h3",children:["Retrieved Documents",N>-1&&e.jsxs(m,{variant:"body2",sx:{color:"gray"},children:["Count: ",d.length,". Time taken: ",N," millis."]}),q&&e.jsx(m,{variant:"body2",sx:{color:"gray"},children:q})]}),e.jsx("div",{style:{flex:1}})]}),!d.length&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[e.jsx(g,{sx:{mt:5,p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:ke,alt:"chunks_emptySVG"})}),e.jsx("div",{children:"No Documents Retrieved"})]}),e.jsx(c,{container:!0,spacing:2,children:(d==null?void 0:d.length)>0&&d.map((t,o)=>e.jsx(c,{item:!0,lg:6,md:6,sm:6,xs:6,children:e.jsx(Ae,{content:!1,onClick:()=>U(t.id,t.chunkNo),sx:{border:1,borderColor:O.palette.grey[900]+25,borderRadius:2},children:e.jsx(fe,{children:e.jsxs(ge,{sx:{p:2},children:[e.jsx(m,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${t.chunkNo}. Characters: ${t.pageContent.length}`}),e.jsx(m,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(je,{theme:x.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata||{},name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:!0})]})})})},o))})]})]})]})})]})}),e.jsx(be,{}),e.jsx(De,{show:L,dialogProps:H,onCancel:()=>T(!1),isReadOnly:!0}),R&&e.jsx(Ce,{open:R})]})};export{Lt as default};
