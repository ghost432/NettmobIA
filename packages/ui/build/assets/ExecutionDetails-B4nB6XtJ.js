import{af as Me,k as $e,l as ze,j as e,a as se,s as ge,f as Ie,r as E,c as be,D as Oe,m as We,n as Fe,o as G,B as v,q as B,w as qe,L as ee,i as te,N as oe,P as p,C as Y,b9 as He,ci as Be,Z as Ge,h as Ue,a_ as Ve,y as ie,A as ye,bL as Xe,K as Ye,cL as Ke}from"./index-B5bgjFPS.js";import{e as je,R as Ze,N as Je,u as Qe,T as et,b as tt,c as ot,f as nt,g as st,h as it,d as rt,a as at,i as lt,j as ct,k as dt}from"./NodeExecutionDetails-DG6IJuTk.js";import{I as ne,d as ut}from"./StopCircle-Dr72dSBy.js";import{T as ve}from"./Tooltip-CXmeiPEa.js";import{I as Ee}from"./IconCopy-bbAsun7S.js";import{I as pt}from"./IconShare-D3uBFiqr.js";import{I as ft}from"./IconRefresh-CtZoTUkg.js";import{I as xt}from"./IconCircleXFilled-6uNExu9P.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M9 15l6 -6",key:"svg-0"}],["path",{d:"M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464",key:"svg-1"}],["path",{d:"M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463",key:"svg-2"}]],mt=Me("outline","link","Link",ht);var re={},gt=$e;Object.defineProperty(re,"__esModule",{value:!0});var Ne=re.default=void 0,It=gt(ze()),bt=e,yt=(0,It.default)((0,bt.jsx)("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"}),"DragHandle");Ne=re.default=yt;const we=({show:n,executionId:x,onClose:m,onUnshare:l})=>{const I=document.getElementById("portal"),N=se(),y=ge(),D=Ie(A=>A.customization),[W,L]=E.useState(!1),F=be(je.updateExecution),q=`${window.location.origin}/execution/${x}`,S=()=>{navigator.clipboard.writeText(q),L(!0),y(ee({message:"Link copied to clipboard",options:{key:new Date().getTime()+Math.random(),variant:"success",action:A=>e.jsx(B,{style:{color:"white"},onClick:()=>y(oe(A)),children:e.jsx(te,{})})}})),setTimeout(()=>{L(!1)},2e3)},w=()=>{F.request(x,{isPublic:!1}),l&&l(),m()},R=n?e.jsxs(Oe,{open:n,onClose:m,maxWidth:"sm",fullWidth:!0,"aria-labelledby":"share-dialog-title",children:[e.jsx(We,{id:"share-dialog-title",sx:{fontSize:"1.1rem",fontWeight:600},children:"Public Trace Link"}),e.jsxs(Fe,{children:[e.jsx(G,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Anyone with the link below can view this execution trace."}),e.jsxs(v,{sx:{display:"flex",alignItems:"center",mb:3,p:1,border:`1px solid ${N.palette.divider}`,borderRadius:"8px",backgroundColor:D.isDarkMode?N.palette.background.paper:N.palette.grey[100]},children:[e.jsx(mt,{size:20,style:{marginRight:"8px",color:N.palette.text.secondary}}),e.jsx(G,{variant:"body2",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",color:N.palette.primary.main,mr:1},children:q}),e.jsx(ve,{title:W?"Copied!":"Copy link",children:e.jsx(B,{variant:"text",color:"primary",onClick:S,startIcon:e.jsx(Ee,{size:18}),children:"Copy"})})]}),e.jsxs(v,{sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(B,{color:"error",onClick:w,sx:{mr:1},children:"Unshare"}),e.jsx(B,{onClick:m,children:"Close"})]})]})]}):null;return qe.createPortal(R,I)};we.propTypes={show:p.bool,executionId:p.string,onClose:p.func,onUnshare:p.func};const jt=n=>{switch(n){case"FINISHED":return"success.dark";case"ERROR":case"TIMEOUT":return"error.main";case"TERMINATED":case"STOPPED":return"error.main";case"INPROGRESS":return"warning.dark"}},vt=ie(lt)(({theme:n})=>({color:n.palette.grey[400]})),Et=ie(ct)(({theme:n})=>({flexDirection:"row-reverse",borderRadius:n.spacing(.7),marginBottom:n.spacing(.5),marginTop:n.spacing(.5),padding:n.spacing(.5),paddingRight:n.spacing(1),fontWeight:500,"&.Mui-expanded ":{"&:not(.Mui-focused, .Mui-selected, .Mui-selected.Mui-focused) .labelIcon":{color:n.palette.primary.dark,...n.applyStyles("light",{color:n.palette.primary.main})},"&::before":{content:'""',display:"block",position:"absolute",left:"16px",top:"44px",height:"calc(100% - 48px)",width:"1.5px",backgroundColor:n.palette.grey[700],...n.applyStyles("light",{backgroundColor:n.palette.grey[300]})}},"&:hover":{backgroundColor:Ye(n.palette.primary.main,.1),color:"white",...n.applyStyles("light",{color:n.palette.primary.main})},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:n.palette.primary.dark,color:n.palette.primary.contrastText,...n.applyStyles("light",{backgroundColor:n.palette.primary.main})}})),Nt=ie(G)(({theme:n})=>({color:n.palette.text.primary}));function ae({icon:n,itemStatus:x,children:m,name:l,...I}){const N=l==="iterationAgentflow";return e.jsxs(dt,{...I,sx:{display:"flex",alignItems:"center"},children:[(()=>{if(N)return e.jsx(v,{sx:{mr:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ke,{size:20,color:"#9C89B8"})});const y=ye.find(D=>D.name===l);return y?e.jsx(v,{sx:{mr:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(y.icon,{size:20,color:y.color})}):null})(),e.jsx(Nt,{sx:{flex:1},children:m}),n&&e.jsx(v,{component:n,className:"labelIcon",color:jt(x),sx:{ml:1,fontSize:"1.2rem"}})]})}ae.propTypes={icon:p.func,itemStatus:p.string,children:p.node,name:p.string};ae.displayName="CustomLabel";const Ce=n=>Array.isArray(n)?n.length>0&&n.some(Ce):!!n,wt=(n,x)=>{switch(n){case"FINISHED":return at;case"ERROR":case"TIMEOUT":return rt;case"TERMINATED":return m=>{const l=I=>e.jsx(xt,{...I,color:x.palette.error.main});return l.displayName="TerminatedIcon",e.jsx(l,{...m})};case"STOPPED":return ut;case"INPROGRESS":return m=>{const l=I=>e.jsx(ne,{...I,color:x.palette.warning.dark,className:`spin-animation ${I.className||""}`});return l.displayName="InProgressIcon",e.jsx(l,{...m})}}},Te=E.forwardRef(function(x,m){var V;const{id:l,itemId:I,label:N,disabled:y,children:D,...W}=x,L=se(),{getRootProps:F,getContentProps:U,getIconContainerProps:q,getCheckboxProps:S,getLabelProps:w,getGroupTransitionProps:R,getDragAndDropOverlayProps:A,status:M,publicAPI:K}=Qe({id:l,itemId:I,children:D,label:N,disabled:y,rootRef:m}),T=K.getItem(I),i=Ce(D);let H;return T.status&&(H=wt(T.status,L)),e.jsx(et,{itemId:I,children:e.jsxs(vt,{...F(W),children:[e.jsxs(Et,{...U(),children:[e.jsx(tt,{...q(),children:e.jsx(ot,{status:M})}),e.jsx(nt,{...S()}),e.jsx(ae,{...w({icon:H,itemStatus:T.status,expandable:i&&M.expanded,name:T.name||((V=T.id)==null?void 0:V.split("_")[0])})}),e.jsx(st,{...A()})]}),D&&e.jsx(it,{...R(),style:{borderLeft:`${M.selected?"3px solid":"1px dashed"} ${(()=>{var $;const Z=T.name||(($=T.id)==null?void 0:$.split("_")[0]),C=ye.find(J=>J.name===Z);return C?C.color:L.palette.primary.main})()}`,marginLeft:"13px",paddingLeft:"8px"}})]})})});Te.propTypes={id:p.string,itemId:p.string,label:p.string,disabled:p.bool,children:p.node,className:p.string};const Ct=400,Tt=window.innerWidth-400,me=window.innerWidth,ke=({open:n,isPublic:x,execution:m,metadata:l,onClose:I,onProceedSuccess:N,onUpdateSharing:y,onRefresh:D})=>{var pe,fe;const[W,L]=E.useState(Math.min(Tt,me)),[F,U]=E.useState([]),[q,S]=E.useState([]),[w,R]=E.useState(null),[A,M]=E.useState(!1),[K,T]=E.useState(!1),[i,H]=E.useState({}),V=se(),Z=Ie(t=>t.customization),C=be(je.updateExecution),$=ge();E.useEffect(()=>{l&&H(l)},[l]);const J=()=>{navigator.clipboard.writeText(i==null?void 0:i.id),T(!0),$(ee({message:"ID copied to clipboard",options:{key:new Date().getTime()+Math.random(),variant:"success",action:t=>e.jsx(B,{style:{color:"white"},onClick:()=>$(oe(t)),children:e.jsx(te,{})})}})),setTimeout(()=>{T(!1)},2e3)},le=()=>{document.addEventListener("mousemove",ce),document.addEventListener("mouseup",de)},ce=E.useCallback(t=>{const s=document.body.offsetWidth-t.clientX;s>=Ct&&s<=me&&L(s)},[]),de=()=>{document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",de)},X=t=>{let s=[];return t.forEach(h=>{s.push(h.id),h.children&&h.children.length>0&&(s=[...s,...X(h.children)])}),s},De=t=>{t.forEach(o=>{const a=r=>{for(const c in r)c===Xe&&delete r[c],typeof r[c]=="object"&&a(r[c])};a(o.data)});const s=new Map;t.forEach((o,a)=>{const r=`${o.nodeId}_${a}`;s.set(r,{...o,uniqueNodeId:r,children:[],executionIndex:a})});const h=new Map;t.forEach((o,a)=>{var r,c;if((r=o.data)!=null&&r.parentNodeId&&((c=o.data)==null?void 0:c.iterationIndex)!==void 0){const d=o.data.parentNodeId,f=o.data.iterationIndex;h.has(d)||h.set(d,new Map);const u=h.get(d);u.has(f)||u.set(f,[]),u.get(f).push(`${o.nodeId}_${a}`)}}),h.forEach((o,a)=>{o.forEach((r,c)=>{var xe;let d=null;for(let b=0;b<t.length;b++)if(t[b].nodeId===a){d=t[b];break}if(!d)return;const f=r[0],u=s.get(f),j=((xe=u==null?void 0:u.data)==null?void 0:xe.iterationContext)||{index:c},g=`${a}_${c}`,k=`Iteration #${c}`,Q=r.map(b=>s.get(b)),Le=Q.some(b=>b.status==="ERROR")?"ERROR":Q.some(b=>b.status==="INPROGRESS")?"INPROGRESS":Q.every(b=>b.status==="FINISHED")?"FINISHED":"UNKNOWN",Ae={nodeId:g,nodeLabel:k,data:{name:"iterationAgentflow",iterationIndex:c,iterationContext:j,isVirtualNode:!0,parentIterationId:a},previousNodeIds:[],status:Le,uniqueNodeId:g,children:[],executionIndex:-1};s.set(g,Ae),r.forEach(b=>{const he=s.get(b);he&&(he.virtualParentId=g)})})});const z=[],P=new Set;t.forEach((o,a)=>{var d,f;const r=`${o.nodeId}_${a}`,c=s.get(r);if(!((d=o.data)!=null&&d.parentNodeId&&((f=o.data)==null?void 0:f.iterationIndex)!==void 0))if(o.previousNodeIds.length===0)z.push(c);else{let u=-1,j=null;if(o.previousNodeIds.forEach(g=>{for(let k=0;k<a;k++)t[k].nodeId===g&&k>u&&(u=k,j=g)}),u!==-1){const g=`${j}_${u}`,k=s.get(g);k&&(k.children.push(c),P.add(r))}}}),h.forEach((o,a)=>{const r=[];t.forEach((d,f)=>{d.nodeId===a&&r.push(`${d.nodeId}_${f}`)});let c=null;for(let d=r.length-1;d>=0;d--){const f=r[d],u=s.get(f);if(u){c=u;break}}c&&o.forEach((d,f)=>{const u=`${a}_${f}`,j=s.get(u);j&&c.children.push(j)})}),s.forEach(o=>{if(o.virtualParentId){const a=s.get(o.virtualParentId);if(a)if(o.previousNodeIds.length===0)a.children.push(o);else{let r=!1;for(const c of o.previousNodeIds)s.forEach(d=>{var f,u,j,g;d.nodeId===c&&((f=d.data)==null?void 0:f.iterationIndex)===((u=o.data)==null?void 0:u.iterationIndex)&&((j=d.data)==null?void 0:j.parentNodeId)===((g=o.data)==null?void 0:g.parentNodeId)&&!r&&(d.children.push(o),r=!0)});r||a.children.push(o)}}});const _=o=>{o.children&&o.children.length>0&&(o.children.sort((a,r)=>{var f,u,j,g;const c=((f=a.data)==null?void 0:f.name)==="iterationAgentflow"||((u=a.data)==null?void 0:u.isVirtualNode),d=((j=r.data)==null?void 0:j.name)==="iterationAgentflow"||((g=r.data)==null?void 0:g.isVirtualNode);return c===d?a.executionIndex-r.executionIndex:c?-1:1}),o.children.forEach(_))};z.forEach(_);const O=o=>{var a;return{id:o.uniqueNodeId,label:o.nodeLabel,name:(a=o.data)==null?void 0:a.name,status:o.status,data:o.data,children:o.children.map(O)}};return z.map(O)},Se=(t,s)=>{S(s)},Re=()=>{const t=!i.isPublic;C.request(i.id,{isPublic:t}).then(()=>{H(s=>({...s,isPublic:t})),$(ee({message:t?"Execution shared publicly":"Execution is no longer public",options:{key:new Date().getTime()+Math.random(),variant:"success",action:s=>e.jsx(B,{style:{color:"white"},onClick:()=>$(oe(s)),children:e.jsx(te,{})})}})),y&&y()})};E.useEffect(()=>{if(m){const t=De(m);if((l==null?void 0:l.state)==="STOPPED"){const s=z=>{for(const P of z){if(P.status==="STOPPED")return P;if(P.children){const _=s(P.children);if(_)return _}}return null},h=s(t);h?(S(X(t)),R(h)):(S(X(t)),t.length>0&&R(t[0]))}else S(X(t)),t.length>0&&R(t[0]);U(t)}},[m,l]);const Pe=(t,s)=>{const h=(P,_)=>{for(const O of P){if(O.id===_)return O;if(O.children){const o=h(O.children,_);if(o)return o}}return null},z=h(F,s);R(z)},ue=e.jsxs(v,{sx:{display:"flex",height:"100%",flexDirection:"row"},children:[e.jsxs(v,{sx:{flex:"1 1 35%",padding:2,borderRight:1,borderColor:"divider",overflow:"auto"},children:[e.jsx(v,{sx:{pb:1,mb:2,backgroundColor:t=>t.palette.background.paper,borderBottom:1,borderColor:"divider"},children:e.jsxs(v,{children:[!x&&e.jsx(Y,{sx:{pl:1},icon:e.jsx(He,{size:15}),variant:"outlined",label:((pe=i==null?void 0:i.agentflow)==null?void 0:pe.name)||((fe=i==null?void 0:i.agentflow)==null?void 0:fe.id)||"Go to AgentFlow",className:"button",onClick:()=>{var t;return window.open(`/v2/agentcanvas/${(t=i==null?void 0:i.agentflow)==null?void 0:t.id}`,"_blank")}}),!x&&e.jsx(ve,{title:`Execution ID: ${(i==null?void 0:i.id)||""}`,placement:"top",disableHoverListener:!(i!=null&&i.id),children:e.jsx(Y,{sx:{ml:1,pl:1},icon:e.jsx(Ee,{size:15}),variant:"outlined",label:K?"Copied!":"Copy ID",className:"button",onClick:J})}),!x&&!i.isPublic&&e.jsx(Y,{sx:{ml:1,pl:1},icon:C.loading?e.jsx(ne,{size:15,className:"spin-animation"}):e.jsx(pt,{size:15}),variant:"outlined",label:C.loading?"Updating...":"Share",className:"button",onClick:()=>Re(),disabled:C.loading}),!x&&i.isPublic&&e.jsx(Y,{sx:{ml:1,pl:1},icon:C.loading?e.jsx(ne,{size:15,className:"spin-animation"}):e.jsx(Be,{size:15}),variant:"outlined",label:C.loading?"Updating...":"Public",className:"button",onClick:()=>M(!0),disabled:C.loading}),e.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",alignContent:"center"},children:[e.jsx(G,{sx:{flex:1,mt:1},color:"text.primary",children:l!=null&&l.updatedDate?Ge(l.updatedDate).format("MMM D, YYYY h:mm A"):"N/A"}),e.jsx(Ue,{onClick:()=>D(i==null?void 0:i.id),size:"small",sx:{color:V.palette.text.primary,"&:hover":{backgroundColor:t=>t.palette.primary.main+"20"}},title:"Refresh execution data",children:e.jsx(ft,{size:20})})]})]})}),e.jsx(Ze,{expandedItems:q,onExpandedItemsChange:Se,selectedItems:w?[w.id]:[],onSelectedItemsChange:Pe,items:F,slots:{item:Te}})]}),e.jsx(v,{sx:{flex:"1 1 65%",padding:2,overflow:"auto"},children:w&&w.data?e.jsx(Je,{data:w.data,label:w.label,status:w.status,metadata:l,isPublic:x,onProceedSuccess:N}):e.jsx(G,{color:"text.secondary",children:"No data available for this item"})})]}),_e=e.jsx("button",{"aria-label":"Resize drawer",style:{position:"absolute",left:0,top:0,bottom:0,width:"8px",cursor:"ew-resize",display:"flex",alignItems:"center",justifyContent:"center",padding:0,border:"none",background:"transparent","&:hover":{background:"rgba(0, 0, 0, 0.1)"}},onMouseDown:le,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),le())},children:e.jsx(Ne,{sx:{transform:"rotate(90deg)",fontSize:"20px",color:Z.isDarkMode?"white":"action.disabled"}})});return x?e.jsx(v,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1300,backgroundColor:t=>t.palette.background.paper},children:e.jsx(v,{sx:{display:"flex",flexDirection:"column",width:"100%",height:"100%",position:"relative"},children:ue})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ve,{variant:"temporary",anchor:"right",sx:{width:W,flexShrink:0,"& .MuiDrawer-paper":{width:W,height:"100%"}},open:n,onClose:I,children:[_e,ue]}),e.jsx(we,{show:A,executionId:i==null?void 0:i.id,onClose:()=>M(!1),onUnshare:()=>{C.request(i.id,{isPublic:!1}).then(()=>{H(t=>({...t,isPublic:!1})),M(!1),y&&y()})}})]})};ke.propTypes={open:p.bool,isPublic:p.bool,execution:p.array,metadata:p.object,onClose:p.func,onProceedSuccess:p.func,onUpdateSharing:p.func,onRefresh:p.func};ke.displayName="ExecutionDetails";export{ke as E};
