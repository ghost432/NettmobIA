import{af as re,f as H,s as oe,t as ne,r as n,c as G,v as Ie,H as Z,j as e,D as Ce,m as we,n as Se,B as ie,o as Ue,y as De,p as Re,aa as Ee,w as Ae,bz as Oe,au as le,q as S,i as U,L as ce,N as de,P as M,a as Be,u as Te,b as Ne,M as We,S as Q,ac as Me,e as J,Q as Le,R as Pe,U as Ve,V as $e,W as ze,a3 as K,X as Fe,C as L,Z as _e,h as ee,av as se}from"./index-B5bgjFPS.js";import{a as t,S as q}from"./TableStyles-gXDYNr-F.js";import{C as pe,u as qe}from"./ConfirmDialog-Dfe34hOz.js";import{E as He}from"./ErrorBoundary-x4bZaoHs.js";import{V as Ge}from"./ViewHeader-t5dVj9Vk.js";import{I as Ye}from"./InviteUsersDialog-njunYoeH.js";import{r as Xe,I as Ze}from"./role-DOpuMhd7.js";import{A as Qe,a as Je}from"./Autocomplete-CinIIKT5.js";import{T as Ke}from"./TextField-OmGdqrIf.js";import{e as es}from"./empty_datasets-sHG3vrEn.js";import{S as u}from"./Skeleton-DJP3nnUt.js";import{I as te}from"./IconSearch-4bUU90FL.js";import"./IconCopy-bbAsun7S.js";import"./StyledFab-DFomU4Vk.js";import"./Tooltip-CXmeiPEa.js";import"./IconCircleCheck-DFCqko6z.js";import"./Close-DT9tpzn1.js";import"./InputLabel-BtU13bbu.js";import"./FormControl-o0rphY-g.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M17 22v-2",key:"svg-0"}],["path",{d:"M9 15l6 -6",key:"svg-1"}],["path",{d:"M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464",key:"svg-2"}],["path",{d:"M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463",key:"svg-3"}],["path",{d:"M20 17h2",key:"svg-4"}],["path",{d:"M2 7h2",key:"svg-5"}],["path",{d:"M7 2v2",key:"svg-6"}]],ts=re("outline","unlink","Unlink",ss);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4",key:"svg-3"}]],ae=re("outline","user-plus","UserPlus",as),rs=De(Oe)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${Je.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),ue=({show:j,dialogProps:d,onCancel:P,onConfirm:D})=>{const R=document.getElementById("portal"),y=H(a=>a.auth.user),m=oe();ne();const I=(...a)=>m(ce(...a)),E=(...a)=>m(de(...a)),[v,A]=n.useState(""),[p,O]=n.useState({}),[B,V]=n.useState([]),[i,f]=n.useState(""),k=G(Xe.getAllRolesByOrganizationId);n.useEffect(()=>{if(k.data){const a=k.data.map(l=>({id:l.id,name:l.name,label:l.name,description:l.description}));if(V(a),d.type==="EDIT"&&d.data&&d.data.role&&d.data.role.name){const l=a.find(C=>C.name===d.data.role.name);l&&f(l)}}},[k.data]),n.useEffect(()=>(d.data&&(k.request(y.activeOrganizationId),O(d.data.user),A(d.data.user.email)),()=>{A(""),O({})}),[d]),n.useEffect(()=>(m(j?{type:Ie}:{type:Z}),()=>m({type:Z})),[j,m]);const b=async()=>{try{const a={userId:p.id,workspaceId:d.data.workspaceId,organizationId:y.activeOrganizationId,roleId:i.id,updatedBy:y.id},l=await le.updateWorkspaceUserRole(a);l.data&&(I({message:"WorkspaceUser Details Updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:C=>e.jsx(S,{style:{color:"white"},onClick:()=>E(C),children:e.jsx(U,{})})}}),D(l.data.id))}catch(a){I({message:`Failed to update WorkspaceUser: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:l=>e.jsx(S,{style:{color:"white"},onClick:()=>E(l),children:e.jsx(U,{})})}})}},$=(a,l)=>{f(l)},T=j?e.jsxs(Ce,{fullWidth:!0,maxWidth:"sm",open:j,onClose:P,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(we,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Ze,{style:{marginRight:"10px"}}),"Change Workspace Role - "," ",v||""," ",p.name?`(${p.name})`:""]})}),e.jsx(Se,{children:e.jsxs(ie,{sx:{p:1},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(Ue,{children:["New Role to Assign",e.jsx("span",{style:{color:"red"},children:"Â *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(Qe,{size:"small",sx:{mt:1},onChange:$,getOptionLabel:a=>a.label||"",options:B,renderInput:a=>e.jsx(Ke,{...a,variant:"outlined",placeholder:"Select Role"}),value:i,PopperComponent:rs})]})}),e.jsx(Re,{sx:{px:3,pb:2},children:e.jsx(Ee,{variant:"contained",onClick:()=>b(),id:"btn_confirmEditUser",children:d.confirmButtonName})}),e.jsx(pe,{})]}):null;return Ae.createPortal(T,R)};ue.propTypes={show:M.bool,dialogProps:M.object,onCancel:M.func,onConfirm:M.func};const Cs=()=>{const j=Be(),d=H(s=>s.customization),P=H(s=>s.auth.user),D=Te(),R=oe();ne();const{error:y,setError:m}=Ne(),[I,E]=n.useState(""),[v,A]=n.useState({}),[p,O]=n.useState([]),[B,V]=n.useState(!0),[i,f]=n.useState([]),[k,b]=n.useState(!1),[$,T]=n.useState({}),[a,l]=n.useState(!1),[C,xe]=n.useState({}),z=(...s)=>R(ce(...s)),F=(...s)=>R(de(...s)),{confirm:he}=qe(),x=G(se.getAllUsersByWorkspaceId),N=G(le.getWorkspaceById),W=document.location.pathname.toString().split("/"),w=W[W.length-1]==="workspace-users"?"":W[W.length-1],me=s=>{if(s.target.checked){const r=(p||[]).filter(o=>!o.isOrgOwner).map(o=>({userId:o.userId,name:o.user.name,email:o.user.email}));f(r);return}f([])},ge=(s,r)=>{const o=i.findIndex(c=>c.userId===r.userId);let h=[];o===-1?h=h.concat(i,{userId:r.userId,name:r.user.name,email:r.user.email}):o===0?h=h.concat(i.slice(1)):o===i.length-1?h=h.concat(i.slice(0,-1)):o>0&&(h=h.concat(i.slice(0,o),i.slice(o+1))),f(h)},je=s=>i.findIndex(r=>r.userId===s)!==-1,Y=()=>{T({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Send Invite",data:v}),b(!0)},X=s=>{s.status.toUpperCase()==="INVITED"?fe(s):ke(s)},fe=s=>{const r={type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Update Invite",data:{...s,isWorkspaceUser:!0},disableWorkspaceSelection:!0};T(r),b(!0)},ke=s=>{const o={type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Update Role",data:{...s,assignedRoles:[{role:s.role,active:!0}],workspaceId:w}};xe(o),l(!0)},ye=async()=>{const r={title:"Remove Users",description:`Remove the following users from the workspace?
${i.map(c=>c.name?`${c.name} (${c.email})`:c.email).join(", ")}`,confirmButtonName:"Remove",cancelButtonName:"Cancel"};if(p.find(c=>i.some(g=>g.userId===c.id)&&c.isOrgOwner===!0)){z({message:"Organization owner cannot be removed from workspace.",options:{key:new Date().getTime()+Math.random(),variant:"error",action:c=>e.jsx(S,{style:{color:"white"},onClick:()=>F(c),children:e.jsx(U,{})})}});return}if(await he(r)){try{const c=i.map(g=>se.deleteWorkspaceUser(w,g.userId));if(await Promise.all(c),z({message:`${i.length} User(s) removed from workspace.`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:g=>e.jsx(S,{style:{color:"white"},onClick:()=>F(g),children:e.jsx(U,{})})}}),i.some(g=>g.userId===P.id)){D("/",{replace:!0}),D(0);return}_()}catch(c){z({message:`Failed to unlink users: ${typeof c.response.data=="object"?c.response.data.message:c.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:g=>e.jsx(S,{style:{color:"white"},onClick:()=>F(g),children:e.jsx(U,{})})}})}f([])}},_=()=>{b(!1),l(!1),x.request(w)},ve=s=>{E(s.target.value)};function be(s){var r,o;return((r=s.user.name)==null?void 0:r.toLowerCase().indexOf(I.toLowerCase()))>-1||((o=s.user.email)==null?void 0:o.toLowerCase().indexOf(I.toLowerCase()))>-1}return n.useEffect(()=>{N.request(w),x.request(w)},[]),n.useEffect(()=>{N.data&&A(N.data)},[N.data]),n.useEffect(()=>{if(x.data){const s=x.data||[],r=s.find(o=>o.isOrgOwner);r&&(s.splice(s.indexOf(r),1),s.unshift(r)),O(s)}},[x.data]),n.useEffect(()=>{x.error&&m(x.error)},[x.error,m]),n.useEffect(()=>{V(x.loading)},[x.loading]),e.jsxs(e.Fragment,{children:[e.jsx(We,{children:y?e.jsx(He,{error:y}):e.jsxs(Q,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Ge,{isBackButton:!0,isEditButton:!1,onBack:()=>window.history.back(),search:p.length>0,onSearchChange:ve,searchPlaceholder:"Search Users",title:((v==null?void 0:v.name)||"")+": Workspace Users",description:"Manage workspace users and permissions.",children:p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{permissionId:"workspace:unlink-user",sx:{borderRadius:2,height:"100%"},variant:"outlined",disabled:i.length===0,onClick:ye,color:"error",startIcon:e.jsx(ts,{}),children:"Remove Users"}),e.jsx(J,{permissionId:"workspace:add-user",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:Y,startIcon:e.jsx(ae,{}),children:"Add User"})]})}),!B&&(p==null?void 0:p.length)<=0?e.jsxs(Q,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(ie,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:es,alt:"empty_datasetSVG"})}),e.jsx("div",{children:"No Assigned Users Yet"}),e.jsx(J,{permissionId:"workspace:add-user",variant:"contained",sx:{borderRadius:2,height:"100%",mt:2,color:"white"},startIcon:e.jsx(ae,{}),onClick:Y,children:"Add User"})]}):e.jsx(e.Fragment,{children:e.jsx(Le,{sx:{border:1,borderColor:j.palette.grey[900]+25,borderRadius:2},component:Pe,children:e.jsxs(Ve,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx($e,{sx:{backgroundColor:d.isDarkMode?j.palette.common.black:j.palette.grey[100],height:56},children:e.jsxs(ze,{children:[e.jsx(t,{padding:"checkbox",children:e.jsx(K,{color:"primary",checked:i.length===(p||[]).length-1,onChange:me,inputProps:{"aria-label":"select all"}})}),e.jsx(t,{children:"Email/Name"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Last Login"}),e.jsx(t,{children:" "})]})}),e.jsx(Fe,{children:B?e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})})]}),e.jsxs(q,{children:[e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:(p||[]).filter(be).map((s,r)=>e.jsxs(q,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{padding:"checkbox",children:s.isOrgOwner?null:e.jsx(K,{color:"primary",checked:je(s.userId),onChange:o=>ge(o,s),inputProps:{"aria-labelledby":s.userId}})}),e.jsxs(t,{children:[s.user.name&&e.jsxs(e.Fragment,{children:[s.user.name,e.jsx("br",{})]}),s.user.email]}),e.jsx(t,{children:s.isOrgOwner?e.jsx(L,{size:"small",label:"ORGANIZATION OWNER"}):s.role.name}),e.jsx(t,{children:s.isOrgOwner?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[s.status.toUpperCase()==="ACTIVE"&&e.jsx(L,{color:"success",label:s.status.toUpperCase()}),s.status.toUpperCase()==="INVITED"&&e.jsx(L,{color:"warning",label:s.status.toUpperCase()}),s.status.toUpperCase()==="INACTIVE"&&e.jsx(L,{color:"error",label:s.status.toUpperCase()})]})}),e.jsx(t,{children:s.lastLogin?_e(s.lastLogin).format("DD/MM/YYYY HH:mm"):"Never"}),e.jsxs(t,{children:[!s.isOrgOwner&&s.status.toUpperCase()==="INVITED"&&e.jsx(ee,{title:"Edit",color:"primary",onClick:()=>X(s),children:e.jsx(te,{})}),!s.isOrgOwner&&s.status.toUpperCase()==="ACTIVE"&&e.jsx(ee,{title:"Change Role",color:"primary",onClick:()=>X(s),children:e.jsx(te,{})})]})]},r))})})]})})})]})}),k&&e.jsx(Ye,{show:k,dialogProps:$,onCancel:()=>b(!1),onConfirm:_}),a&&e.jsx(ue,{show:a,dialogProps:C,onCancel:()=>l(!1),onConfirm:_}),e.jsx(pe,{})]})};export{Cs as default};
