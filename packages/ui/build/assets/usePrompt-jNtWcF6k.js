import{af as Fe,s as Ge,f as Ie,a as Oe,c as Pe,t as jt,r,v as Ks,H as xt,j as e,D as Je,m as ot,n as Ye,q as Z,S as Ee,B as G,Q as Fo,R as Yt,U as Ro,V as Po,W as Wt,_ as he,a3 as Xs,X as Uo,p as nt,w as wt,aB as Qs,i as fe,h as pe,ad as Oo,d as ve,o as oe,L as rt,N as it,P as u,u as Lo,al as zo,an as Re,ao as We,a7 as Os,cW as Zs,ap as $o,F as Lt,G as Ho,bI as Kt,bc as Bo,a5 as Ue,aq as re,ar as Wo,as as Ls,bb as Xt,cX as _o,bz as ea,cA as ta,c3 as sa,M as aa,cq as Go,E as at,bN as qo,aA as Vo,C as Ne,a4 as Jo,A as Qt,aa as oa,ah as _e,ag as zs,cw as na,y as qe,bL as Yo,K as Ko,cL as Xo,cY as Qo,b4 as Zt,cZ as et,c_ as gt,b8 as zt,ba as Zo,cy as $s,cx as Hs,ce as en,bK as tn,c$ as sn,d0 as an}from"./index-B5bgjFPS.js";import{S as on,A as nn,V as rn,a as ln,C as cn,L as dn,I as un,e as _t,u as pn,f as mt,m as hn,g as fn,l as gn,h as mn}from"./index-BhkI4Bzv.js";import{S as xn}from"./SaveChatflowDialog-BSNhDvwI.js";import{e as Bs}from"./react-datepicker-B1KQuNsR.js";import{m as yn}from"./moment-BDbvUjbq.js";import{d as es}from"./ExpandMore-BZIzyY2F.js";import{T as bn}from"./Table-CZOZGZoJ.js";import{T as pt}from"./TooltipWithParser-D26Faoyy.js";import{v as Gt,H as jn}from"./vectorstore-Bq4Eb9NI.js";import{I as yt}from"./IconTrash-CekgWF9B.js";import{I as wn,a as kn}from"./IconChevronsUp-DG3lzKhL.js";import{A as ts,d as ss,e as as,M as qt,f as Cn,I as vn}from"./MemoizedReactMarkdown-mGWPD7hJ.js";import{E as In}from"./ExportAsTemplateDialog-481ESzFy.js";import{c as tt}from"./chatflows-CbGmw0-v.js";import{I as Sn}from"./IconChevronLeft-DxxY-T-U.js";import{I as Dn}from"./NodeInfoDialog-BuAc37BO.js";import{T as ra}from"./TextField-OmGdqrIf.js";import{I as An}from"./ToolDialog-DZ6z_iak.js";import{I as Tn}from"./IconDeviceFloppy-BsK1tbgI.js";import{S as st}from"./StyledFab-DFomU4Vk.js";import{D as Mn}from"./Dropdown-D8Rr64ju.js";import{a as En}from"./assistants-DZYxhrU8.js";import{D as Nn,N as Fn,a as Vt}from"./DocStoreInputHandler-BDJBQrwa.js";import{L as Rn}from"./LoadingButton-CJHvS9bV.js";import{a as Pn,b as Un}from"./IconSearch-4bUU90FL.js";import{L as On}from"./llamaindex-B_JSDULd.js";import{I as Ln}from"./IconPlus-j8jP5X4Z.js";import{I as Me}from"./InputAdornment-v58Edx4J.js";import{T as zn}from"./Tabs-T-PfpsDr.js";import{L as $n}from"./ListItem-BfStHUI0.js";import{L as Ws,r as Hn}from"./Input-CajAyvOv.js";import{S as Bn,C as $t,a as Wn}from"./SourceDocDialog-U52onwWn.js";import{R as _n,d as Gn,a as qn,u as Vn,T as Jn,b as Yn,c as Kn,f as Xn,g as Qn,h as Zn,i as er,j as tr,k as sr,N as ar,e as or,p as nr}from"./NodeExecutionDetails-DG6IJuTk.js";import{I as rr,d as ir}from"./StopCircle-Dr72dSBy.js";import{I as lr}from"./IconCircleXFilled-6uNExu9P.js";import{I as ia}from"./IconArrowsMaximize-BLCViMbK.js";import{v as cr}from"./v4-CtRu48qb.js";import{u as dr}from"./ConfirmDialog-Dfe34hOz.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=[["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-1"}]],pr=Fe("outline","circle-dot","CircleDot",ur);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=[["path",{d:"M9 2m0 3a3 3 0 0 1 3 -3h0a3 3 0 0 1 3 3v5a3 3 0 0 1 -3 3h0a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M5 10a7 7 0 0 0 14 0",key:"svg-1"}],["path",{d:"M8 21l8 0",key:"svg-2"}],["path",{d:"M12 17l0 4",key:"svg-3"}]],fr=Fe("outline","microphone","Microphone",hr);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=[["path",{d:"M5 12l14 0",key:"svg-0"}]],mr=Fe("outline","minus","Minus",gr);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=[["path",{d:"M15 8h.01",key:"svg-0"}],["path",{d:"M12.5 21h-6.5a3 3 0 0 1 -3 -3v-12a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v6.5",key:"svg-1"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l4 4",key:"svg-2"}],["path",{d:"M14 14l1 -1c.67 -.644 1.45 -.824 2.182 -.54",key:"svg-3"}],["path",{d:"M16 19h6",key:"svg-4"}],["path",{d:"M19 16v6",key:"svg-5"}]],_s=Fe("outline","photo-plus","PhotoPlus",xr);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}],["path",{d:"M12 9l0 3",key:"svg-2"}],["path",{d:"M12 15l.01 0",key:"svg-3"}]],Ji=Fe("outline","refresh-alert","RefreshAlert",yr);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]],Ht=Fe("outline","send","Send",br);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=[["path",{d:"M7 13v-8a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2 -2l-1 -5a2 3 0 0 0 -2 -2h-7a3 3 0 0 0 -3 3",key:"svg-0"}]],wr=Fe("outline","thumb-down","ThumbDown",jr);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=[["path",{d:"M7 11v8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3",key:"svg-0"}]],Cr=Fe("outline","thumb-up","ThumbUp",kr);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=[["path",{d:"M19 2h-14a3 3 0 0 0 -3 3v14a3 3 0 0 0 3 3h14a3 3 0 0 0 3 -3v-14a3 3 0 0 0 -3 -3z",key:"svg-0"}]],Ir=Fe("filled","square-filled","SquareFilled",vr),Jt=r.forwardRef(function({value:o,onClick:c},f){return e.jsx(Qs,{style:{borderRadius:15,border:"1px solid #e0e0e0"},onClick:c,ref:f,children:o})});Jt.propTypes={value:u.string,onClick:u.func};function la(s){var m,D,v,O;const[o,c]=r.useState(!1),[f,h]=r.useState({}),b=P=>($,T)=>{const L={...f};L[P]=T,h(L)},d=s.selected.indexOf(s.upsertHistory.id)!==-1;return e.jsxs(e.Fragment,{children:[e.jsxs(Wt,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(he,{padding:"checkbox",children:e.jsx(Xs,{color:"primary",checked:d,onChange:P=>s.handleSelect(P,s.upsertHistory.id),inputProps:{"aria-labelledby":s.upsertHistory.id}})}),e.jsx(he,{children:yn(s.upsertHistory.date).format("MMMM Do YYYY, h:mm:ss a")}),e.jsx(he,{children:((m=s.upsertHistory.result)==null?void 0:m.numAdded)??"0"}),e.jsx(he,{children:((D=s.upsertHistory.result)==null?void 0:D.numUpdated)??"0"}),e.jsx(he,{children:((v=s.upsertHistory.result)==null?void 0:v.numSkipped)??"0"}),e.jsx(he,{children:((O=s.upsertHistory.result)==null?void 0:O.numDeleted)??"0"}),e.jsx(he,{children:e.jsx(pe,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>c(!o),children:o?e.jsx(wn,{}):e.jsx(kn,{})})})]}),o&&e.jsx(Wt,{sx:{"& td":{border:0}},children:e.jsx(he,{sx:{pb:0,pt:0},colSpan:6,children:e.jsx(Oo,{in:o,timeout:"auto",unmountOnExit:!0,children:e.jsx(G,{sx:{mt:1,mb:2},children:(s.upsertHistory.flowData??[]).map((P,$)=>e.jsxs(ts,{expanded:f[P.id]||!1,onChange:b(P.id),disableGutters:!0,children:[e.jsx(ss,{expandIcon:e.jsx(es,{}),"aria-controls":`nodes-accordian-${P.name}`,id:`nodes-accordian-header-${P.name}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:40,height:40,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:P.name,src:`${ve}/api/v1/node-icon/${P.name}`})}),e.jsx(oe,{variant:"h5",children:P.label}),e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:e.jsx("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:P.id})})]})}),e.jsx(as,{children:P.paramValues[0]&&e.jsx(bn,{sx:{minWidth:150},rows:P.paramValues,columns:Object.keys(P.paramValues[0])})})]},$))})})})})]})}la.propTypes={upsertHistory:u.object,theme:u.any,isDarkMode:u.bool,selected:u.array,handleSelect:u.func};const ca=({show:s,dialogProps:o,onCancel:c})=>{const f=document.getElementById("portal"),h=Ge(),b=Ie(p=>p.customization),d=Oe(),m=Pe(Gt.getUpsertHistory);jt();const D=(...p)=>h(rt(...p)),v=(...p)=>h(it(...p)),[O,P]=r.useState([]),[$,T]=r.useState(new Date(new Date().setMonth(new Date().getMonth()-1))),[L,q]=r.useState(new Date),[y,j]=r.useState([]),S=p=>{if(p.target.checked){const k=O.map(M=>M.id);j(k);return}j([])},I=p=>{const k=new Date(p);k.setHours(0,0,0,0),T(k),m.request(o.chatflow.id,{startDate:k,endDate:L})},K=p=>{const k=new Date(p);k.setHours(23,59,59,999),q(k),m.request(o.chatflow.id,{endDate:k,startDate:$})},W=(p,k)=>{const M=y.indexOf(k);let F=[];M===-1?F=F.concat(y,k):M===0?F=F.concat(y.slice(1)):M===y.length-1?F=F.concat(y.slice(0,-1)):M>0&&(F=F.concat(y.slice(0,M),y.slice(M+1))),j(F)},ee=async()=>{try{await Gt.deleteUpsertHistory(y),D({message:"Succesfully deleted upsert history",options:{key:new Date().getTime()+Math.random(),variant:"success",action:p=>e.jsx(Z,{style:{color:"white"},onClick:()=>v(p),children:e.jsx(fe,{})})}}),P(O.filter(p=>!y.includes(p.id))),j([])}catch(p){D({message:`Failed to delete Upsert History: ${typeof p.response.data=="object"?p.response.data.message:p.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:k=>e.jsx(Z,{style:{color:"white"},onClick:()=>v(k),children:e.jsx(fe,{})})}}),j([])}};r.useEffect(()=>{m.data&&P(m.data)},[m.data]),r.useEffect(()=>(o.chatflow&&m.request(o.chatflow.id),()=>{P([]),T(new Date(new Date().setMonth(new Date().getMonth()-1))),q(new Date)}),[o]),r.useEffect(()=>(h(s?{type:Ks}:{type:xt}),()=>h({type:xt})),[s,h]);const x=s?e.jsxs(Je,{onClose:c,open:s,fullWidth:!0,maxWidth:"lg","aria-labelledby":"upsert-history-dialog-title","aria-describedby":"upsert-history-dialog-description",children:[e.jsx(ot,{sx:{fontSize:"1rem"},id:"upsert-history-dialog-title",children:o.title}),e.jsx(Ye,{children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",marginBottom:10},children:[e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"From Date"}),e.jsx(Bs,{selected:$,onChange:p=>I(p),selectsStart:!0,startDate:$,endDate:L,customInput:e.jsx(Jt,{})})]}),e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"To Date"}),e.jsx(Bs,{selected:L,onChange:p=>K(p),selectsEnd:!0,startDate:$,endDate:L,minDate:$,maxDate:new Date,customInput:e.jsx(Jt,{})})]})]}),y.length>0&&e.jsxs(Z,{sx:{mt:1,mb:2},variant:"outlined",onClick:ee,color:"error",startIcon:e.jsx(yt,{}),children:["Delete ",y.length," ",y.length===1?"row":"rows"]}),O.length<=0&&e.jsxs(Ee,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(G,{sx:{p:7,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:jn,alt:"HistoryEmptySVG"})}),e.jsx("div",{children:"No Upsert History Yet"})]}),O.length>0&&e.jsx(Fo,{component:Yt,children:e.jsxs(Ro,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Po,{children:e.jsxs(Wt,{children:[e.jsx(he,{padding:"checkbox",children:e.jsx(Xs,{color:"primary",checked:y.length===O.length,onChange:S,inputProps:{"aria-label":"select all"}})}),e.jsx(he,{children:"Date"}),e.jsxs(he,{children:["Added"," ",e.jsx(pt,{style:{marginBottom:2,marginLeft:10},title:"Number of vector embeddings added to Vector Store"})]}),e.jsxs(he,{children:["Updated"," ",e.jsx(pt,{style:{marginBottom:2,marginLeft:10},title:"Updated existing vector embeddings. Only works when a Record Manager is connected to the Vector Store"})]}),e.jsxs(he,{children:["Skipped"," ",e.jsx(pt,{style:{marginBottom:2,marginLeft:10},title:"Number of same vector embeddings that exists, and were skipped re-upserting again. Only works when a Record Manager is connected to the Vector Store"})]}),e.jsxs(he,{children:["Deleted"," ",e.jsx(pt,{style:{marginBottom:2,marginLeft:10},title:"Deleted vector embeddings. Only works when a Record Manager with a Cleanup method is connected to the Vector Store"})]}),e.jsx(he,{children:"Details"})]})}),e.jsx(Uo,{children:O.map((p,k)=>e.jsx(la,{upsertHistory:p,theme:d,isDarkMode:b.isDarkMode,selected:y,handleSelect:W},k))})]})})]})}),e.jsx(nt,{children:e.jsx(Z,{onClick:c,children:"Close"})})]}):null;return wt.createPortal(x,f)};ca.propTypes={show:u.bool,dialogProps:u.object,onCancel:u.func};const Sr=({chatflow:s,isAgentCanvas:o,isAgentflowV2:c,handleSaveFlow:f,handleDeleteFlow:h,handleLoadFlow:b})=>{const d=Oe(),m=Ge(),D=Lo(),v=r.useRef(),O=r.useRef(),[P,$]=r.useState(null),[T,L]=r.useState(""),[q,y]=r.useState(!1),[j,S]=r.useState(!1),[I,K]=r.useState(!1),[W,ee]=r.useState({}),[x,p]=r.useState(!1),[k,M]=r.useState({}),[F,z]=r.useState(!1),[w,U]=r.useState({}),[B,V]=r.useState(!1),[ce,Se]=r.useState({}),[De,we]=r.useState(!1),[ne,ye]=r.useState({}),[ge,ke]=r.useState(!1),[Ae,E]=r.useState({}),C=(...Y)=>m(rt(...Y)),R=(...Y)=>m(it(...Y)),[_,se]=r.useState(o?"agentflows:create":"chatflows:create"),H=o?"Agents":"Chatflow",X=Pe(tt.updateChatflow),J=Ie(Y=>Y.canvas),de=Y=>{if(y(!1),Y==="deleteChatflow")h();else if(Y==="viewMessages")M({title:"View Messages",chatflow:s,isChatflow:!c}),p(!0);else if(Y==="viewLeads")U({title:"View Leads",chatflow:s}),z(!0);else if(Y==="saveAsTemplate"){if(J.isDirty){C({message:"Please save the flow before exporting as template",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:te=>e.jsx(Z,{style:{color:"white"},onClick:()=>R(te),children:e.jsx(fe,{})})}});return}E({title:"Export As Template",chatflow:s}),ke(!0)}else if(Y==="viewUpsertHistory")Se({title:"View Upsert History",chatflow:s}),V(!0);else if(Y==="chatflowConfiguration")ye({title:`${H} Configuration`,chatflow:s}),we(!0);else if(Y==="duplicateChatflow")try{let te=s.flowData;const be=JSON.parse(te);te=JSON.stringify(be),localStorage.setItem("duplicatedFlowData",te),c?window.open(`${Lt}/v2/agentcanvas`,"_blank"):o?window.open(`${Lt}/agentcanvas`,"_blank"):window.open(`${Lt}/canvas`,"_blank")}catch(te){console.error(te)}else if(Y==="exportChatflow")try{const te=JSON.parse(s.flowData);let be=JSON.stringify(Ho(te),null,2);const Te=new Blob([be],{type:"application/json"}),Le=URL.createObjectURL(Te);let xe=`${s.name} ${H}.json`,ze=document.createElement("a");ze.setAttribute("href",Le),ze.setAttribute("download",xe),ze.click()}catch(te){console.error(te)}},Ke=Y=>{y(!1),b(Y)},lt=()=>{if(s.id){const Y={name:v.current.value};X.request(s.id,Y)}},kt=()=>{let Y=!1;try{const Te=JSON.parse(s.flowData).nodes;for(const Le of Te)if(Le.data.inputParams.find(xe=>xe.type==="file")){Y=!0;break}}catch(be){console.error(be)}let te=!1;try{const Te=JSON.parse(s.flowData).nodes;for(const Le of Te)if(Le.data.inputParams.find(xe=>xe.name==="sessionId")){te=!0;break}}catch(be){console.error(be)}ee({title:"Embed in website or use as API",chatflowid:s.id,chatflowApiKeyId:s.apikeyid,isFormDataRequired:Y,isSessionMemory:te,isAgentCanvas:o,isAgentflowV2:c}),K(!0)},Xe=()=>{s.id?f(T):S(!0)},Ct=Y=>{S(!1),se(o?"agentflows:update":"chatflows:update"),f(Y)};return r.useEffect(()=>{X.data&&(L(X.data.name),se(o?"agentflows:update":"chatflows:update"),m({type:zo,chatflow:X.data})),$(!1)},[X.data]),r.useEffect(()=>{s&&(L(s.name),De&&ye({title:`${H} Configuration`,chatflow:s}))},[s,H,De]),e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{flexDirection:"row",justifyContent:"space-between",sx:{width:"100%"},children:[e.jsxs(Ee,{flexDirection:"row",sx:{width:"100%",maxWidth:"50%"},children:[e.jsx(G,{children:e.jsx(Re,{title:"Back",sx:{borderRadius:"50%"},children:e.jsx(We,{variant:"rounded",sx:{...d.typography.commonAvatar,...d.typography.mediumAvatar,transition:"all .2s ease-in-out",background:d.palette.secondary.light,color:d.palette.secondary.dark,"&:hover":{background:d.palette.secondary.dark,color:d.palette.secondary.light}},color:"inherit",onClick:()=>{window.history.state&&window.history.state.idx>0?D(-1):D("/",{replace:!0})},children:e.jsx(Sn,{stroke:1.5,size:"1.3rem"})})})}),e.jsx(G,{sx:{width:"100%"},children:P?e.jsxs(Ee,{flexDirection:"row",sx:{width:"100%"},children:[e.jsx(ra,{autoFocus:!0,size:"small",inputRef:v,sx:{width:"100%",ml:2},defaultValue:T,onKeyDown:Y=>{Y.key==="Enter"?lt():Y.key==="Escape"&&$(!1)}}),e.jsx(Re,{title:"Save Name",sx:{borderRadius:"50%"},children:e.jsx(We,{variant:"rounded",sx:{...d.typography.commonAvatar,...d.typography.mediumAvatar,transition:"all .2s ease-in-out",background:d.palette.success.light,color:d.palette.success.dark,ml:1,"&:hover":{background:d.palette.success.dark,color:d.palette.success.light}},color:"inherit",onClick:lt,children:e.jsx(Zs,{stroke:1.5,size:"1.3rem"})})}),e.jsx(Re,{title:"Cancel",sx:{borderRadius:"50%"},children:e.jsx(We,{variant:"rounded",sx:{...d.typography.commonAvatar,...d.typography.mediumAvatar,transition:"all .2s ease-in-out",background:d.palette.error.light,color:d.palette.error.dark,ml:1,"&:hover":{background:d.palette.error.dark,color:d.palette.error.light}},color:"inherit",onClick:()=>$(!1),children:e.jsx(fe,{stroke:1.5,size:"1.3rem"})})})]}):e.jsxs(Ee,{flexDirection:"row",children:[e.jsxs(oe,{sx:{fontSize:"1.5rem",fontWeight:600,ml:2,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},children:[J.isDirty&&e.jsx("strong",{style:{color:d.palette.orange.main},children:"*"})," ",T]}),(s==null?void 0:s.id)&&e.jsx(Os,{permission:_,children:e.jsx(Re,{title:"Edit Name",sx:{borderRadius:"50%"},children:e.jsx(We,{variant:"rounded",sx:{...d.typography.commonAvatar,...d.typography.mediumAvatar,transition:"all .2s ease-in-out",ml:1,background:d.palette.secondary.light,color:d.palette.secondary.dark,"&:hover":{background:d.palette.secondary.dark,color:d.palette.secondary.light}},color:"inherit",onClick:()=>$(!0),children:e.jsx(Dn,{stroke:1.5,size:"1.3rem"})})})})]})})]}),e.jsxs(G,{children:[(s==null?void 0:s.id)&&e.jsx(Re,{title:"API Endpoint",sx:{borderRadius:"50%",mr:2},children:e.jsx(We,{variant:"rounded",sx:{...d.typography.commonAvatar,...d.typography.mediumAvatar,transition:"all .2s ease-in-out",background:d.palette.canvasHeader.deployLight,color:d.palette.canvasHeader.deployDark,"&:hover":{background:d.palette.canvasHeader.deployDark,color:d.palette.canvasHeader.deployLight}},color:"inherit",onClick:kt,children:e.jsx(An,{stroke:1.5,size:"1.3rem"})})}),e.jsx(Os,{permission:_,children:e.jsx(Re,{title:`Save ${H}`,sx:{borderRadius:"50%",mr:2},children:e.jsx(We,{variant:"rounded",sx:{...d.typography.commonAvatar,...d.typography.mediumAvatar,transition:"all .2s ease-in-out",background:d.palette.canvasHeader.saveLight,color:d.palette.canvasHeader.saveDark,"&:hover":{background:d.palette.canvasHeader.saveDark,color:d.palette.canvasHeader.saveLight}},color:"inherit",onClick:Xe,children:e.jsx(Tn,{stroke:1.5,size:"1.3rem"})})})}),e.jsx(Re,{ref:O,title:"Settings",sx:{borderRadius:"50%"},children:e.jsx(We,{variant:"rounded",sx:{...d.typography.commonAvatar,...d.typography.mediumAvatar,transition:"all .2s ease-in-out",background:d.palette.canvasHeader.settingsLight,color:d.palette.canvasHeader.settingsDark,"&:hover":{background:d.palette.canvasHeader.settingsDark,color:d.palette.canvasHeader.settingsLight}},onClick:()=>y(!q),children:e.jsx($o,{stroke:1.5,size:"1.3rem"})})})]})]}),e.jsx(on,{chatflow:s,isSettingsOpen:q,anchorEl:O.current,onClose:()=>y(!1),onSettingsItemClick:de,onUploadFile:Ke,isAgentCanvas:o}),e.jsx(xn,{show:j,dialogProps:{title:`Save New ${H}`,confirmButtonName:"Save",cancelButtonName:"Cancel"},onCancel:()=>S(!1),onConfirm:Ct}),I&&e.jsx(nn,{show:I,dialogProps:W,onCancel:()=>K(!1)}),e.jsx(rn,{show:x,dialogProps:k,onCancel:()=>p(!1)}),e.jsx(ln,{show:F,dialogProps:w,onCancel:()=>z(!1)}),ge&&e.jsx(In,{show:ge,dialogProps:Ae,onCancel:()=>ke(!1)}),e.jsx(ca,{show:B,dialogProps:ce,onCancel:()=>V(!1)}),e.jsx(cn,{show:De,dialogProps:ne,onCancel:()=>we(!1),isAgentCanvas:o},"chatflowConfiguration")]})};Sr.propTypes={chatflow:u.object,handleSaveFlow:u.func,handleDeleteFlow:u.func,handleLoadFlow:u.func,isAgentCanvas:u.bool,isAgentflowV2:u.bool};const Dr="/assets/agentflow-generator-DGaU2pb2.gif",Ar=[{text:"An agent that can autonomously search the web and generate report"},{text:"Summarize a document"},{text:"Generate response to user queries and send it to Slack"},{text:"A team of agents that can handle all customer queries"}],da=({show:s,dialogProps:o,onCancel:c,onConfirm:f})=>{const h=document.getElementById("portal"),[b,d]=r.useState(""),[m,D]=r.useState(""),[v,O]=r.useState(!1),[P,$]=r.useState(0),[T,L]=r.useState([]),[q,y]=r.useState([]),[j,S]=r.useState({}),I=Ie(w=>w.customization),K=Pe(En.getChatModels),{reactFlowInstance:W}=r.useContext(Kt),ee=Oe(),x=Ge();jt();const p=(...w)=>x(rt(...w)),k=(...w)=>x(it(...w)),M=({inputParam:w,newValue:U})=>{S(B=>{const V={...B};return V.inputs[w.name]=U,V.inputParams=Ls(V),V})};r.useEffect(()=>{if(K.data){L(K.data);const w=K.data.map(U=>({label:U.label,name:U.name,imageSrc:`${ve}/api/v1/node-icon/${U.name}`}));y(w)}},[K.data]),r.useEffect(()=>{let w;return v?($(0),w=setInterval(()=>{$(U=>{if(U>=95)return clearInterval(w),95;const B=U<30?3:U<60?5:U<80?2:.5;return Math.min(U+B,95)})},500)):$(100),()=>{w&&clearInterval(w)}},[v]);const F=async()=>{var w,U;if(b.trim())try{O(!0);const B=await tt.generateAgentflow({question:b.trim(),selectedChatModel:j});B.data&&B.data.nodes&&B.data.edges?(W.setNodes(B.data.nodes),W.setEdges(B.data.edges),f()):p({message:B.error||"Failed to generate agentflow",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!1,action:V=>e.jsx(Z,{style:{color:"white"},onClick:()=>k(V),children:e.jsx(fe,{})})}})}catch(B){p({message:((U=(w=B.response)==null?void 0:w.data)==null?void 0:U.message)||"Failed to generate agentflow",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!1,action:V=>e.jsx(Z,{style:{color:"white"},onClick:()=>k(V),children:e.jsx(fe,{})})}})}finally{O(!1)}};r.useEffect(()=>{s?K.request():(d(""),D(""),$(0))},[s]);const z=s?e.jsx(e.Fragment,{children:e.jsxs(Je,{fullWidth:!0,maxWidth:v?"sm":"md",open:s,onClose:v?null:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ot,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:o.title}),e.jsx(Ye,{children:v?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[e.jsx("img",{src:Dr,alt:"Generating Agentflow",style:{maxWidth:"100%",height:"auto"}}),e.jsx(oe,{variant:"h5",sx:{mt:2},children:"Generating your Agentflow..."}),e.jsxs(G,{sx:{width:"100%",mt:2},children:[e.jsx(Bo,{variant:"determinate",value:P,sx:{height:10,borderRadius:5,"& .MuiLinearProgress-bar":{background:"linear-gradient(45deg, #FF6B6B 30%, #FF8E53 90%)",borderRadius:5}}}),e.jsx(oe,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:`${Math.round(P)}%`})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:o.description}),e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%",marginTop:"25px"},children:Ar.map((w,U)=>e.jsx(Z,{size:"small",sx:{textTransform:"none",mr:1,mb:1,borderRadius:"16px",border:"none",backgroundColor:I.isDarkMode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{backgroundColor:I.isDarkMode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.06)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},variant:"contained",color:"inherit",onClick:()=>{d(w.text),D("")},children:w.text},U))}),!m&&e.jsx(Ue,{sx:{mt:2,width:"100%"},type:"text",multiline:!0,rows:12,disabled:v,value:b,placeholder:"Describe your agent here",onChange:w=>d(w.target.value)}),m&&e.jsx(Ue,{sx:{mt:2,width:"100%"},type:"text",multiline:!0,rows:12,value:m,onChange:w=>D(w.target.value)}),e.jsxs(G,{sx:{mt:2},children:[e.jsx("div",{style:{display:"flex",flexDirection:"row"},children:e.jsxs(oe,{children:["Select model to generate agentflow",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(Mn,{name:"chatModel",options:q??[],onSelect:w=>{if(!w)S({});else{const U=T.find(B=>B.name===w);if(U){const B=`${U.name}_0`,V=re.cloneDeep(U),ce=Wo(V,B);S(ce)}}},value:j?j==null?void 0:j.name:"choose an option"},JSON.stringify(j))]}),j&&Object.keys(j).length>0&&e.jsx(G,{sx:{p:0,mt:1,mb:1,border:1,borderColor:ee.palette.grey[900]+25,borderRadius:2},children:Ls(j).filter(w=>!w.hidden&&w.display!==!1).map((w,U)=>e.jsx(Nn,{inputParam:w,data:j,onNodeDataChange:M},U))})]})}),e.jsx(nt,{sx:{pb:3,pr:3},children:v?null:e.jsxs(e.Fragment,{children:[!m&&e.jsx(Rn,{loading:v,variant:"contained",onClick:()=>{F()},sx:{background:"linear-gradient(45deg, #FF6B6B 30%, #FF8E53 90%)","&:hover":{background:"linear-gradient(45deg, #FF8E53 30%, #FF6B6B 90%)"}},startIcon:e.jsx(Xt,{size:20}),disabled:v||!b.trim()||!j||!Object.keys(j).length,children:"Generate"}),m&&e.jsx(Z,{variant:"outlined",startIcon:e.jsx(Pn,{size:20}),onClick:()=>{D("")},children:"Back"})]})})]})}):null;return wt.createPortal(z,h)};da.propTypes={show:u.bool,dialogProps:u.object,onConfirm:u.func,onCancel:u.func};const Tr="/assets/utilNodes-9P4ffRXr.png";function Mr(s){return{id:`attachment-tab-${s}`,"aria-controls":`attachment-tabpanel-${s}`}}const Gs=["Agents","Memory","Record Manager","Utilities"],ua=["agentMemory","sqliteAgentMemory","postgresAgentMemory","mySQLAgentMemory"],ht={Memory:ua,Utilities:["getVariable","setVariable","stickyNote"]},ft={Memory:ua},pa=({nodesData:s,node:o,isAgentCanvas:c,isAgentflowv2:f,onFlowGenerated:h})=>{const b=Oe(),d=Ie(E=>E.customization),m=Ge(),[D,v]=r.useState(""),[O,P]=r.useState({}),[$,T]=r.useState(!1),[L,q]=r.useState({}),[y,j]=r.useState(0),[S,I]=r.useState(!1),[K,W]=r.useState({}),ee=window.location.pathname.includes("/v2/agentcanvas"),x=r.useRef(null),p=r.useRef($),k=r.useRef(),M=()=>{const E=k.current;E&&(E.scrollTop=0)},F=(E,C)=>{j(C),U(D,C)},z=E=>{let C=[];if(E){const R=ht[E]||[];C=s.filter(_=>_.category===E&&R.includes(_.name))}else for(const R in ht){const _=ht[R];C.push(...s.filter(se=>se.category===R&&_.includes(se.name)))}return C},w=E=>{if(c){const _=s.filter(H=>!Gs.includes(H.category));return _.push(...z()),_.filter(H=>{const X=H.name.toLowerCase().includes(E.toLowerCase()),J=H.label.toLowerCase().includes(E.toLowerCase()),de=H.category.toLowerCase().includes(E.toLowerCase());return X||de||J})}let C=s.filter(_=>_.category!=="Multi Agents"&&_.category!=="Sequential Agents");for(const _ in ft){const se=ft[_];C=C.filter(H=>!se.includes(H.name))}return C.filter(_=>{const se=_.name.toLowerCase().includes(E.toLowerCase()),H=_.label.toLowerCase().includes(E.toLowerCase()),X=_.category.toLowerCase().includes(E.toLowerCase());return se||X||H})},U=(E,C)=>{v(E),setTimeout(()=>{if(E){const R=w(E);V(R,C??y,!0),M()}else E===""&&(V(s,C??y),M())},500)},B=(E,C=0)=>{const R=E.filter(H=>!H.tags),_=E.filter(H=>H.tags&&H.tags.includes("LlamaIndex")),se=E.filter(H=>H.tags&&H.tags.includes("Utilities"));return C===0?R:C===1?_:se},V=(E,C,R)=>{if(c){const _={},se=E.reduce(function(X,J){return X[J.category]=X[J.category]||[],X[J.category].push(J),_[J.category]=!!R,X},Object.create(null)),H={};for(const X in se){if(ee){if(X!=="Agent Flows")continue}else if(X==="Agent Flows")continue;if(!Gs.includes(X)){const J=se[X].filter(de=>!de.tags||!de.tags.includes("LlamaIndex"));if(!J.length)continue;H[X]=J}Object.keys(ht).includes(X)&&(H[X]=z(X))}P(H),_["Multi Agents"]=!0,_["Sequential Agents"]=!0,_.Memory=!0,_["Agent Flows"]=!0,q(_)}else{const _=B(E,C),se={},H=_.reduce(function(J,de){return J[de.category]=J[de.category]||[],J[de.category].push(de),se[de.category]=!!R,J},Object.create(null)),X={};for(const J in H)if(!(J==="Agent Flows"||J==="Multi Agents"||J==="Sequential Agents")){if(Object.keys(ft).includes(J)){const de=ft[J];H[J]=H[J].filter(Ke=>!de.includes(Ke.name))}X[J]=H[J]}P(X),q(se)}},ce=E=>(C,R)=>{const _={...L};_[E]=R,q(_)},Se=E=>{x.current&&x.current.contains(E.target)||T(!1)},De=()=>{T(E=>!E)},we=(E,C)=>{E.dataTransfer.setData("application/reactflow",JSON.stringify(C)),E.dataTransfer.effectAllowed="move"},ne=E=>E===0?dn:E===1?On:Tr,ye=E=>{const C=Qt.find(R=>R.name===E.name);return C?e.jsx(C.icon,{size:30,color:E.color}):null};r.useEffect(()=>{p.current===!0&&$===!1&&x.current.focus(),p.current=$},[$]),r.useEffect(()=>{o&&T(!1)},[o]),r.useEffect(()=>{s&&(V(s),m({type:_o,componentNodes:s}))},[s,m]);const ge=()=>{I(!0),W({title:"What would you like to build?",description:"Enter your prompt to generate an agentflow. Performance may vary with different models. Only nodes and edges are generated, you will need to fill in the input fields for each node."})},ke=()=>{I(!1)},Ae=()=>{I(!1),h()};return e.jsxs(e.Fragment,{children:[e.jsx(st,{sx:{left:20,top:20},ref:x,size:"small",color:"primary","aria-label":"add",title:"Add Node",onClick:De,children:$?e.jsx(mr,{}):e.jsx(Ln,{})}),f&&e.jsx(st,{sx:{left:40,top:20,background:"linear-gradient(45deg, #FF6B6B 30%, #FF8E53 90%)","&:hover":{background:"linear-gradient(45deg, #FF8E53 30%, #FF6B6B 90%)"}},onClick:ge,size:"small",color:"primary","aria-label":"generate",title:"Generate Agentflow",children:e.jsx(Xt,{})}),e.jsx(da,{show:S,dialogProps:K,onCancel:ke,onConfirm:Ae}),e.jsx(ea,{placement:"bottom-end",open:$,anchorEl:x.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[-40,14]}}]},sx:{zIndex:1e3},children:({TransitionProps:E})=>e.jsx(ta,{in:$,...E,children:e.jsx(Yt,{children:e.jsx(sa,{onClickAway:Se,children:e.jsxs(aa,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:b.shadows[16],children:[e.jsxs(G,{sx:{p:2},children:[e.jsx(Ee,{children:e.jsx(oe,{variant:"h4",children:"Add Nodes"})}),e.jsx(Ue,{autoFocus:!0,sx:{width:"100%",pr:2,pl:2,my:2},id:"input-search-node",value:D,onChange:C=>U(C.target.value),placeholder:"Search nodes",startAdornment:e.jsx(Me,{position:"start",children:e.jsx(Un,{stroke:1.5,size:"1rem",color:b.palette.grey[500]})}),endAdornment:e.jsx(Me,{position:"end",sx:{cursor:"pointer",color:b.palette.grey[500],"&:hover":{color:b.palette.grey[900]}},title:"Clear Search",children:e.jsx(fe,{stroke:1.5,size:"1rem",onClick:()=>U(""),style:{cursor:"pointer"}})}),"aria-describedby":"search-helper-text",inputProps:{"aria-label":"weight"}}),!c&&e.jsx(zn,{sx:{position:"relative",minHeight:"50px",height:"50px"},variant:"fullWidth",value:y,onChange:F,"aria-label":"tabs",children:["LangChain","LlamaIndex","Utilities"].map((C,R)=>e.jsx(Go,{icon:e.jsx("div",{style:{borderRadius:"50%"},children:e.jsx("img",{style:{width:"20px",height:"20px",borderRadius:"50%",objectFit:"contain"},src:ne(R),alt:C})}),iconPosition:"start",sx:{minHeight:"50px",height:"50px"},label:C,...Mr(R)},R))}),e.jsx(at,{})]}),e.jsx(qo,{containerRef:C=>{k.current=C},style:{height:"100%",maxHeight:`calc(100vh - ${c?"300":"380"}px)`,overflowX:"hidden"},children:e.jsx(G,{sx:{p:2,pt:0},children:e.jsx(Vo,{sx:{width:"100%",maxWidth:370,py:0,borderRadius:"10px",[b.breakpoints.down("md")]:{maxWidth:370},"& .MuiListItemSecondaryAction-root":{top:22},"& .MuiDivider-root":{my:0},"& .list-container":{pl:7}},children:Object.keys(O).sort().map(C=>e.jsxs(ts,{expanded:L[C]||!1,onChange:ce(C),disableGutters:!0,children:[e.jsx(ss,{expandIcon:e.jsx(es,{}),"aria-controls":`nodes-accordian-${C}`,id:`nodes-accordian-header-${C}`,children:C.split(";").length>1?e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(oe,{variant:"h5",children:C.split(";")[0]})," ",e.jsx(Ne,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:C.split(";")[1]==="DEPRECATING"?b.palette.warning.main:b.palette.teal.main,color:C.split(";")[1]!=="DEPRECATING"?"white":"inherit"},size:"small",label:C.split(";")[1]})]}):e.jsx(oe,{variant:"h5",children:C})}),e.jsx(as,{children:O[C].map((R,_)=>e.jsxs("div",{onDragStart:se=>we(se,R),draggable:!0,children:[e.jsx(Qs,{sx:{p:0,borderRadius:`${d.borderRadius}px`,cursor:"move"},children:e.jsxs($n,{alignItems:"center",children:[R.color&&!R.icon?e.jsx(Ws,{children:e.jsx("div",{style:{width:50,height:"auto",display:"flex",alignItems:"center",justifyContent:"center"},children:ye(R)})}):e.jsx(Ws,{children:e.jsx("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:R.name,src:`${ve}/api/v1/node-icon/${R.name}`})})}),e.jsx(Jo,{sx:{ml:1},primary:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("span",{children:R.label})," ",R.badge&&e.jsx(Ne,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:R.badge==="DEPRECATING"?b.palette.warning.main:b.palette.teal.main,color:R.badge!=="DEPRECATING"?"white":"inherit"},size:"small",label:R.badge})]}),R.author&&e.jsxs("span",{style:{fontSize:"0.65rem",fontWeight:700},children:["By ",R.author]})]}),secondary:R.description})]})}),_===O[C].length-1?null:e.jsx(at,{})]},R.name))})]},C))})})})]})})})})})]})};pa.propTypes={nodesData:u.array,node:u.object,onFlowGenerated:u.func,isAgentCanvas:u.bool,isAgentflowv2:u.bool};const Yi=r.memo(pa);async function Er(s,o){const c=s.getReader();let f;for(;!(f=await c.read()).done;)o(f.value)}function Nr(s){let o,c,f,h=!1;return function(d){o===void 0?(o=d,c=0,f=-1):o=Rr(o,d);const m=o.length;let D=0;for(;c<m;){h&&(o[c]===10&&(D=++c),h=!1);let v=-1;for(;c<m&&v===-1;++c)switch(o[c]){case 58:f===-1&&(f=c-D);break;case 13:h=!0;case 10:v=c;break}if(v===-1)break;s(o.subarray(D,v),f),D=c,f=-1}D===m?o=void 0:D!==0&&(o=o.subarray(D),c-=D)}}function Fr(s,o,c){let f=qs();const h=new TextDecoder;return function(d,m){if(d.length===0)c==null||c(f),f=qs();else if(m>0){const D=h.decode(d.subarray(0,m)),v=m+(d[m+1]===32?2:1),O=h.decode(d.subarray(v));switch(D){case"data":f.data=f.data?f.data+`
`+O:O;break;case"event":f.event=O;break;case"id":s(f.id=O);break;case"retry":const P=parseInt(O,10);isNaN(P)||o(f.retry=P);break}}}}function Rr(s,o){const c=new Uint8Array(s.length+o.length);return c.set(s),c.set(o,s.length),c}function qs(){return{data:"",event:"",id:"",retry:void 0}}var Pr=function(s,o){var c={};for(var f in s)Object.prototype.hasOwnProperty.call(s,f)&&o.indexOf(f)<0&&(c[f]=s[f]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,f=Object.getOwnPropertySymbols(s);h<f.length;h++)o.indexOf(f[h])<0&&Object.prototype.propertyIsEnumerable.call(s,f[h])&&(c[f[h]]=s[f[h]]);return c};const bt="text/event-stream",Ur=1e3,Vs="last-event-id";function Or(s,o){var{signal:c,headers:f,onopen:h,onmessage:b,onclose:d,onerror:m,openWhenHidden:D,fetch:v}=o,O=Pr(o,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((P,$)=>{const T=Object.assign({},f);T.accept||(T.accept=bt);let L;function q(){L.abort(),document.hidden||W()}D||document.addEventListener("visibilitychange",q);let y=Ur,j=0;function S(){document.removeEventListener("visibilitychange",q),window.clearTimeout(j),L.abort()}c==null||c.addEventListener("abort",()=>{S(),P()});const I=v??window.fetch,K=h??Lr;async function W(){var ee;L=new AbortController;try{const x=await I(s,Object.assign(Object.assign({},O),{headers:T,signal:L.signal}));await K(x),await Er(x.body,Nr(Fr(p=>{p?T[Vs]=p:delete T[Vs]},p=>{y=p},b))),d==null||d(),S(),P()}catch(x){if(!L.signal.aborted)try{const p=(ee=m==null?void 0:m(x))!==null&&ee!==void 0?ee:y;window.clearTimeout(j),j=window.setTimeout(W,p)}catch(p){S(),$(p)}}}W()})}function Lr(s){const o=s.headers.get("content-type");if(!(o!=null&&o.startsWith(bt)))throw new Error(`Expected content-type to be ${bt}, Actual: ${o}`)}const Js="/assets/wave-sound-CdNNyn1h.jpg",zr=({show:s,onCancel:o,onConfirm:c})=>{const f=document.getElementById("portal"),h=Ge(),[b,d]=r.useState(""),m=r.useCallback(O=>d(O.target.value),[d]),D=()=>{c(b)};r.useEffect(()=>(h(s?{type:Ks}:{type:xt}),()=>{h({type:xt}),d("")}),[s,h]);const v=s?e.jsxs(Je,{onClose:o,open:s,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ot,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"Provide additional feedback"}),e.jsx(Ye,{children:e.jsx(G,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(Ue,{autoFocus:!0,id:"feedbackContentInput",multiline:!0,name:"feedbackContentInput",onChange:m,placeholder:"What do you think of the response?",rows:4,value:b,sx:{width:"100%"}})})}),e.jsxs(nt,{children:[e.jsx(Z,{onClick:o,children:"Cancel"}),e.jsx(oa,{variant:"contained",onClick:D,children:"Submit Feedback"})]})]}):null;return wt.createPortal(v,f)},ha=({isGrid:s,starterPrompts:o,sx:c,onPromptClick:f})=>e.jsx(G,{className:"button-container",sx:{width:"100%",maxWidth:s?"inherit":"400px",p:1.5,display:"flex",gap:1,...c},children:o.map((h,b)=>e.jsx(Ne,{label:h.prompt,className:"button",onClick:d=>f(h.prompt,d)},b))});ha.propTypes={isGrid:u.bool,starterPrompts:u.array,sx:u.object,onPromptClick:u.func};const $r="/assets/next-agent--RPptFkm.gif",os=({agent:s,index:o,customization:c,chatflowid:f,isDialog:h,onSourceDialogClick:b,renderArtifacts:d,agentReasoningArtifacts:m,getAgentIcon:D,removeDuplicateURL:v,isValidURL:O,onURLClick:P,getLabel:$})=>s.nextAgent?e.jsx(_e,{sx:{border:c.isDarkMode?"none":"1px solid #e0e0e0",borderRadius:`${c.borderRadius}px`,background:c.isDarkMode?"linear-gradient(to top, #303030, #212121)":"linear-gradient(to top, #f6f3fb, #f2f8fc)",mb:1},children:e.jsx(zs,{children:e.jsxs(Ee,{sx:{alignItems:"center",justifyContent:"flex-start",width:"100%"},flexDirection:"row",children:[e.jsx(G,{sx:{height:"auto",pr:1},children:e.jsx("img",{style:{objectFit:"cover",height:"35px",width:"auto"},src:$r,alt:"agentPNG"})}),e.jsx("div",{children:s.nextAgent})]})})},o):e.jsx(_e,{sx:{mb:1},children:e.jsxs(zs,{children:[e.jsxs(Ee,{sx:{alignItems:"center",justifyContent:"flex-start",width:"100%"},flexDirection:"row",children:[e.jsx(G,{sx:{height:"auto",pr:1},children:e.jsx("img",{style:{objectFit:"cover",height:"25px",width:"auto"},src:D(s.nodeName,s.instructions),alt:"agentPNG"})}),e.jsx("div",{children:s.agentName})]}),s.usedTools&&s.usedTools.length>0&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:s.usedTools.map((T,L)=>T!==null?e.jsx(Ne,{size:"small",label:T.tool,component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,icon:e.jsx(na,{size:15}),onClick:()=>b(T,"Used Tools")},L):null)}),s.state&&Object.keys(s.state).length>0&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.jsx(Ne,{size:"small",label:"State",component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,icon:e.jsx(un,{size:15}),onClick:()=>b(s.state,"State")})}),s.artifacts&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"row",width:"100%",gap:"8px"},children:m(s.artifacts).map((T,L)=>T!==null?e.jsx(e.Fragment,{children:d(T,L,!0)}):null)}),s.messages.length>0&&e.jsx(qt,{chatflowid:f,isFullWidth:h,children:s.messages.length>1?s.messages.join("\\n"):s.messages[0]}),s.instructions&&e.jsx("p",{children:s.instructions}),s.messages.length===0&&!s.instructions&&e.jsx("p",{children:"Finished"}),s.sourceDocuments&&s.sourceDocuments.length>0&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:v(s).map((T,L)=>{const q=T&&T.metadata&&T.metadata.source?O(T.metadata.source):void 0;return e.jsx(Ne,{size:"small",label:$(q,T)||"",component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>q?P(T.metadata.source):b(T)},L)})})]})},o);os.propTypes={agent:u.object.isRequired,index:u.number.isRequired,customization:u.object.isRequired,chatflowid:u.string,isDialog:u.bool,onSourceDialogClick:u.func.isRequired,renderArtifacts:u.func.isRequired,agentReasoningArtifacts:u.func.isRequired,getAgentIcon:u.func.isRequired,removeDuplicateURL:u.func.isRequired,isValidURL:u.func.isRequired,onURLClick:u.func.isRequired,getLabel:u.func.isRequired};os.displayName="AgentReasoningCard";const fa=s=>{switch(s){case"FINISHED":return"success.dark";case"ERROR":case"TIMEOUT":return"error.main";case"TERMINATED":case"STOPPED":return"error.main";case"INPROGRESS":return"warning.dark"}},Hr=qe(er)(({theme:s})=>({color:s.palette.grey[400]})),Br=qe(tr)(({theme:s})=>({flexDirection:"row-reverse",borderRadius:s.spacing(.7),marginBottom:s.spacing(.5),marginTop:s.spacing(.5),padding:s.spacing(.5),paddingRight:s.spacing(1),fontWeight:500,"&.Mui-expanded ":{"&:not(.Mui-focused, .Mui-selected, .Mui-selected.Mui-focused) .labelIcon":{color:s.palette.primary.dark,...s.applyStyles("light",{color:s.palette.primary.main})},"&::before":{content:'""',display:"block",position:"absolute",left:"16px",top:"44px",height:"calc(100% - 48px)",width:"1.5px",backgroundColor:s.palette.grey[700],...s.applyStyles("light",{backgroundColor:s.palette.grey[300]})}},"&:hover":{backgroundColor:Ko(s.palette.primary.main,.1),color:"white",...s.applyStyles("light",{color:s.palette.primary.main})},"&.Mui-focused, &.Mui-selected, &.Mui-selected.Mui-focused":{backgroundColor:s.palette.primary.dark,color:s.palette.primary.contrastText,...s.applyStyles("light",{backgroundColor:s.palette.primary.main})}})),Wr=qe(oe)(({theme:s})=>({color:s.palette.text.primary}));function ns({icon:s,itemStatus:o,children:c,name:f,label:h,data:b,metadata:d,...m}){const[D,v]=r.useState(!1),O=T=>{T.stopPropagation(),v(!0)},P=()=>v(!1),$=f==="iterationAgentflow";return e.jsxs(sr,{...m,sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e.jsxs(G,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[(()=>{if($)return e.jsx(G,{sx:{mr:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Xo,{size:20,color:"#9C89B8"})});const T=Qt.find(L=>L.name===f);return T?e.jsx(G,{sx:{mr:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(T.icon,{size:20,color:T.color})}):null})(),e.jsx(Wr,{sx:{flex:1},children:c}),e.jsx(pe,{onClick:O,size:"small",title:"View Details",sx:{ml:2,zIndex:10},children:e.jsx(ia,{size:15,color:"teal"})}),s&&e.jsx(G,{component:s,className:"labelIcon",color:fa(o),sx:{ml:1,fontSize:"1.2rem"}})]}),e.jsxs(Je,{open:D,onClose:P,maxWidth:"md",fullWidth:!0,disableBackdropClick:!0,children:[e.jsx(Ye,{onClick:T=>T.stopPropagation(),children:b?e.jsx(ar,{data:b,label:h,metadata:d}):e.jsx(oe,{color:"text.secondary",children:"No data available for this item"})}),e.jsx(nt,{children:e.jsx(Z,{onClick:P,children:"Close"})})]})]})}ns.propTypes={icon:u.elementType,itemStatus:u.string,expandable:u.bool,children:u.node,name:u.string,label:u.string,status:u.object,data:u.object,metadata:u.object};ns.displayName="CustomLabel";const ga=s=>Array.isArray(s)?s.length>0&&s.some(ga):!!s,ma=(s,o)=>{switch(s){case"FINISHED":return qn;case"ERROR":case"TIMEOUT":return Gn;case"TERMINATED":return c=>e.jsx(lr,{...c,color:o.palette.error.main});case"STOPPED":return ir;case"INPROGRESS":return c=>e.jsx(rr,{...c,color:o.palette.warning.dark,className:`spin-animation ${c.className||""}`})}},rs=r.forwardRef(function(o,c){var p;const{id:f,itemId:h,label:b,disabled:d,children:m,agentflowId:D,sessionId:v,...O}=o,P=Oe(),{getRootProps:$,getContentProps:T,getIconContainerProps:L,getCheckboxProps:q,getLabelProps:y,getGroupTransitionProps:j,getDragAndDropOverlayProps:S,status:I,publicAPI:K}=Vn({id:f,itemId:h,children:m,label:b,disabled:d,rootRef:c}),W=K.getItem(h),ee=ga(m);let x;return W.status&&(x=ma(W.status,P)),e.jsx(Jn,{itemId:h,children:e.jsxs(Hr,{...$(O),children:[e.jsxs(Br,{...T(),children:[e.jsx(Yn,{...L(),children:e.jsx(Kn,{status:I})}),e.jsx(Xn,{...q()}),e.jsx(ns,{...y({icon:x,itemStatus:W.status,expandable:ee&&I.expanded,name:W.name||((p=W.id)==null?void 0:p.split("_")[0]),label:W.label,status:I,data:W.data,metadata:{agentflowId:D,sessionId:v}})}),e.jsx(Qn,{...S()})]}),m&&e.jsx(Zn,{...j(),style:{borderLeft:`${I.selected?"3px solid":"1px dashed"} ${(()=>{var F;const k=W.name||((F=W.id)==null?void 0:F.split("_")[0]),M=Qt.find(z=>z.name===k);return M?M.color:P.palette.primary.main})()}`,marginLeft:"13px",paddingLeft:"8px"}})]})})});rs.propTypes={id:u.string,itemId:u.string,label:u.string,disabled:u.bool,children:u.node,agentflowId:u.string,sessionId:u.string,className:u.string};rs.displayName="CustomTreeItem";const xa=({status:s,execution:o,agentflowId:c,sessionId:f})=>{const[h,b]=r.useState([]),[d,m]=r.useState([]),[D,v]=r.useState(null),O=Oe(),P=y=>{let j=[];return y.forEach(S=>{j.push(S.id),S.children&&S.children.length>0&&(j=[...j,...P(S.children)])}),j},$=y=>{y.forEach(x=>{const p=k=>{for(const M in k)M===Yo&&delete k[M],typeof k[M]=="object"&&p(k[M])};p(x.data)});const j=new Map;y.forEach((x,p)=>{const k=`${x.nodeId}_${p}`;j.set(k,{...x,uniqueNodeId:k,children:[],executionIndex:p})});const S=new Map;y.forEach((x,p)=>{var k,M;if((k=x.data)!=null&&k.parentNodeId&&((M=x.data)==null?void 0:M.iterationIndex)!==void 0){const F=x.data.parentNodeId,z=x.data.iterationIndex;S.has(F)||S.set(F,new Map);const w=S.get(F);w.has(z)||w.set(z,[]),w.get(z).push(`${x.nodeId}_${p}`)}}),S.forEach((x,p)=>{x.forEach((k,M)=>{var we;let F=null;for(let ne=0;ne<y.length;ne++)if(y[ne].nodeId===p){F=y[ne];break}if(!F)return;const z=k[0],w=j.get(z),U=((we=w==null?void 0:w.data)==null?void 0:we.iterationContext)||{index:M},B=`${p}_${M}`,V=`Iteration #${M}`,ce=k.map(ne=>j.get(ne)),Se=ce.some(ne=>ne.status==="ERROR")?"ERROR":ce.some(ne=>ne.status==="INPROGRESS")?"INPROGRESS":ce.every(ne=>ne.status==="FINISHED")?"FINISHED":"UNKNOWN",De={nodeId:B,nodeLabel:V,data:{name:"iterationAgentflow",iterationIndex:M,iterationContext:U,isVirtualNode:!0,parentIterationId:p},previousNodeIds:[],status:Se,uniqueNodeId:B,children:[],executionIndex:-1};j.set(B,De),k.forEach(ne=>{const ye=j.get(ne);ye&&(ye.virtualParentId=B)})})});const I=[],K=new Set;y.forEach((x,p)=>{var F,z;const k=`${x.nodeId}_${p}`,M=j.get(k);if(!((F=x.data)!=null&&F.parentNodeId&&((z=x.data)==null?void 0:z.iterationIndex)!==void 0))if(x.previousNodeIds.length===0)I.push(M);else{let w=-1,U=null;if(x.previousNodeIds.forEach(B=>{for(let V=0;V<p;V++)y[V].nodeId===B&&V>w&&(w=V,U=B)}),w!==-1){const B=`${U}_${w}`,V=j.get(B);V&&(V.children.push(M),K.add(k))}}}),S.forEach((x,p)=>{const k=[];y.forEach((F,z)=>{F.nodeId===p&&k.push(`${F.nodeId}_${z}`)});let M=null;for(let F=k.length-1;F>=0;F--){const z=k[F],w=j.get(z);if(w){M=w;break}}M&&x.forEach((F,z)=>{const w=`${p}_${z}`,U=j.get(w);U&&M.children.push(U)})}),j.forEach(x=>{if(x.virtualParentId){const p=j.get(x.virtualParentId);if(p)if(x.previousNodeIds.length===0)p.children.push(x);else{let k=!1;for(const M of x.previousNodeIds)j.forEach(F=>{var z,w,U,B;F.nodeId===M&&((z=F.data)==null?void 0:z.iterationIndex)===((w=x.data)==null?void 0:w.iterationIndex)&&((U=F.data)==null?void 0:U.parentNodeId)===((B=x.data)==null?void 0:B.parentNodeId)&&!k&&(F.children.push(x),k=!0)});k||p.children.push(x)}}});const W=x=>{x.children&&x.children.length>0&&(x.children.sort((p,k)=>{var z,w,U,B;const M=((z=p.data)==null?void 0:z.name)==="iterationAgentflow"||((w=p.data)==null?void 0:w.isVirtualNode),F=((U=k.data)==null?void 0:U.name)==="iterationAgentflow"||((B=k.data)==null?void 0:B.isVirtualNode);return M===F?p.executionIndex-k.executionIndex:M?-1:1}),x.children.forEach(W))};I.forEach(W);const ee=x=>{var p;return{id:x.uniqueNodeId,label:x.nodeLabel,name:(p=x.data)==null?void 0:p.name,status:x.status,data:x.data,children:x.children.map(ee)}};return I.map(ee)},T=(y,j)=>{m(j)};r.useEffect(()=>{if(o){const y=$(o);b(y),m(P(y)),y.length>0&&v(y[0])}},[o]);const L=(y,j)=>{const S=(K,W)=>{for(const ee of K){if(ee.id===W)return ee;if(ee.children){const x=S(ee.children,W);if(x)return x}}return null},I=S(h,j);v(I)},q=r.useCallback(y=>{const j=I=>{let K=[];return I.forEach(W=>{W.status&&K.push(W.status),W.children&&W.children.length>0&&(K=[...K,...j(W.children)])}),K},S=j(y);return S.includes("ERROR")?"ERROR":S.includes("INPROGRESS")?"INPROGRESS":S.includes("STOPPED")?"STOPPED":S.every(I=>I==="FINISHED")?"FINISHED":null},[]);return e.jsx(G,{sx:{display:"flex",height:"100%",width:"100%",mt:2},children:e.jsxs(ts,{sx:{width:"100%"},children:[e.jsxs(ss,{expandIcon:e.jsx(es,{}),sx:{"& .MuiAccordionSummary-content":{alignItems:"center"}},children:[h.length>0&&(()=>{const y=s??q(h);return e.jsx(G,{sx:{mr:1,fontSize:"1.2rem"},children:e.jsx(G,{component:ma(y,O),sx:{mr:1,fontSize:"1.2rem",color:fa(y)}})})})(),e.jsx(oe,{children:"Process Flow"})]}),e.jsx(at,{}),e.jsx(as,{children:e.jsx(_n,{expandedItems:d,onExpandedItemsChange:T,selectedItems:D?[D.id]:[],onSelectedItemsChange:L,items:h,slots:{item:y=>e.jsx(rs,{...y,agentflowId:c,sessionId:f})},sx:{width:"100%"}})})]})})};xa.propTypes={status:u.string,execution:u.array,agentflowId:u.string,sessionId:u.string};const _r=r.memo(xa),Gr=qe(Re)(({theme:s})=>({position:"relative",height:200,borderRadius:"10px",[s.breakpoints.down("sm")]:{width:"100% !important",height:100},"&:hover, &.Mui-focusVisible":{zIndex:1,"& .MuiImageBackdrop-root":{opacity:.4},"& .MuiImageMarked-root":{opacity:1},"& .MuiTypography-root":{border:"4px solid currentColor"}}})),qr=qe("span")({position:"absolute",borderRadius:"10px",left:0,right:0,top:0,bottom:0,backgroundSize:"cover",backgroundPosition:"center 40%"}),Vr=qe("span")(({theme:s})=>({position:"absolute",borderRadius:"10px",left:0,right:0,top:0,bottom:0,backgroundColor:s.palette.common.black,opacity:.1,transition:s.transitions.create("opacity")})),Jr=qe("span")(()=>({height:25,width:25,backgroundColor:"transparent",position:"absolute",top:"auto",left:"auto",opacity:0})),ya=s=>{const o=Ie(c=>c.customization);return e.jsx(pe,{disabled:s.isDisabled||s.isLoading,onClick:s.onClick,size:"small",sx:{background:"transparent",border:"none"},title:"Copy to clipboard",children:e.jsx(Cn,{style:{width:"20px",height:"20px"},color:s.isLoading?"#9e9e9e":o.isDarkMode?"white":"#1e88e5"})})};ya.propTypes={isDisabled:u.bool,isLoading:u.bool,onClick:u.func};const ba=s=>{const o=Ie(c=>c.customization);return e.jsx(pe,{disabled:s.isDisabled||s.isLoading,onClick:s.onClick,size:"small",sx:{background:"transparent",border:"none"},title:"Thumbs Up",children:e.jsx(Cr,{style:{width:"20px",height:"20px"},color:s.rating==="THUMBS_UP"?"#9e9e9e":o.isDarkMode?"white":"#1e88e5"})})};ba.propTypes={isDisabled:u.bool,isLoading:u.bool,onClick:u.func,rating:u.string};const ja=s=>{const o=Ie(c=>c.customization);return e.jsx(pe,{disabled:s.isDisabled||s.isLoading,onClick:s.onClick,size:"small",sx:{background:"transparent",border:"none"},title:"Thumbs Down",children:e.jsx(wr,{style:{width:"20px",height:"20px"},color:s.rating==="THUMBS_DOWN"?"#9e9e9e":o.isDarkMode?"white":"#1e88e5"})})};ja.propTypes={isDisabled:u.bool,isLoading:u.bool,onClick:u.func,rating:u.string};let is,wa;function Yr(){is=document.getElementsByClassName("start-recording-button")[0]}function Kr(){is.style.display="none",ei()}function ka(){is.style.display="block",clearInterval(va)}let Ca,Xr=1,va;function Qr(s,o){Yr(),ie.start().then(()=>{s&&s(!0),Ca=new Date,Kr()}).catch(c=>{switch(c.message.includes("mediaDevices API or getUserMedia method is not supported in this browser.")&&o&&o(!0),c.name){case"AbortError":console.log("An AbortError has occurred.");break;case"NotAllowedError":console.log("A NotAllowedError has occurred. User might have denied permission.");break;case"NotFoundError":console.log("A NotFoundError has occurred.");break;case"NotReadableError":console.log("A NotReadableError has occurred.");break;case"SecurityError":console.log("A SecurityError has occurred.");break;case"TypeError":console.log("A TypeError has occurred.");break;case"InvalidStateError":console.log("An InvalidStateError has occurred.");break;case"UnknownError":console.log("An UnknownError has occurred.");break;default:console.log("An error occurred with the error name "+c.name)}})}function Ia(s){ie.stop().then(o=>{ka(),s&&s(o)}).catch(o=>{switch(o.name){case"InvalidStateError":console.log("An InvalidStateError has occurred.");break;default:console.log("An error occurred with the error name "+o.name)}})}function Zr(){ie.cancel(),ka()}function ei(){wa=document.getElementById("elapsed-time"),Ys("00:00"),va=setInterval(()=>{let s=si(Ca);Ys(s)},1e3)}function Ys(s){wa.innerHTML=s,ti(s)&&Ia()}function ti(s){let o=s.split(":"),c="0"+Xr;return o.length===3&&o[0]===c}function si(s){let c=new Date-s;c=c/1e3;let f=Math.floor(c%60);f=f<10?"0"+f:f,c=Math.floor(c/60);let h=c%60;h=h<10?"0"+h:h,c=Math.floor(c/60);let b=c%24;c=Math.floor(c/24);let m=b+c*24;return m=m<10?"0"+m:m,m==="00"?h+":"+f:m+":"+h+":"+f}const ie={audioBlobs:[],mediaRecorder:null,streamBeingCaptured:null,start:function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(s=>{ie.streamBeingCaptured=s,ie.mediaRecorder=new MediaRecorder(s),ie.audioBlobs=[],ie.mediaRecorder.addEventListener("dataavailable",o=>{ie.audioBlobs.push(o.data)}),Qo?ie.mediaRecorder.start(1e3):ie.mediaRecorder.start()}):Promise.reject(new Error("mediaDevices API or getUserMedia method is not supported in this browser."))},stop:function(){return new Promise(s=>{let o=ie.mediaRecorder.mimeType;ie.mediaRecorder.addEventListener("stop",()=>{let c=new Blob(ie.audioBlobs,{type:o});s(c)}),ie.cancel()})},cancel:function(){ie.mediaRecorder.stop(),ie.stopStream(),ie.resetRecordingProperties()},stopStream:function(){ie.streamBeingCaptured.getTracks().forEach(s=>s.stop())},resetRecordingProperties:function(){ie.mediaRecorder=null,ie.streamBeingCaptured=null}},ai=(s,o,c)=>Zt.post(`/attachments/${s}/${o}`,c,{headers:{"Content-Type":"multipart/form-data"}}),oi={createAttachment:ai},ni=(s,o)=>Zt.post(`/feedback/${s}`,o),ri=(s,o)=>Zt.put(`/feedback/${s}`,o),Bt={addFeedback:ni,updateFeedback:ri},Sa=({isGrid:s,followUpPrompts:o,sx:c,onPromptClick:f})=>{const h=Ie(b=>b.customization);return e.jsx(G,{className:"button-container",sx:{width:"100%",maxWidth:s?"inherit":"400px",p:1.5,display:"flex",gap:1,...c},children:Array.isArray(o)&&o.map((b,d)=>e.jsx(Ne,{label:b,className:"button",onClick:m=>f(b,m),sx:{backgroundColor:"transparent",border:"1px solid",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2)",color:"#2196f3",transition:"all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms","&:hover":{backgroundColor:h.isDarkMode?"rgba(0, 0, 0, 0.12)":"rgba(0, 0, 0, 0.05)",border:"1px solid"}}},d))})};Sa.propTypes={isGrid:u.bool,followUpPrompts:u.array,sx:u.object,onPromptClick:u.func};class ii{constructor(o=10){this.history=[],this.currentIndex=-1,this.tempInput="",this.maxHistory=o,this.loadHistory()}addToHistory(o){o.trim()&&(this.history[0]!==o&&(this.history.unshift(o),this.history.length>this.maxHistory&&this.history.pop()),this.currentIndex=-1,this.saveHistory())}getPreviousInput(o){return this.currentIndex===-1&&(this.tempInput=o),this.currentIndex<this.history.length-1?(this.currentIndex++,this.history[this.currentIndex]):this.history[this.currentIndex]||this.tempInput}getNextInput(){return this.currentIndex>-1?(this.currentIndex--,this.currentIndex===-1?this.tempInput:this.history[this.currentIndex]):this.tempInput}saveHistory(){try{localStorage.setItem("chatInputHistory",JSON.stringify(this.history))}catch(o){console.warn("Failed to save chat history to localStorage:",o)}}loadHistory(){try{const o=localStorage.getItem("chatInputHistory");o&&(this.history=JSON.parse(o))}catch(o){console.warn("Failed to load chat history from localStorage:",o)}}}const li={width:"128px",height:"128px",objectFit:"cover"},Da=({item:s,disabled:o,customization:c,onDelete:f})=>{const[h,b]=r.useState(!1),d=c.isDarkMode?"rgba(0, 0, 0, 0.3)":"transparent";return e.jsxs("div",{onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),style:{position:"relative",display:"inline-block"},children:[e.jsxs(_e,{sx:{display:"inline-flex",alignItems:"center",height:"48px",width:"max-content",p:2,mr:1,flex:"0 0 auto",transition:"opacity 0.3s",opacity:1,backgroundColor:h?"rgba(0, 0, 0, 0.3)":d},variant:"outlined",children:[e.jsx(mt,{size:20,style:{transition:"filter 0.3s",filter:h?"blur(2px)":"none"}}),e.jsx("span",{style:{marginLeft:"5px",color:c.isDarkMode?"white":"inherit",transition:"filter 0.3s",filter:h?"blur(2px)":"none"},children:s.name})]}),h&&!o&&e.jsx(Z,{disabled:o,onClick:()=>f(s),startIcon:e.jsx(yt,{color:"white",size:22}),title:"Remove attachment",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"}}})]})};Da.propTypes={item:u.object,customization:u.object,disabled:u.bool,onDelete:u.func};const Aa=({open:s,chatflowid:o,isAgentCanvas:c,isDialog:f,previews:h,setPreviews:b})=>{var Rs,Ps;const d=Oe(),m=Ie(t=>t.customization),D=r.useRef(),v=Ge(),{onAgentflowNodeStatusUpdate:O,clearAgentflowNodeStatus:P}=r.useContext(Kt);jt();const $=(...t)=>v(rt(...t)),T=(...t)=>v(it(...t)),[L,q]=r.useState(""),[y,j]=r.useState(!1),[S,I]=r.useState([{message:"Hi there! How can I help?",type:"apiMessage"}]),[K,W]=r.useState(!1),[ee,x]=r.useState(!1),[p,k]=r.useState(!1),[M,F]=r.useState({}),[z,w]=r.useState(cr()),[U,B]=r.useState(!1),[V,ce]=r.useState([]),[Se,De]=r.useState(""),[we,ne]=r.useState(""),[ye]=r.useState(new ii(10)),ge=r.useRef(null),ke=Pe(_t.getInternalChatmessageFromChatflow),Ae=Pe(or.getAllExecutions),E=Pe(tt.getIsChatflowStreaming),C=Pe(tt.getAllowChatflowUploads),R=Pe(tt.getSpecificChatflow),[_,se]=r.useState([]),[H,X]=r.useState(!1),[J,de]=r.useState("*"),[Ke,lt]=r.useState(!1),[kt,Xe]=r.useState(""),[Ct,Y]=r.useState(!1),[te,be]=r.useState(null),[Te,Le]=r.useState(""),[xe,ze]=r.useState(""),[vt,Na]=r.useState(""),[Fa,ls]=r.useState(!1),[Ra,cs]=r.useState(!1),[It,Pa]=r.useState(!1),[ds,Ve]=r.useState([]),us=r.useRef(null),ps=r.useRef(null),[$e,Ua]=r.useState(!1),[He,St]=r.useState(!1),[Dt,Oa]=r.useState(!1),[hs,At]=r.useState(!1),[La,Qe]=r.useState(!1),[fs,Tt]=r.useState(!1),[za,$a]=r.useState(!1),[Ha,Mt]=r.useState(!1),[gs,Et]=r.useState(""),[ms,Nt]=r.useState(null),[Ba,xs]=r.useState(""),[Wa,_a]=r.useState(""),[Ga,qa]=r.useState(""),[Va,Ja]=r.useState(""),[ys,bs]=r.useState({}),[js,Ya]=r.useState([]),[Ka,Ft]=r.useState(!0),ws=t=>{const n=C.data;let a=!1;if(!n)return console.warn("Upload constraints not loaded yet"),!1;if(n.isImageUploadAllowed){const i=t.type,l=t.size/1024/1024;n.imgUploadSizeAndTypes&&Array.isArray(n.imgUploadSizeAndTypes)&&n.imgUploadSizeAndTypes.forEach(g=>{g.fileTypes&&g.fileTypes.includes(i)&&l<=g.maxUploadSize&&(a=!0)})}if(H)return!0;if(n.isRAGFileUploadAllowed){const i=t.name.split(".").pop();i&&n.fileUploadSizeAndTypes&&Array.isArray(n.fileUploadSizeAndTypes)&&n.fileUploadSizeAndTypes.forEach(l=>{(l.fileTypes&&l.fileTypes.length===1&&l.fileTypes[0]==="*"||l.fileTypes&&l.fileTypes.includes(`.${i}`))&&(a=!0)})}return a||alert("Cannot upload file. Kindly check the allowed file types and maximum allowed size."),a},Xa=async t=>{if(!$e&&!He)return;t.preventDefault(),At(!1);let n=[],a=[];if(t.dataTransfer.files.length>0){for(const l of t.dataTransfer.files){if(ws(l)===!1)return;const g=new FileReader,{name:A}=l;(!l.type||!Se.includes(l.type))&&a.push({file:l,type:H?"file:full":"file:rag"}),n.push(new Promise(Q=>{g.onload=N=>{var ae;if(!((ae=N==null?void 0:N.target)!=null&&ae.result))return;const{result:ue}=N.target;let me;l.type.startsWith("audio/")?me=Js:me=URL.createObjectURL(l),Q({data:ue,preview:me,type:"file",name:A,mime:l.type})},g.readAsDataURL(l)}))}const i=await Promise.all(n);ce(a),b(l=>[...l,...i])}if(t.dataTransfer.items)for(const i of t.dataTransfer.items)i.kind==="string"&&i.type.match("^text/uri-list")?i.getAsString(l=>{let g={data:l,preview:l,type:"url",name:l?l.substring(l.lastIndexOf("/")+1):""};b(A=>[...A,g])}):i.kind==="string"&&i.type.match("^text/html")&&i.getAsString(l=>{if(l.indexOf("href")===-1)return;let g=l?l.substring(l.indexOf("href")+6):"",A=g.substring(0,g.indexOf('"')),Q={data:A,preview:A,type:"url",name:A?A.substring(A.lastIndexOf("/")+1):""};b(N=>[...N,Q])})},ks=async t=>{if(!(t.target.files&&t.target.files[0]))return;let a=[],i=[];for(const g of t.target.files){if(ws(g)===!1)return;(!g.type||!Se.includes(g.type))&&i.push({file:g,type:H?"file:full":"file:rag"});const A=new FileReader,{name:Q}=g;a.push(new Promise(N=>{A.onload=ue=>{var ae;if(!((ae=ue==null?void 0:ue.target)!=null&&ae.result))return;const{result:me}=ue.target;N({data:me,preview:URL.createObjectURL(g),type:"file",name:Q,mime:g.type})},A.readAsDataURL(g)}))}const l=await Promise.all(a);ce(i),b(g=>[...g,...l]),t.target.value=null},Qa=t=>{let n="";const a=t.type.indexOf(";");a===-1?n=t.type:n=t.type?t.type.substring(0,a):"";const i=new FileReader;i.readAsDataURL(t),i.onloadend=()=>{const g={data:i.result,preview:Js,type:"audio",name:`audio_${Date.now()}.wav`,mime:n};b(A=>[...A,g])}},ct=t=>{($e||He)&&(t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?At(!0):t.type==="dragleave"&&At(!1))},Za=async()=>{B(!0);try{await _t.abortMessage(o,z)}catch(t){B(!1),$({message:typeof t.response.data=="object"?t.response.data.message:t.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:n=>e.jsx(Z,{style:{color:"white"},onClick:()=>T(n),children:e.jsx(fe,{})})}})}},Rt=t=>{t.type==="file"&&URL.revokeObjectURL(t.preview),b(h.filter(n=>n!==t))},Cs=()=>{ps.current.click()},vs=()=>{us.current.click()},eo=()=>{h.forEach(t=>URL.revokeObjectURL(t.preview)),b([])},to=()=>{Qe(!0),Qr(Qe,Tt)},Is=()=>{fs||Zr(),Qe(!1),Tt(!1)},so=async()=>{$a(!0),Ia(Qa)},Pt=(t,n)=>{F({data:t,title:n}),k(!0)},Ss=t=>{window.open(t,"_blank")},dt=()=>{D.current&&D.current.scrollTo({top:en})},ao=r.useCallback(t=>q(t.target.value),[q]),oo=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].message+=t,a[a.length-1].feedback=null),a})},no=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a.push({message:t,type:"apiMessage"}),a})},ro=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].sourceDocuments=t),a})},io=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].agentReasoning=t),a})},lo=t=>{I(t==="INPROGRESS"?n=>[...n,{message:"",type:"apiMessage",agentFlowEventStatus:t}]:n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].agentFlowEventStatus=t),a})},co=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].agentFlowExecutedData=t),a})},uo=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].action=t),a})},po=t=>{t.forEach(n=>{(n.type==="png"||n.type==="jpeg")&&(n.data=`${ve}/api/v1/get-upload-file?chatflowId=${o}&chatId=${z}&fileName=${n.data.replace("FILE-STORAGE::","")}`)}),I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].artifacts=t),a})},ho=t=>{I(n=>{let a=[...re.cloneDeep(n)];if(a[a.length-1].type==="userMessage")return a;const i=a[a.length-1].agentReasoning;return i&&i.length>0&&i.push({nextAgent:t}),a[a.length-1].agentReasoning=i,a})},fo=t=>{O(t)},go=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].usedTools=t),a})},mo=t=>{I(n=>{let a=[...re.cloneDeep(n)];return a[a.length-1].type==="userMessage"||(a[a.length-1].fileAnnotations=t),a})},xo=()=>{B(!1),I(t=>{let n=[...re.cloneDeep(t)];if(n[n.length-1].type==="userMessage")return n;const a=n[n.length-1].agentReasoning;return a&&a.length>0&&(n[n.length-1].agentReasoning=a.filter(i=>!i.nextAgent)),n}),setTimeout(()=>{var t;(t=ge.current)==null||t.focus()},100),$({message:"Message stopped",options:{key:new Date().getTime()+Math.random(),variant:"success",action:t=>e.jsx(Z,{style:{color:"white"},onClick:()=>T(t),children:e.jsx(fe,{})})}})},Ds=(t="Oops! There seems to be an error. Please try again.")=>{t=t.replace(`Unable to parse JSON response from chat agent.

`,""),I(n=>[...n,{message:t,type:"apiMessage"}]),j(!1),q(""),ce([]),setTimeout(()=>{var n;(n=ge.current)==null||n.focus()},100)},As=async t=>{q(t),Be(void 0,t)},yo=async t=>{q(t),Ve([]),Be(void 0,t)},Ts=(t,n="",a="")=>{let i=Ba;a&&(i=a);const l=n||i.charAt(0).toUpperCase()+i.slice(1);Be(void 0,l,void 0,{type:i,startNodeId:t==null?void 0:t.nodeId,feedback:n})},Ms=()=>{ms&&(Ts(ms,gs),Mt(!1),Et(""),Nt(null),xs(""))},Ut=async(t,n)=>{if(q(t.label),I(a=>{let i=[...re.cloneDeep(a)];return i[i.length-1].type==="userMessage"||(i[i.length-1].action=null),i}),t.type.includes("agentflowv2")){const a=t.type.includes("approve")?"proceed":"reject";xs(a),n.data&&n.data.input&&n.data.input.humanInputEnableFeedback?(Nt(n.data),Mt(!0)):Ts(n.data,"",a)}else Be(void 0,t.label,n)},Es=(t,n)=>{if(t.chatMessageId&&I(a=>{let i=[...re.cloneDeep(a)];return i[i.length-1].type==="apiMessage"&&(i[i.length-1].id=t.chatMessageId),i}),t.chatId&&w(t.chatId),n===""&&t.question&&I(a=>{let i=[...re.cloneDeep(a)];return i[i.length-2].type==="apiMessage"||(i[i.length-2].message=t.question),i}),t.followUpPrompts){const a=JSON.parse(t.followUpPrompts);Ve(typeof a=="string"?JSON.parse(a):a)}},bo=async t=>{if(!V.length)return t;if(H){const n=V.filter(a=>a.type==="file:full");if(n.length>0){const a=new FormData;for(const g of n)a.append("files",g.file);a.append("chatId",z);const l=(await oi.createAttachment(o,z,a)).data;for(const g of l){const A=g.content,Q=g.name,N=t.findIndex(ue=>ue.name===Q);N!==-1&&(t[N]={...t[N],data:A,name:Q,type:"file:full"})}}}else if(Dt){const n=V.filter(a=>a.type==="file:rag");if(n.length>0){const a=new FormData;for(const l of n)a.append("files",l.file);a.append("chatId",z),await Gt.upsertVectorStoreWithFormData(o,a),await(l=>new Promise(g=>setTimeout(g,l)))(2500),t=t.map(l=>({...l,type:"file:rag"}))}}return t},Be=async(t,n,a,i)=>{if(t&&t.preventDefault(),!n&&L.trim()===""){const A=h.filter(Q=>!Q.mime.startsWith("image")&&Q.type!=="audio").length>0;if(!h.length||h.length&&A)return}let l=L;typeof n=="string"?(n!==void 0&&n.trim()!==""&&(l=n),l.trim()&&ye.addToHistory(l)):typeof n=="object"&&(l=Object.entries(n).map(([A,Q])=>`${A}: ${Q}`).join(`
`)),j(!0),P();let g=h.map(A=>({data:A.data,type:A.type,name:A.name,mime:A.mime}));try{g=await bo(g)}catch{Ds("Unable to upload documents");return}eo(),I(A=>[...A,{message:l,type:"userMessage",fileUploads:g}]);try{const A={question:l,chatId:z};if(typeof n=="object"&&(A.form=n,delete A.question),g&&g.length>0&&(A.uploads=g),xe&&(A.leadEmail=xe),a&&(A.action=a),i&&(A.humanInput=i),K)jo(o,A);else{const Q=await nr.sendMessageAndGetPrediction(o,A);if(Q.data){const N=Q.data;Es(N,l);let ue="";N.text?ue=N.text:N.json?ue="```json\n"+JSON.stringify(N.json,null,2):ue=JSON.stringify(N,null,2),I(me=>[...me,{message:ue,id:N==null?void 0:N.chatMessageId,sourceDocuments:N==null?void 0:N.sourceDocuments,usedTools:N==null?void 0:N.usedTools,calledTools:N==null?void 0:N.calledTools,fileAnnotations:N==null?void 0:N.fileAnnotations,agentReasoning:N==null?void 0:N.agentReasoning,agentFlowExecutedData:N==null?void 0:N.agentFlowExecutedData,action:N==null?void 0:N.action,artifacts:N==null?void 0:N.artifacts,type:"apiMessage",feedback:null}]),et(o,N.chatId),j(!1),q(""),ce([]),setTimeout(()=>{var me;(me=ge.current)==null||me.focus(),dt()},100)}}}catch(A){Ds(A.response.data.message);return}},jo=async(t,n)=>{const a=n.chatId,i=n.question;n.streaming=!0,await Or(`${ve}/api/v1/internal-prediction/${t}`,{openWhenHidden:!0,method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json","x-request-from":"internal"},async onopen(l){l.ok&&l.headers.get("content-type")},async onmessage(l){const g=JSON.parse(l.data);switch(g.event){case"start":I(A=>[...A,{message:"",type:"apiMessage"}]);break;case"token":oo(g.data);break;case"sourceDocuments":ro(g.data);break;case"usedTools":go(g.data);break;case"fileAnnotations":mo(g.data);break;case"agentReasoning":io(g.data);break;case"agentFlowEvent":lo(g.data);break;case"agentFlowExecutedData":co(g.data);break;case"artifacts":po(g.data);break;case"action":uo(g.data);break;case"nextAgent":ho(g.data);break;case"nextAgentFlow":fo(g.data);break;case"metadata":Es(g.data,i);break;case"error":no(g.data);break;case"abort":xo(g.data),ut();break;case"end":et(t,a),ut();break}},async onclose(){ut()},async onerror(l){throw console.error("EventSource Error: ",l),ut(),l}})},ut=()=>{j(!1),q(""),ce([]),setTimeout(()=>{var t;(t=ge.current)==null||t.focus(),dt()},100)},wo=t=>{const n=t.isComposing||t.keyCode===229;if(t.key==="ArrowUp"&&!n){t.preventDefault();const a=ye.getPreviousInput(L);q(a)}else if(t.key==="ArrowDown"&&!n){t.preventDefault();const a=ye.getNextInput();q(a)}else t.key==="Enter"&&L&&!n?!t.shiftKey&&L&&Be(t):t.key==="Enter"&&t.preventDefault()},Ns=(t,n)=>{if(t&&typeof t=="object"){if(t.pathname&&typeof t.pathname=="string")return t.pathname.substring(0,15)==="/"?t.host||"":`${t.pathname.substring(0,15)}...`;if(t.host)return t.host}return n&&n.pageContent&&typeof n.pageContent=="string"?`${n.pageContent.substring(0,15)}...`:""},ko=()=>H?J===""?"*":J:we.includes("*")?"*":we||"*",Co=async t=>{try{const n=await tn.post(`${ve}/api/v1/openai-assistants-file/download`,{fileName:t.fileName,chatflowId:o,chatId:z},{responseType:"blob"}),a=new Blob([n.data],{type:n.headers["content-type"]}),i=window.URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.download=t.fileName,document.body.appendChild(l),l.click(),l.remove()}catch(n){console.error("Download failed:",n)}},vo=(t,n)=>t?`${ve}/api/v1/node-icon/${t}`:n?hn:fn;r.useEffect(()=>{var t,n;if((t=ke.data)!=null&&t.length){const a=(n=ke.data[0])==null?void 0:n.chatId;w(a);const i=ke.data.map(l=>{const g={id:l.id,message:l.content,feedback:l.feedback,type:l.role};return l.sourceDocuments&&(g.sourceDocuments=l.sourceDocuments),l.usedTools&&(g.usedTools=l.usedTools),l.fileAnnotations&&(g.fileAnnotations=l.fileAnnotations),l.agentReasoning&&(g.agentReasoning=l.agentReasoning),l.action&&(g.action=l.action),l.artifacts&&(g.artifacts=l.artifacts,g.artifacts.forEach(A=>{(A.type==="png"||A.type==="jpeg")&&(A.data=`${ve}/api/v1/get-upload-file?chatflowId=${o}&chatId=${a}&fileName=${A.data.replace("FILE-STORAGE::","")}`)})),l.fileUploads&&(g.fileUploads=l.fileUploads,g.fileUploads.forEach(A=>{A.type==="stored-file"&&(A.data=`${ve}/api/v1/get-upload-file?chatflowId=${o}&chatId=${a}&fileName=${A.name}`)})),l.followUpPrompts&&(g.followUpPrompts=JSON.parse(l.followUpPrompts)),l.role==="apiMessage"&&l.execution&&l.execution.executionData&&(g.agentFlowExecutedData=JSON.parse(l.execution.executionData)),g});I(l=>[...l,...i]),et(o,a)}},[ke.data]),r.useEffect(()=>{var t,n;if((t=Ae.data)!=null&&t.length){const a=(n=Ae.data[0])==null?void 0:n.sessionId;w(a);const i=Ae.data.map(l=>{const g=typeof l.executionData=="string"?JSON.parse(l.executionData):l.executionData;return{id:l.id,agentFlow:g}});I(l=>[...l,...i]),et(o,a)}},[Ae.data]),r.useEffect(()=>{var t;E.data&&W(((t=E.data)==null?void 0:t.isStreaming)??!1)},[E.data]),r.useEffect(()=>{var t,n,a,i,l;C.data&&(Ua(((t=C.data)==null?void 0:t.isImageUploadAllowed)??!1),Oa(((n=C.data)==null?void 0:n.isRAGFileUploadAllowed)??!1),x(((a=C.data)==null?void 0:a.isSpeechToTextEnabled)??!1),De((i=C.data)==null?void 0:i.imgUploadSizeAndTypes.map(g=>g.fileTypes).join(",")),ne((l=C.data)==null?void 0:l.fileUploadSizeAndTypes.map(g=>g.fileTypes).join(",")))},[C.data]),r.useEffect(()=>{var t,n,a,i,l,g,A,Q,N,ue,me;if(R.data){if(Ft(!1),(t=R.data)!=null&&t.flowData){const Ce=(JSON.parse((n=R.data)==null?void 0:n.flowData).nodes??[]).find(je=>je.data.name==="startAgentflow");if(Ce){const je=(a=Ce.data.inputs)==null?void 0:a.startInputType;_a(je);const Ze=(i=Ce.data.inputs)==null?void 0:i.formInputTypes;if(je==="formInput"&&Ze&&Ze.length>0){for(const Ot of Ze)Ot.type==="options"&&(Ot.options=Ot.addOptions.map(Us=>({label:Us.option,name:Us.option})));Ya(Ze),bs({id:"formInput",inputs:{},inputParams:Ze}),qa((l=Ce.data.inputs)==null?void 0:l.formTitle),Ja((g=Ce.data.inputs)==null?void 0:g.formDescription)}Ae.request({agentflowId:o})}}if((A=R.data)!=null&&A.chatbotConfig&&JSON.parse((Q=R.data)==null?void 0:Q.chatbotConfig)){let ae=JSON.parse((N=R.data)==null?void 0:N.chatbotConfig);if(ae.starterPrompts){let Ce=[];Object.getOwnPropertyNames(ae.starterPrompts).forEach(je=>{ae.starterPrompts[je]&&Ce.push(ae.starterPrompts[je])}),se(Ce.filter(je=>je.prompt!==""))}ae.chatFeedback&&lt(ae.chatFeedback.status),ae.leads&&(be(ae.leads),ae.leads.status&&!gt(o).lead&&I(Ce=>{const je={message:"",type:"leadCaptureMessage"};return[...Ce,je]})),ae.followUpPrompts&&Pa(ae.followUpPrompts.status),ae.fullFileUpload&&(X(ae.fullFileUpload.status),(ue=ae.fullFileUpload)!=null&&ue.allowedUploadFileTypes&&de((me=ae.fullFileUpload)==null?void 0:me.allowedUploadFileTypes))}}},[R.data]),r.useEffect(()=>{R.error&&Ft(!1)},[R.error]),r.useEffect(()=>{St(H?!0:!!Dt)},[Dt,H]),r.useEffect(()=>{dt()},[S]),r.useEffect(()=>{f&&ge&&setTimeout(()=>{var t;(t=ge.current)==null||t.focus()},100)},[f,ge]),r.useEffect(()=>{var t;if(s&&o){ke.request(o),E.request(o),C.request(o),R.request(o),setTimeout(()=>{dt()},100),Qe(!1),Ft(!0);const n=(t=gt(o))==null?void 0:t.lead;n&&(cs(!!n),ze(n.email))}return()=>{q(""),ce([]),j(!1),I([{message:"Hi there! How can I help?",type:"apiMessage"}])}},[s,o]),r.useEffect(()=>{const t=h.filter(n=>n.type==="audio").length>0;h.length>=1&&t&&(Qe(!1),Tt(!1),As(""))},[h]),r.useEffect(()=>{if(It&&S.length>0){const t=S[S.length-1];if(t.type==="apiMessage"&&t.followUpPrompts){if(Array.isArray(t.followUpPrompts)&&Ve(t.followUpPrompts),typeof t.followUpPrompts=="string"){const n=JSON.parse(t.followUpPrompts);Ve(n)}}else t.type==="userMessage"&&Ve([])}},[It,S]);const Io=async t=>{try{await navigator.clipboard.writeText(t||"")}catch(n){console.error("Error copying to clipboard:",n)}},So=async t=>{const n={chatflowid:o,chatId:z,messageId:t,rating:"THUMBS_UP",content:""},a=await Bt.addFeedback(o,n);if(a.data){const i=a.data;let l="";i&&i.id&&(l=i.id),I(g=>[...re.cloneDeep(g)].map(Q=>(Q.id===t&&(Q.feedback={rating:"THUMBS_UP"}),Q))),Xe(l),Y(!0)}},Do=async t=>{const n={chatflowid:o,chatId:z,messageId:t,rating:"THUMBS_DOWN",content:""},a=await Bt.addFeedback(o,n);if(a.data){const i=a.data;let l="";i&&i.id&&(l=i.id),I(g=>[...re.cloneDeep(g)].map(Q=>(Q.id===t&&(Q.feedback={rating:"THUMBS_DOWN"}),Q))),Xe(l),Y(!0)}},Ao=async t=>{const n={content:t};(await Bt.updateFeedback(kt,n)).data&&(Xe(""),Y(!1))},To=async t=>{t&&t.preventDefault(),ls(!0);const n={chatflowid:o,chatId:z,name:Te,email:xe,phone:vt},a=await gn.addLead(n);if(a.data){const i=a.data;w(i.chatId),et(o,i.chatId,{lead:{name:Te,email:xe,phone:vt}}),cs(!0),ze(xe),I(l=>{let g=[...re.cloneDeep(l)];return g[g.length-1].type!=="leadCaptureMessage"||(g[g.length-1].message=te.successMessage||"Thank you for submitting your contact information."),g})}ls(!1)},le=()=>y||!o||(te==null?void 0:te.status)&&!Ra||S[S.length-1].action&&Object.keys(S[S.length-1].action).length>0,Mo=t=>{var n,a;return t.mime.startsWith("image/")?e.jsxs(Gr,{focusRipple:!0,style:{width:"48px",height:"48px",marginRight:"10px",flex:"0 0 auto"},disabled:le(),onClick:()=>Rt(t),children:[e.jsx(qr,{style:{backgroundImage:`url(${t.data})`}}),e.jsx(Vr,{className:"MuiImageBackdrop-root"}),e.jsx(Jr,{className:"MuiImageMarked-root",children:e.jsx(yt,{size:20,color:"white"})})]}):t.mime.startsWith("audio/")?e.jsxs(_e,{sx:{display:"inline-flex",alignItems:"center",height:"48px",width:f?((n=D==null?void 0:D.current)==null?void 0:n.offsetWidth)/4:((a=D==null?void 0:D.current)==null?void 0:a.offsetWidth)/2,p:.5,mr:1,backgroundColor:d.palette.grey[500],flex:"0 0 auto"},variant:"outlined",children:[e.jsx($t,{component:"audio",sx:{color:"transparent"},controls:!0,src:t.data}),e.jsx(pe,{disabled:le(),onClick:()=>Rt(t),size:"small",children:e.jsx(yt,{size:20,color:"white"})})]}):e.jsx(Da,{disabled:le(),item:t,customization:m,onDelete:()=>Rt(t)})},Eo=(t,n)=>{var a,i;return(a=t==null?void 0:t.mime)!=null&&a.startsWith("image/")?e.jsx(_e,{sx:{p:0,m:0,maxWidth:128,marginRight:"10px",flex:"0 0 auto"},children:e.jsx($t,{component:"img",image:t.data,sx:{height:64},alt:"preview",style:li})},n):(i=t==null?void 0:t.mime)!=null&&i.startsWith("audio/")?e.jsxs("audio",{controls:"controls",children:["Your browser does not support the <audio> tag.",e.jsx("source",{src:t.data,type:t.mime})]}):e.jsxs(_e,{sx:{display:"inline-flex",alignItems:"center",height:"48px",width:"max-content",p:2,mr:1,flex:"0 0 auto",backgroundColor:m.isDarkMode?"rgba(0, 0, 0, 0.3)":"transparent"},variant:"outlined",children:[e.jsx(mt,{size:20}),e.jsx("span",{style:{marginLeft:"5px",color:m.isDarkMode?"white":"inherit"},children:t.name})]})},No=t=>{const n=re.cloneDeep(t);for(let a=0;a<n.length;a++){const i=n[a];if(i&&(i.type==="png"||i.type==="jpeg")){const l=i.data;n[a].data=`${ve}/api/v1/get-upload-file?chatflowId=${o}&chatId=${z}&fileName=${l.replace("FILE-STORAGE::","")}`}}return n},Fs=(t,n,a)=>t.type==="png"||t.type==="jpeg"?e.jsx(_e,{sx:{p:0,m:0,mt:2,mb:2,flex:"0 0 auto"},children:e.jsx($t,{component:"img",image:t.data,sx:{height:"auto"},alt:"artifact",style:{width:a?"200px":"100%",height:a?"200px":"auto",objectFit:"cover"}})},n):t.type==="html"?e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(Wn,{html:t.data})}):e.jsx(qt,{chatflowid:o,isFullWidth:f,children:t.data});return Ka?e.jsx(G,{sx:{width:"100%",height:"100%",position:"relative",backgroundColor:d.palette.background.paper},children:e.jsx(G,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(zt,{})})}):Wa==="formInput"&&S.length===1?e.jsx(G,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:2,backgroundColor:d.palette.background.paper},children:e.jsx(G,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsxs(G,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",maxWidth:"600px",maxHeight:"90%",p:3,backgroundColor:m.isDarkMode?Zo(d.palette.background.paper,.2):d.palette.background.paper,boxShadow:m.isDarkMode?"0px 0px 15px 0px rgba(255, 255, 255, 0.1)":d.shadows[3],borderRadius:2,overflowY:"auto"},children:[e.jsx(oe,{variant:"h4",sx:{mb:1,textAlign:"center"},children:Ga||"Please Fill Out The Form"}),e.jsx(oe,{variant:"body1",sx:{mb:3,textAlign:"center",color:d.palette.text.secondary},children:Va||"Complete all fields below to continue"}),e.jsx(G,{sx:{mb:3},children:js&&js.map((t,n)=>e.jsx(G,{sx:{mb:2},children:e.jsx(Fn,{inputParam:t,data:ys,isAdditionalParams:!0,onCustomDataChange:({inputParam:a,newValue:i})=>{bs(l=>({...l,inputs:{...l.inputs,[a.name]:i}}))}})},n))}),e.jsx(Z,{variant:"contained",fullWidth:!0,disabled:y,onClick:()=>Be(null,ys.inputs),sx:{mb:2,borderRadius:20,background:"linear-gradient(45deg, #673ab7 30%, #1e88e5 90%)"},children:y?"Submitting...":"Submit"})]})})}):e.jsxs("div",{onDragEnter:ct,children:[hs&&e.jsx("div",{className:"image-dropzone",onDragEnter:ct,onDragLeave:ct,onDragEnd:ct,onDrop:Xa}),hs&&(((Rs=C.data)==null?void 0:Rs.isImageUploadAllowed)||((Ps=C.data)==null?void 0:Ps.isRAGFileUploadAllowed))&&e.jsxs(G,{className:"drop-overlay",children:[e.jsx(oe,{variant:"h2",children:"Drop here to upload"}),[...C.data.imgUploadSizeAndTypes,...C.data.fileUploadSizeAndTypes].map(t=>{var n;return e.jsxs(e.Fragment,{children:[e.jsx(oe,{variant:"subtitle1",children:(n=t.fileTypes)==null?void 0:n.join(", ")}),t.maxUploadSize&&e.jsxs(oe,{variant:"subtitle1",children:["Max Allowed Size: ",t.maxUploadSize," MB"]})]})})]}),e.jsx("div",{ref:D,className:`${f?"cloud-dialog":"cloud"}`,children:e.jsx("div",{id:"messagelist",className:"messagelist",children:S&&S.map((t,n)=>{var a;return e.jsxs(G,{sx:{background:t.type==="apiMessage"||t.type==="leadCaptureMessage"?d.palette.asyncSelect.main:""},style:{display:"flex"},className:t.type==="userMessage"&&y&&n===S.length-1?m.isDarkMode?"usermessagewaiting-dark":"usermessagewaiting-light":t.type==="usermessagewaiting"?"apimessage":"usermessage",children:[t.type==="apiMessage"||t.type==="leadCaptureMessage"?e.jsx("img",{src:Hn,alt:"AI",width:"30",height:"30",className:"boticon"}):e.jsx("img",{src:pn,alt:"Me",width:"30",height:"30",className:"usericon"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[t.fileUploads&&t.fileUploads.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"column",width:"100%",gap:"8px"},children:t.fileUploads.map((i,l)=>e.jsx(e.Fragment,{children:Eo(i,l)}))}),t.agentReasoning&&t.agentReasoning.length>0&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:t.agentReasoning.map((i,l)=>e.jsx(os,{agent:i,index:l,customization:m,chatflowid:o,isDialog:f,onSourceDialogClick:Pt,renderArtifacts:Fs,agentReasoningArtifacts:No,getAgentIcon:vo,removeDuplicateURL:Hs,isValidURL:$s,onURLClick:Ss,getLabel:Ns},l))}),t.agentFlowExecutedData&&Array.isArray(t.agentFlowExecutedData)&&t.agentFlowExecutedData.length>0&&e.jsx(_r,{status:t.agentFlowEventStatus,execution:t.agentFlowExecutedData,agentflowId:o,sessionId:z}),t.usedTools&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:t.usedTools.map((i,l)=>i?e.jsx(Ne,{size:"small",label:i.tool,component:"a",sx:{mr:1,mt:1,borderColor:i.error?"error.main":void 0,color:i.error?"error.main":void 0},variant:"outlined",clickable:!0,icon:e.jsx(na,{size:15,color:i.error?d.palette.error.main:void 0}),onClick:()=>Pt(i,"Used Tools")},l):null)}),t.artifacts&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"column",width:"100%"},children:t.artifacts.map((i,l)=>i!==null?e.jsx(e.Fragment,{children:Fs(i,l)}):null)}),e.jsx("div",{className:"markdownanswer",children:t.type==="leadCaptureMessage"&&!((a=gt(o))!=null&&a.lead)&&te.status?e.jsxs(G,{sx:{display:"flex",flexDirection:"column",gap:2,marginTop:2},children:[e.jsx(oe,{sx:{lineHeight:"1.5rem",whiteSpace:"pre-line"},children:te.title||"Let us know where we can reach you:"}),e.jsxs("form",{style:{display:"flex",flexDirection:"column",gap:"8px",width:f?"50%":"100%"},onSubmit:To,children:[te.name&&e.jsx(Ue,{id:"leadName",type:"text",fullWidth:!0,placeholder:"Name",name:"leadName",value:Te,autoFocus:!0,onChange:i=>Le(i.target.value)}),te.email&&e.jsx(Ue,{id:"leadEmail",type:"email",fullWidth:!0,placeholder:"Email Address",name:"leadEmail",value:xe,onChange:i=>ze(i.target.value)}),te.phone&&e.jsx(Ue,{id:"leadPhone",type:"number",fullWidth:!0,placeholder:"Phone Number",name:"leadPhone",value:vt,onChange:i=>Na(i.target.value)}),e.jsx(G,{sx:{display:"flex",alignItems:"center"},children:e.jsx(Z,{variant:"outlined",fullWidth:!0,type:"submit",sx:{borderRadius:"20px"},children:Fa?"Saving...":"Save"})})]})]}):e.jsx(e.Fragment,{children:e.jsx(qt,{chatflowid:o,isFullWidth:f,children:t.message})})}),t.fileAnnotations&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%",marginBottom:"8px"},children:t.fileAnnotations.map((i,l)=>e.jsx(Z,{sx:{fontSize:"0.85rem",textTransform:"none",mb:1},variant:"outlined",onClick:()=>Co(i),endIcon:e.jsx(vn,{color:d.palette.primary.main}),children:i.fileName},l))}),t.sourceDocuments&&e.jsx("div",{style:{display:"block",flexDirection:"row",width:"100%",marginBottom:"8px"},children:Hs(t).map((i,l)=>{const g=i.metadata&&i.metadata.source?$s(i.metadata.source):void 0;return e.jsx(Ne,{size:"small",label:Ns(g,i)||"",component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>g?Ss(i.metadata.source):Pt(i)},l)})}),t.action&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",flexDirection:"row",width:"100%",gap:"8px",marginBottom:"8px"},children:(t.action.elements||[]).map((i,l)=>e.jsx(e.Fragment,{children:i.type==="approve-button"&&i.label==="Yes"||i.type==="agentflowv2-approve-button"?e.jsx(Z,{sx:{width:"max-content",borderRadius:"20px",background:m.isDarkMode?"transparent":"white"},variant:"outlined",color:"success",startIcon:e.jsx(Zs,{}),onClick:()=>Ut(i,t.action),children:i.label},l):i.type==="reject-button"&&i.label==="No"||i.type==="agentflowv2-reject-button"?e.jsx(Z,{sx:{width:"max-content",borderRadius:"20px",background:m.isDarkMode?"transparent":"white"},variant:"outlined",color:"error",startIcon:e.jsx(fe,{}),onClick:()=>Ut(i,t.action),children:i.label},l):e.jsx(Z,{sx:{width:"max-content",borderRadius:"20px",background:"white"},variant:"outlined",onClick:()=>Ut(i,t.action),children:i.label},l)}))}),t.type==="apiMessage"&&t.id&&Ke?e.jsx(e.Fragment,{children:e.jsxs(G,{sx:{display:"flex",alignItems:"center",justifyContent:"start",gap:1},children:[e.jsx(ya,{onClick:()=>Io(t.message)}),!t.feedback||t.feedback.rating===""||t.feedback.rating==="THUMBS_UP"?e.jsx(ba,{isDisabled:t.feedback&&t.feedback.rating==="THUMBS_UP",rating:t.feedback?t.feedback.rating:"",onClick:()=>So(t.id)}):null,!t.feedback||t.feedback.rating===""||t.feedback.rating==="THUMBS_DOWN"?e.jsx(ja,{isDisabled:t.feedback&&t.feedback.rating==="THUMBS_DOWN",rating:t.feedback?t.feedback.rating:"",onClick:()=>Do(t.id)}):null]})}):null]})]},n)})})}),S&&S.length===1&&_.length>0&&e.jsx("div",{style:{position:"relative"},children:e.jsx(ha,{sx:{bottom:h&&h.length>0?70:0},starterPrompts:_||[],onPromptClick:As,isGrid:f})}),S&&S.length>2&&It&&ds.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(at,{sx:{width:"100%"}}),e.jsxs(G,{sx:{display:"flex",flexDirection:"column",position:"relative",pt:1.5},children:[e.jsxs(Ee,{sx:{flexDirection:"row",alignItems:"center",px:1.5,gap:.5},children:[e.jsx(Xt,{size:12}),e.jsx(oe,{sx:{fontSize:"0.75rem"},variant:"body2",children:"Try these prompts"})]}),e.jsx(Sa,{sx:{bottom:h&&h.length>0?70:0},followUpPrompts:ds||[],onPromptClick:yo,isGrid:f})]})]}),e.jsx(at,{sx:{width:"100%"}}),e.jsxs("div",{className:"center",children:[h&&h.length>0&&e.jsx(G,{sx:{width:"100%",mb:1.5,display:"flex",alignItems:"center"},children:h.map((t,n)=>e.jsx(r.Fragment,{children:Mo(t)},n))}),La?e.jsx(e.Fragment,{children:fs?e.jsx("div",{className:"overlay",children:e.jsxs("div",{className:"browser-not-supporting-audio-recording-box",children:[e.jsx(oe,{variant:"body1",children:"To record audio, use modern browsers like Chrome or Firefox that support audio recording."}),e.jsx(Z,{variant:"contained",color:"error",size:"small",type:"button",onClick:()=>Is(),children:"Okay"})]})}):e.jsxs(G,{sx:{width:"100%",height:"54px",px:2,border:"1px solid",borderRadius:3,backgroundColor:m.isDarkMode?"#32353b":"#fafafa",borderColor:"rgba(0, 0, 0, 0.23)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"recording-elapsed-time",children:[e.jsx("span",{className:"red-recording-dot",children:e.jsx(pr,{})}),e.jsx(oe,{id:"elapsed-time",children:"00:00"}),za&&e.jsx(oe,{ml:1.5,children:"Sending..."})]}),e.jsxs("div",{className:"recording-control-buttons-container",children:[e.jsx(pe,{onClick:Is,size:"small",children:e.jsx(fe,{color:y||!o?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})}),e.jsx(pe,{onClick:so,size:"small",children:e.jsx(Ht,{color:y||!o?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})})]})]})}):e.jsxs("form",{style:{width:"100%"},onSubmit:Be,children:[e.jsx(Ue,{inputRef:ge,autoFocus:!0,sx:{width:"100%"},disabled:le(),onKeyDown:wo,id:"userInput",name:"userInput",placeholder:y?"Waiting for response...":"Type your question...",value:L,onChange:ao,multiline:!0,maxRows:f?7:2,startAdornment:e.jsxs(e.Fragment,{children:[$e&&!He&&e.jsx(Me,{position:"start",sx:{ml:2},children:e.jsx(pe,{onClick:vs,type:"button",disabled:le(),edge:"start",children:e.jsx(_s,{color:le()?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})})}),!$e&&He&&e.jsx(Me,{position:"start",sx:{ml:2},children:e.jsx(pe,{onClick:Cs,type:"button",disabled:le(),edge:"start",children:e.jsx(mt,{color:le()?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})})}),$e&&He&&e.jsxs(Me,{position:"start",sx:{ml:2},children:[e.jsx(pe,{onClick:vs,type:"button",disabled:le(),edge:"start",children:e.jsx(_s,{color:le()?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})}),e.jsx(pe,{sx:{ml:0},onClick:Cs,type:"button",disabled:le(),edge:"start",children:e.jsx(mt,{color:le()?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})})]}),!$e&&!He&&e.jsx(G,{sx:{pl:1}})]}),endAdornment:e.jsxs(e.Fragment,{children:[ee&&e.jsx(Me,{position:"end",children:e.jsx(pe,{onClick:()=>to(),type:"button",disabled:le(),edge:"end",children:e.jsx(fr,{className:"start-recording-button",color:le()?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})})}),!c&&e.jsx(Me,{position:"end",sx:{paddingRight:"15px"},children:e.jsx(pe,{type:"submit",disabled:le(),edge:"end",children:y?e.jsx("div",{children:e.jsx(zt,{color:"inherit",size:20})}):e.jsx(Ht,{color:le()?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})})}),c&&e.jsxs(e.Fragment,{children:[!y&&e.jsx(Me,{position:"end",sx:{paddingRight:"15px"},children:e.jsx(pe,{type:"submit",disabled:le(),edge:"end",children:e.jsx(Ht,{color:le()?"#9e9e9e":m.isDarkMode?"white":"#1e88e5"})})}),y&&e.jsx(Me,{position:"end",sx:{padding:"15px",mr:1},children:e.jsx(pe,{edge:"end",title:U?"Stopping...":"Stop",style:{border:U?"none":"2px solid red"},onClick:()=>Za(),disabled:U,children:U?e.jsx("div",{children:e.jsx(zt,{color:"error",size:20})}):e.jsx(Ir,{size:15,color:"red"})})})]})]})}),$e&&e.jsx("input",{style:{display:"none"},multiple:!0,ref:us,type:"file",onChange:ks,accept:Se||"*"}),He&&e.jsx("input",{style:{display:"none"},multiple:!0,ref:ps,type:"file",onChange:ks,accept:ko()})]})]}),e.jsx(Bn,{show:p,dialogProps:M,onCancel:()=>k(!1)}),e.jsx(zr,{show:Ct,onCancel:()=>Y(!1),onConfirm:Ao}),e.jsxs(Je,{maxWidth:"md",fullWidth:!0,open:Ha,onClose:()=>{Mt(!1),Nt(null),Et("")},children:[e.jsx(ot,{variant:"h5",children:"Provide Feedback"}),e.jsx(Ye,{children:e.jsx(ra,{autoFocus:!0,margin:"dense",label:"Feedback",fullWidth:!0,multiline:!0,rows:4,value:gs,onChange:t=>Et(t.target.value)})}),e.jsxs(nt,{children:[e.jsx(Z,{onClick:Ms,children:"Cancel"}),e.jsx(Z,{onClick:Ms,variant:"contained",children:"Submit"})]})]})]})};Aa.propTypes={open:u.bool,chatflowid:u.string,isAgentCanvas:u.bool,isDialog:u.bool,previews:u.array,setPreviews:u.func};const Ta=r.memo(Aa),Ma=({show:s,dialogProps:o,isAgentCanvas:c,onClear:f,onCancel:h,previews:b,setPreviews:d})=>{const m=document.getElementById("portal"),D=Ie(O=>O.customization),v=s?e.jsxs(Je,{open:s,fullWidth:!0,maxWidth:"md",onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[e.jsx(ot,{sx:{fontSize:"1rem",p:1.5},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[o.title,e.jsx("div",{style:{flex:1}}),D.isDarkMode&&e.jsx(oa,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:f,startIcon:e.jsx(Vt,{}),children:"Clear Chat"}),!D.isDarkMode&&e.jsx(Z,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:f,startIcon:e.jsx(Vt,{}),children:"Clear Chat"})]})}),e.jsx(Ye,{className:"cloud-dialog-wrapper",sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column",p:0},children:e.jsx(Ta,{isDialog:!0,open:o.open,isAgentCanvas:c,chatflowid:o.chatflowid,previews:b,setPreviews:d})})]}):null;return wt.createPortal(v,m)};Ma.propTypes={show:u.bool,dialogProps:u.object,isAgentCanvas:u.bool,onClear:u.func,onCancel:u.func,previews:u.array,setPreviews:u.func};const Ea=({chatflowid:s,isAgentCanvas:o,onOpenChange:c})=>{const f=Oe(),{confirm:h}=dr(),b=Ge(),{clearAgentflowNodeStatus:d}=r.useContext(Kt);jt();const m=(...p)=>b(rt(...p)),D=(...p)=>b(it(...p)),[v,O]=r.useState(!1),[P,$]=r.useState(!1),[T,L]=r.useState({}),[q,y]=r.useState([]),j=r.useRef(null),S=r.useRef(v),I=p=>{j.current&&j.current.contains(p.target)||(O(!1),c&&c(!1))},K=()=>{const p=!v;O(p),c&&c(p)},W=()=>{L({open:!0,chatflowid:s}),$(!0)},ee=()=>{const p={...T,open:!1};L(p),d(),setTimeout(()=>{const k={...T,open:!0};L(k)},500)},x=async()=>{if(await h({title:"Clear Chat History",description:"Are you sure you want to clear all chat history?",confirmButtonName:"Clear",cancelButtonName:"Cancel"}))try{const M=gt(s);if(!M.chatId)return;await _t.deleteChatmessage(s,{chatId:M.chatId,chatType:"INTERNAL"}),sn(s),ee(),m({message:"Succesfully cleared all chat history",options:{key:new Date().getTime()+Math.random(),variant:"success",action:F=>e.jsx(Z,{style:{color:"white"},onClick:()=>D(F),children:e.jsx(fe,{})})}})}catch(M){m({message:typeof M.response.data=="object"?M.response.data.message:M.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:F=>e.jsx(Z,{style:{color:"white"},onClick:()=>D(F),children:e.jsx(fe,{})})}})}};return r.useEffect(()=>{S.current===!0&&v===!1&&(j.current.focus(),c&&c(!1)),S.current=v},[v,s]),e.jsxs(e.Fragment,{children:[e.jsx(st,{sx:{position:"absolute",right:20,top:20},ref:j,size:"small",color:"secondary","aria-label":"chat",title:"Chat",onClick:K,children:v?e.jsx(fe,{}):e.jsx(mn,{})}),v&&e.jsx(st,{sx:{position:"absolute",right:80,top:20},onClick:x,size:"small",color:"error","aria-label":"clear",title:"Clear Chat History",children:e.jsx(Vt,{})}),v&&e.jsx(st,{sx:{position:"absolute",right:140,top:20},onClick:W,size:"small",color:"primary","aria-label":"expand",title:"Expand Chat",children:e.jsx(ia,{})}),e.jsx(ea,{placement:"bottom-end",open:v,anchorEl:j.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[40,14]}}]},sx:{zIndex:1e3},children:({TransitionProps:p})=>e.jsx(ta,{in:v,...p,children:e.jsx(Yt,{children:e.jsx(sa,{onClickAway:I,children:e.jsx(aa,{border:!1,className:"cloud-wrapper",elevation:16,content:!1,boxShadow:!0,shadow:f.shadows[16],children:e.jsx(Ta,{isAgentCanvas:o,chatflowid:s,open:v,previews:q,setPreviews:y})})})})})}),e.jsx(Ma,{show:P,dialogProps:T,isAgentCanvas:o,onClear:x,onCancel:()=>$(!1),previews:q,setPreviews:y})]})};Ea.propTypes={chatflowid:u.string,isAgentCanvas:u.bool,onOpenChange:u.func};const Ki=r.memo(Ea);function ci(s,o=!0){const{navigator:c}=r.useContext(an);r.useEffect(()=>{if(!o)return;const f=c.block(h=>{const b={...h,retry(){f(),h.retry()}};s(b)});return f},[c,s,o])}function Xi(s,o=!0){const c=r.useCallback(f=>{window.confirm(s)&&f.retry()},[s]);ci(c,o)}export{Yi as A,Sr as C,Ji as I,Ki as a,Xi as u};
