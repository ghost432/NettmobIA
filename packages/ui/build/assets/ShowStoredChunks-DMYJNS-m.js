import{f as ae,u as se,s as oe,a as ne,b as re,O as ie,t as ce,c as de,ak as le,r,j as e,M as A,S as pe,aj as y,h as $,B as he,y as ue,ah as me,ag as xe,o as W,q as C,i as j,L as ge,N as fe}from"./index-B5bgjFPS.js";import{R as ke}from"./main-Dw2W3SKo.js";import{c as Ce}from"./chunks_empty-fFmvGjOz.js";import{B as je}from"./BackdropLoader-Ch3nVEPr.js";import{u as ye,C as we}from"./ConfirmDialog-Dfe34hOz.js";import{E as be}from"./ExpandedChunkDialog-DigJE3y9.js";import{V as Se}from"./ViewHeader-t5dVj9Vk.js";import{E as ve}from"./ErrorBoundary-x4bZaoHs.js";import{d as w}from"./documentstore-CRtiIDJT.js";import{I as De}from"./IconChevronLeft-DxxY-T-U.js";import{I as Ie}from"./IconChevronRight-D55BXkrb.js";import{I as Re}from"./IconLanguage-BXvwKb3u.js";import"./CodeEditor-BbQJOBPh.js";import"./index-C-cusT-F.js";import"./IconSearch-4bUU90FL.js";import"./IconTrash-CekgWF9B.js";import"./StyledFab-DFomU4Vk.js";import"./IconCopy-bbAsun7S.js";const Ee=ue(A)(({theme:d})=>({background:d.palette.card.main,color:d.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:d.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),Ke=()=>{var B,P,T,M,F,q,L,z;const d=ae(t=>t.customization),b=se(),S=oe(),V=ne(),{confirm:G}=ye(),{error:v}=re(),{hasAssignedWorkspace:H}=ie();ce();const u=(...t)=>S(ge(...t)),m=(...t)=>S(fe(...t)),n=de(w.getFileChunks),{storeId:x,fileId:g}=le(),[p,O]=r.useState([]),[h,J]=r.useState(0),[l,D]=r.useState(1),[I,_]=r.useState(1),[f,K]=r.useState(50),[R,c]=r.useState(!1),[X,k]=r.useState(!1),[Q,U]=r.useState({}),[E,Y]=r.useState([]),Z=t=>{const a=p.find(o=>o.id===t),i=p.findIndex(o=>o.id===t)+I;U({data:{selectedChunk:a,selectedChunkNumber:i}}),k(!0)},ee=async(t,a,i)=>{c(!0),k(!1);try{(await w.editChunkFromStore(i.storeId,i.docId,i.id,{pageContent:t,metadata:a},!0)).data&&(u({message:"Document chunk successfully edited!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}}),n.request(x,g,l)),c(!1)}catch(s){c(!1),u({message:`Failed to edit chunk: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}})}},te=async t=>{const a={title:"Delete",description:`Delete chunk ${t.id} ? This action cannot be undone.`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await G(a)){c(!0),k(!1);try{(await w.deleteChunkFromStore(t.storeId,t.docId,t.id)).data&&(u({message:"Document chunk successfully deleted!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}}),n.request(x,g,l)),c(!1)}catch(s){c(!1),u({message:`Failed to delete chunk: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}})}}};r.useEffect(()=>{c(!0),n.request(x,g,l)},[]);const N=t=>{c(!0),D(t),n.request(x,g,t)};return r.useEffect(()=>{var t;if(n.data){const a=n.data,i=a.workspaceId;if(!H(i)){b("/unauthorized");return}if(J(a.count),O(a.chunks),c(!1),D(a.currentPage),_(a.currentPage*50-49),K(a.currentPage*50>a.count?a.count:a.currentPage*50),(t=a.file)!=null&&t.files&&a.file.files.length>0){const s=[];for(const o of a.file.files)s.push(o.name);Y(s)}}},[n.data]),e.jsxs(e.Fragment,{children:[e.jsx(A,{style:{position:"relative"},children:v?e.jsx(ve,{error:v}):e.jsxs(pe,{flexDirection:"column",sx:{gap:1},children:[e.jsx(Se,{isBackButton:!0,search:!1,title:((P=(B=n.data)==null?void 0:B.file)==null?void 0:P.loaderName)||((T=n.data)==null?void 0:T.storeName),description:((F=(M=n.data)==null?void 0:M.file)==null?void 0:F.splitterName)||((q=n.data)==null?void 0:q.description),onBack:()=>b(-1)}),e.jsxs("div",{style:{width:"100%"},children:[E.length>0&&e.jsx(y,{sx:{mt:1},container:!0,children:E.map((t,a)=>e.jsx("div",{style:{paddingLeft:"15px",paddingRight:"15px",paddingTop:"10px",paddingBottom:"10px",fontSize:"0.9rem",width:"max-content",borderRadius:"25px",boxShadow:d.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 20%)":"0 2px 14px 0 rgb(32 40 45 / 20%)",display:"flex",flexDirection:"row",alignItems:"center",marginRight:"10px"},children:t},a))}),e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",overflow:"hidden",marginTop:15,marginBottom:10},children:[e.jsxs("div",{style:{marginRight:20,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx($,{size:"small",onClick:()=>N(l-1),style:{marginRight:10},variant:"outlined",disabled:l===1,children:e.jsx(De,{color:d.isDarkMode?l===1?"#616161":"white":l===1?"#e0e0e0":"black"})}),"Showing ",Math.min(I,h),"-",f," of ",h," chunks",e.jsx($,{size:"small",onClick:()=>N(l+1),style:{marginLeft:10},variant:"outlined",disabled:f>=h,children:e.jsx(Ie,{color:d.isDarkMode?f>=h?"#616161":"white":f>=h?"#e0e0e0":"black"})})]}),e.jsxs("div",{style:{marginRight:20,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Re,{style:{marginRight:10},size:20}),(z=(L=n.data)==null?void 0:L.characters)==null?void 0:z.toLocaleString()," characters"]})]})]}),e.jsx("div",{children:e.jsxs(y,{container:!0,spacing:2,children:[!p.length&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[e.jsx(he,{sx:{mt:5,p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:Ce,alt:"chunks_emptySVG"})}),e.jsx("div",{children:"No Chunks"})]}),p.length>0&&p.map((t,a)=>e.jsx(y,{item:!0,lg:4,md:4,sm:6,xs:6,children:e.jsx(Ee,{content:!1,onClick:()=>Z(t.id),sx:{border:1,borderColor:V.palette.grey[900]+25,borderRadius:2},children:e.jsx(me,{children:e.jsxs(xe,{sx:{p:2},children:[e.jsx(W,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${t.chunkNo}. Characters: ${t.pageContent.length}`}),e.jsx(W,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(ke,{theme:d.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata?JSON.parse(t.metadata):{},name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:1})]})})})},a))]})})]})}),e.jsx(we,{}),e.jsx(be,{show:X,dialogProps:Q,onCancel:()=>k(!1),onChunkEdit:(t,a,i)=>ee(t,a,i),onDeleteChunk:t=>te(t)}),R&&e.jsx(je,{open:R})]})};export{Ke as default};
