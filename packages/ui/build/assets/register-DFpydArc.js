import{a as _,t as ee,b7 as se,d6 as re,r,c as D,bh as ie,u as te,bi as ae,cN as ne,j as e,B as u,S as k,aA as oe,a4 as le,o as t,Y as ce,a5 as de,aa as he,E as me,q as I}from"./index-B5bgjFPS.js";import{I as C}from"./Input-CajAyvOv.js";import{B as ue}from"./BackdropLoader-Ch3nVEPr.js";import{l as pe}from"./loginmethod-CpJzrLw7.js";import{s as fe}from"./sso-BIcGhpUd.js";import{p as B}from"./validation-D5cE1cK5.js";import{A as ge,G as xe,a as je}from"./auth0-DQBmZI7E.js";import{G as ye}from"./github-BtlA98as.js";import{A as W,I as we}from"./IconExclamationCircle-Dzy6pM40.js";import{I as ve}from"./IconCircleCheck-DFCqko6z.js";import{I as P}from"./Icon-BpanFwP0.js";import{o as H,s as h}from"./schemas-3ZMdv4w1.js";import"./ListItem-BfStHUI0.js";import"./FormControl-o0rphY-g.js";import"./Close-DT9tpzn1.js";const Se=H({username:h().min(1,"Name is required"),email:h().min(1,"Email is required").email("Invalid email address"),password:B,confirmPassword:h().min(1,"Confirm Password is required"),token:h().min(1,"Invite Code is required")}).refine(l=>l.password===l.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Ie=H({username:h().min(1,"Name is required"),email:h().min(1,"Email is required").email("Invalid email address"),password:B,confirmPassword:h().min(1,"Confirm Password is required")}).refine(l=>l.password===l.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Ue=()=>{const l=_();ee();const{isEnterpriseLicensed:j,isCloud:b,isOpenSource:F}=se(),Y={label:"Username",name:"username",type:"text",placeholder:"John Doe"},z={label:"Password",name:"password",type:"password",placeholder:"********"},$={label:"Confirm Password",name:"confirmPassword",type:"password",placeholder:"********"},J={label:"EMail",name:"email",type:"email",placeholder:"user@company.com"},K={label:"Invite Code",name:"inviteCode",type:"text"},[Q]=re(),[p,R]=r.useState(""),[f,G]=r.useState(""),[E,L]=r.useState(""),[A,O]=r.useState(Q.get("token")??""),[g,q]=r.useState(""),[n,V]=r.useState([]),[M,y]=r.useState(!1),[w,m]=r.useState(""),[T,N]=r.useState(void 0),c=D(ie.registerAccount),o=D(fe.ssoLogin),x=D(pe.getDefaultLoginMethods),U=te(),X=async s=>{if(s.preventDefault(),j){const a=Se.safeParse({username:g,email:p,token:A,password:f,confirmPassword:E});if(a.success){y(!0);const i={user:{name:g,email:p,credential:f,tempToken:A}};await c.request(i)}else{const i=a.error.errors.map(d=>d.message);m(i.join(", "))}}else if(b){const i=new FormData(s.target).get("referral"),d=Ie.safeParse({username:g,email:p,password:f,confirmPassword:E});if(d.success){y(!0);const S={user:{name:g,email:p,credential:f}};i&&(S.user.referral=i),await c.request(S)}else{const S=d.error.errors.map(Z=>Z.message);m(S.join(", "))}}},v=s=>{window.location.href=`/api/v1/${s}/login`};return r.useEffect(()=>{var s,a,i;c.error&&(j?m(`Error in registering user. Please contact your administrator. (${(i=(a=(s=c.error)==null?void 0:s.response)==null?void 0:a.data)==null?void 0:i.message})`):b&&m("Error in registering user. Please try again."),y(!1))},[c.error]),r.useEffect(()=>{F||x.request()},[]),r.useEffect(()=>{var s;o.data&&(ae.dispatch(ne(o.data)),U(((s=location.state)==null?void 0:s.path)||"/chatflows"))},[o.data]),r.useEffect(()=>{var s,a,i,d;o.error&&(((a=(s=o.error)==null?void 0:s.response)==null?void 0:a.status)===401&&((d=(i=o.error)==null?void 0:i.response)!=null&&d.data.redirectUrl)?window.location.href=o.error.response.data.redirectUrl:m(o.error.message))},[o.error]),r.useEffect(()=>{x.data&&x.data.providers&&V(x.data.providers.map(s=>s))},[x.data]),r.useEffect(()=>{c.data&&(y(!1),m(void 0),L(""),G(""),O(""),q(""),R(""),j?N("Registration Successful. You will be redirected to the sign in page shortly."):b&&N("To complete your registration, please click on the verification link we sent to your email address"),setTimeout(()=>{U("/signin")},3e3))},[c.data]),e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{width:"100%",maxHeight:"100vh",overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",padding:"24px"},children:e.jsxs(k,{flexDirection:"column",sx:{width:"480px",gap:3},children:[w&&e.jsx(W,{icon:e.jsx(we,{}),variant:"filled",severity:"error",children:w.split(", ").length>0?e.jsx(oe,{dense:!0,sx:{py:0},children:w.split(", ").map((s,a)=>e.jsx(le,{primary:s,primaryTypographyProps:{color:"#fff !important"}},a))}):w}),T&&e.jsx(W,{icon:e.jsx(ve,{}),variant:"filled",severity:"success",children:T}),e.jsxs(k,{sx:{gap:1},children:[e.jsx(t,{variant:"h1",children:"Sign Up"}),e.jsxs(t,{variant:"body2",sx:{color:l.palette.grey[600]},children:["Already have an account?"," ",e.jsx(ce,{style:{color:l.palette.primary.main},to:"/signin",children:"Sign In"}),"."]})]}),e.jsx("form",{onSubmit:X,"data-rewardful":!0,children:e.jsxs(k,{sx:{width:"100%",flexDirection:"column",alignItems:"left",justifyContent:"center",gap:2},children:[e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Full Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(C,{inputParam:Y,placeholder:"Display Name",onChange:s=>q(s),value:g,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Is used for display purposes only."})})]}),e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Email",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(C,{inputParam:J,onChange:s=>R(s),value:p,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Kindly use a valid email address. Will be used as login id."})})]}),j&&e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Invite Code",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(de,{fullWidth:!0,type:"string",placeholder:"Paste in the invite code.",multiline:!1,inputParam:K,onChange:s=>O(s.target.value),value:A}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Please copy the token you would have received in your email."})})]}),e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(C,{inputParam:z,onChange:s=>G(s),value:f}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Password must be at least 8 characters long and contain at least one lowercase letter, one uppercase letter, one digit, and one special character."})})]}),e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Confirm Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(C,{inputParam:$,onChange:s=>L(s),value:E}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Confirm your password. Must match the password typed above."})})]}),e.jsx(he,{variant:"contained",style:{borderRadius:12,height:40,marginRight:5},type:"submit",children:"Create Account"}),n.length>0&&e.jsx(me,{sx:{width:"100%"},children:"OR"}),n&&n.map(s=>s==="azure"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(P,{children:e.jsx("img",{src:ge,alt:"MicrosoftSSO",width:20,height:20})}),children:"Sign In With Microsoft"},s)),n&&n.map(s=>s==="google"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(P,{children:e.jsx("img",{src:xe,alt:"GoogleSSO",width:20,height:20})}),children:"Sign In With Google"},s)),n&&n.map(s=>s==="auth0"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(P,{children:e.jsx("img",{src:je,alt:"Auth0SSO",width:20,height:20})}),children:"Sign In With Auth0 by Okta"},s)),n&&n.map(s=>s==="github"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(P,{children:e.jsx("img",{src:ye,alt:"GithubSSO",width:20,height:20})}),children:"Sign In With Github"},s))]})})]})}),M&&e.jsx(ue,{open:M})]})};export{Ue as default};
