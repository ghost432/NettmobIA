import{t as te,b7 as ie,r as a,c as v,bh as I,u as re,bi as ne,cN as oe,j as e,B as r,S as C,aA as le,a4 as ce,o as t,E as D,C as F,aa as de,q as O}from"./index-B5bgjFPS.js";import{I as m}from"./Input-CajAyvOv.js";import{B as he}from"./BackdropLoader-Ch3nVEPr.js";import{a as pe}from"./auth-Bhw5H-7k.js";import{l as ue}from"./loginmethod-CpJzrLw7.js";import{p as me}from"./validation-D5cE1cK5.js";import{A as xe,G as ge,a as fe}from"./auth0-DQBmZI7E.js";import{A as R,I as je}from"./IconExclamationCircle-Dzy6pM40.js";import{I as ye}from"./IconCircleCheck-DFCqko6z.js";import{T}from"./TextField-OmGdqrIf.js";import{I as N}from"./Icon-BpanFwP0.js";import{o as we,s as M}from"./schemas-3ZMdv4w1.js";import"./ListItem-BfStHUI0.js";import"./FormControl-o0rphY-g.js";import"./Close-DT9tpzn1.js";import"./InputLabel-BtU13bbu.js";const ve=we({username:M().min(1,"Name is required"),email:M().min(1,"Email is required").email("Invalid email address"),password:me,confirmPassword:M().min(1,"Confirm Password is required")}).refine(l=>l.password===l.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Ge=()=>{te();const{isEnterpriseLicensed:l,isOpenSource:U}=ie(),H={label:"Organization",name:"organization",type:"text",placeholder:"Acme"},$={label:"Username",name:"username",type:"text",placeholder:"John Doe"},_={label:"Password",name:"password",type:"password",placeholder:"********"},J={label:"Confirm Password",name:"confirmPassword",type:"password",placeholder:"********"},K={label:"EMail",name:"email",type:"email",placeholder:"user@company.com"},[x,k]=a.useState(""),[g,q]=a.useState(""),[z,G]=a.useState(""),[S,L]=a.useState(""),[A,Y]=a.useState(""),[E,Q]=a.useState(""),[b,V]=a.useState(""),[W,h]=a.useState(!1),[f,c]=a.useState(""),[B,X]=a.useState(void 0),[j,Z]=a.useState(!1),p=v(pe.login),i=v(I.registerAccount),y=v(I.getBasicAuth),ee=re(),u=v(ue.getLoginMethods),[n,se]=a.useState([]),ae=async s=>{s.preventDefault();const o=ve.safeParse({orgName:A,username:S,email:x,password:g,confirmPassword:z});if(o.success){if(h(!0),c(""),j)try{const d=await I.checkBasicAuth({username:E,password:b});if(!d||!d.data||d.data.message!=="Authentication successful"){c("Authentication failed. Please check your existing credentials."),h(!1);return}}catch{c("Authentication failed. Please check your existing credentials."),h(!1);return}const w={user:{name:S,email:x,type:"pro",credential:g}};l&&(w.organization={name:A}),await i.request(w)}else{const w=o.error.errors.map(d=>d.message);c(w.join(", "))}};a.useEffect(()=>{if(i.error){const s=typeof i.error.response.data=="object"?i.error.response.data.message:i.error.response.data;let o="";l?o=`Error in registering organization. Please contact your administrator. (${s})`:o=`Error in registering account: ${s}`,c(o),h(!1)}},[i.error]),a.useEffect(()=>{y.data&&y.data.isUsernamePasswordSet===!0&&Z(!0)},[y.data]),a.useEffect(()=>{U?y.request():u.request()},[]),a.useEffect(()=>{u.data&&u.data.providers&&se(u.data.providers.map(s=>s))},[u.data]),a.useEffect(()=>{i.data&&(c(void 0),G(""),q(""),L(""),k(""),X(i.data.message),setTimeout(()=>{const s={email:x,password:g};p.request(s)},1e3))},[i.data]),a.useEffect(()=>{var s;p.data&&(h(!1),ne.dispatch(oe(p.data)),localStorage.setItem("username",p.data.name),ee(((s=location.state)==null?void 0:s.path)||"/chatflows"))},[p.data]);const P=s=>{window.location.href=`/api/v1/${s}/login`};return e.jsxs(e.Fragment,{children:[e.jsx(r,{sx:{width:"100%",maxHeight:"100vh",overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",padding:"24px"},children:e.jsxs(C,{flexDirection:"column",sx:{width:"480px",gap:3},children:[f&&e.jsx(R,{icon:e.jsx(je,{}),variant:"filled",severity:"error",children:f.split(", ").length>0?e.jsx(le,{dense:!0,sx:{py:0},children:f.split(", ").map((s,o)=>e.jsx(ce,{primary:s,primaryTypographyProps:{color:"#fff !important"}},o))}):f}),B&&e.jsx(R,{icon:e.jsx(ye,{}),variant:"filled",severity:"success",children:B}),e.jsx(C,{sx:{gap:1},children:e.jsx(t,{variant:"h1",children:"Setup Account"})}),j&&e.jsx(R,{severity:"info",children:"Application authentication now requires email and password. Contact administrator to setup an account."}),(U||l)&&e.jsx(t,{variant:"caption",children:"Account setup does not make any external connections, your data stays securely on your locally hosted server."}),e.jsx("form",{onSubmit:ae,children:e.jsxs(C,{sx:{width:"100%",flexDirection:"column",alignItems:"left",justifyContent:"center",gap:2},children:[j&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{sx:{mb:1},children:["Existing Username",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(T,{fullWidth:!0,placeholder:"Existing Username",value:E,onChange:s=>Q(s.target.value)}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Existing username that was set as FLOWISE_USERNAME environment variable"})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{sx:{mb:1},children:["Existing Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(T,{fullWidth:!0,type:"password",placeholder:"Existing Password",value:b,onChange:s=>V(s.target.value)}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Existing password that was set as FLOWISE_PASSWORD environment variable"})})]}),e.jsx(D,{children:e.jsx(F,{label:"New Account Details",size:"small"})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Organization Name:",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(m,{inputParam:H,placeholder:"Organization Name",onChange:s=>Y(s),value:A,showDialog:!1})]}),e.jsx(r,{children:e.jsx(D,{children:e.jsx(F,{label:"Account Administrator",size:"small"})})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Administrator Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(m,{inputParam:$,placeholder:"Display Name",onChange:s=>L(s),value:S,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Is used for display purposes only."})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Administrator Email",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(m,{inputParam:K,onChange:s=>k(s),type:"email",value:x,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Kindly use a valid email address. Will be used as login id."})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(m,{inputParam:_,onChange:s=>q(s),value:g}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Password must be at least 8 characters long and contain at least one lowercase letter, one uppercase letter, one digit, and one special character."})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Confirm Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(m,{inputParam:J,onChange:s=>G(s),value:z}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Reconfirm your password. Must match the password typed above."})})]}),e.jsx(de,{variant:"contained",style:{borderRadius:12,height:40,marginRight:5},type:"submit",disabled:j&&(!E||!b),children:"Sign Up"}),n&&n.length>0&&e.jsx(D,{sx:{width:"100%"},children:"OR"}),n&&n.map(s=>s==="azure"&&e.jsx(O,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>P(s),startIcon:e.jsx(N,{children:e.jsx("img",{src:xe,alt:"MicrosoftSSO",width:20,height:20})}),children:"Sign Up With Microsoft"},s)),n&&n.map(s=>s==="google"&&e.jsx(O,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>P(s),startIcon:e.jsx(N,{children:e.jsx("img",{src:ge,alt:"GoogleSSO",width:20,height:20})}),children:"Sign Up With Google"},s)),n&&n.map(s=>s==="auth0"&&e.jsx(O,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>P(s),startIcon:e.jsx(N,{children:e.jsx("img",{src:fe,alt:"Auth0SSO",width:20,height:20})}),children:"Sign Up With Auth0 by Okta"},s))]})})]})}),W&&e.jsx(he,{open:W})]})};export{Ge as default};
