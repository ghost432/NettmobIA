import{af as Ve,r as u,az as q,a as ze,A as xe,j as t,P as z,b4 as it,s as qe,f as Te,t as Ye,i as Q,bz as rt,cA as lt,R as Pe,c3 as ct,M as dt,o as pt,B as V,K as mt,ba as ft,c5 as ht,q as ee,L as Ze,u as ut,cM as gt,bI as yt,c as ge,cQ as wt,d1 as Ct,ar as Oe,cO as xt,al as ye,cR as He,aq as re,cS as vt,am as bt,bL as Ie,d2 as Nt,cU as kt,cV as jt,N as Mt}from"./index-B5bgjFPS.js";import{C as St,I as At,a as Dt,B as Et}from"./style-CyLs_DYe.js";import{A as Ft,I as It,S as $t,a as Tt,E as zt}from"./EditNodeDialog-BDGzHjnv.js";import{d as Rt,e as ve,k as Bt,z as Lt,P as _t,h as Ue,l as Pt,p as Ot,m as Ht,s as Ge,n as Wt,o as Vt,g as qt,q as Yt,u as Zt,b as Ut,R as Gt,c as Jt}from"./DocStoreInputHandler-BDJBQrwa.js";import{u as Xt,C as Kt,A as Qt,I as eo,a as to}from"./usePrompt-jNtWcF6k.js";import{u as oo,C as no}from"./ConfirmDialog-Dfe34hOz.js";import{S as ao,F as so}from"./StyledFab-DFomU4Vk.js";import{I as io}from"./IconExclamationCircle-Dzy6pM40.js";import{h as ro}from"./index-BhkI4Bzv.js";import{n as lo}from"./nodes-Qb-8otVq.js";import{c as we}from"./chatflows-CbGmw0-v.js";import"./NodeInfoDialog-BuAc37BO.js";import"./Table-CZOZGZoJ.js";import"./TooltipWithParser-D26Faoyy.js";import"./index-D--Rb2MU.js";import"./Tooltip-CXmeiPEa.js";import"./config-wSoqsCQX.js";import"./StopCircle-Dr72dSBy.js";import"./ButtonGroup-DgM5AEGL.js";import"./IconCopy-bbAsun7S.js";import"./IconTrash-CekgWF9B.js";import"./ToolDialog-DZ6z_iak.js";import"./Grid-DGDGmzGP.js";import"./toPropertyKey-C9c9JG92.js";import"./Autocomplete-CinIIKT5.js";import"./Close-DT9tpzn1.js";import"./createStyled-DlEbU-rO.js";import"./InputLabel-BtU13bbu.js";import"./InputAdornment-v58Edx4J.js";import"./FormControl-o0rphY-g.js";import"./TextField-OmGdqrIf.js";import"./KeyboardArrowRight-BvTOCIXU.js";import"./LastPage--XaxDP-k.js";import"./Skeleton-DJP3nnUt.js";import"./Delete-4D-T7tnN.js";import"./CodeEditor-BbQJOBPh.js";import"./index-C-cusT-F.js";import"./ExportAsTemplateDialog-481ESzFy.js";import"./GridActionsCellItem-B3aQ_RGo.js";import"./IconPlus-j8jP5X4Z.js";import"./Input-CajAyvOv.js";import"./ListItem-BfStHUI0.js";import"./Dropdown-D8Rr64ju.js";import"./MultiDropdown-BUXEvYds.js";import"./CredentialInputHandler-C4W2GUgN.js";import"./CredentialListDialog-ZkUPpHPz.js";import"./Switch-D5M093wC.js";import"./main-Dw2W3SKo.js";import"./IconArrowsMaximize-BLCViMbK.js";import"./IconAlertTriangle-7YQ2ldQl.js";import"./IconSearch-4bUU90FL.js";import"./File-km8sc6Tq.js";import"./suggestionOption-DCQ-1oAJ.js";import"./TabPanel-C-h4h7GL.js";import"./ExpandMore-BZIzyY2F.js";import"./MemoizedReactMarkdown-mGWPD7hJ.js";import"./unsupportedIterableToArray-Bh0GkvIo.js";import"./BackdropLoader-Ch3nVEPr.js";import"./ExpandTextDialog-XWdUWqGp.js";import"./LoadingButton-CJHvS9bV.js";import"./IconRefresh-CtZoTUkg.js";import"./AssistantDialog-CJzYVebb.js";import"./assistants-DZYxhrU8.js";import"./v4-CtRu48qb.js";import"./Stepper-BCbMjc86.js";import"./IconLanguage-BXvwKb3u.js";import"./documentstore-CRtiIDJT.js";import"./string-BbYD24iH.js";import"./IconBulb-BQTovKvQ.js";import"./SaveChatflowDialog-BSNhDvwI.js";import"./react-datepicker-B1KQuNsR.js";import"./moment-BDbvUjbq.js";import"./vectorstore-Bq4Eb9NI.js";import"./IconChevronsUp-DG3lzKhL.js";import"./IconChevronLeft-DxxY-T-U.js";import"./IconDeviceFloppy-BsK1tbgI.js";import"./llamaindex-B_JSDULd.js";import"./Tabs-T-PfpsDr.js";import"./SourceDocDialog-U52onwWn.js";import"./NodeExecutionDetails-DG6IJuTk.js";import"./IconClock-Be61hWTr.js";import"./ToggleButtonGroup-RXBzXyLf.js";import"./IconCircleXFilled-6uNExu9P.js";import"./_baseAssignValue-BxACqS1o.js";import"./apikey-DN23bewa.js";import"./StatsCard-HDup684R.js";import"./Pagination-BU6C4W3P.js";import"./SpeechToText-CJ66nyGc.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=[["path",{d:"M9 11l3 3l8 -8",key:"svg-0"}],["path",{d:"M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9",key:"svg-1"}]],po=Ve("outline","checkbox","Checkbox",co);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=[["path",{d:"M9.615 20h-2.615a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8",key:"svg-0"}],["path",{d:"M14 19l2 2l4 -4",key:"svg-1"}],["path",{d:"M9 8h4",key:"svg-2"}],["path",{d:"M9 12h2",key:"svg-3"}]],fo=Ve("outline","checklist","Checklist",mo),Je=({id:e,x:o,y:a,width:p,height:m,style:r,color:s,strokeColor:d,strokeWidth:i,className:l,borderRadius:f,shapeRendering:x,onClick:C,selected:g})=>{const{background:b,backgroundColor:y}=r||{},D=s||b||y;return q.createElement("rect",{className:Ue(["react-flow__minimap-node",{selected:g},l]),x:o,y:a,rx:f,ry:f,width:p,height:m,fill:D,stroke:d,strokeWidth:i,shapeRendering:x,onClick:C?j=>C(j,e):void 0})};Je.displayName="MiniMapNode";var ho=u.memo(Je);const uo=e=>e.nodeOrigin,go=e=>e.getNodes().filter(o=>!o.hidden&&o.width&&o.height),$e=e=>e instanceof Function?e:()=>e;function yo({nodeStrokeColor:e="transparent",nodeColor:o="#e2e2e2",nodeClassName:a="",nodeBorderRadius:p=5,nodeStrokeWidth:m=2,nodeComponent:r=ho,onClick:s}){const d=ve(go,Ge),i=ve(uo),l=$e(o),f=$e(e),x=$e(a),C=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return q.createElement(q.Fragment,null,d.map(g=>{const{x:b,y}=Ht(g,i).positionAbsolute;return q.createElement(r,{key:g.id,x:b,y,width:g.width,height:g.height,style:g.style,selected:g.selected,className:x(g),color:l(g),borderRadius:p,strokeColor:f(g),strokeWidth:m,shapeRendering:C,onClick:s,id:g.id})}))}var wo=u.memo(yo);const Co=200,xo=150,vo=e=>{const o=e.getNodes(),a={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:a,boundingRect:o.length>0?Wt(Vt(o,e.nodeOrigin),a):a,rfId:e.rfId}},bo="react-flow__minimap-desc";function Xe({style:e,className:o,nodeStrokeColor:a="transparent",nodeColor:p="#e2e2e2",nodeClassName:m="",nodeBorderRadius:r=5,nodeStrokeWidth:s=2,nodeComponent:d,maskColor:i="rgb(240, 240, 240, 0.6)",maskStrokeColor:l="none",maskStrokeWidth:f=1,position:x="bottom-right",onClick:C,onNodeClick:g,pannable:b=!1,zoomable:y=!1,ariaLabel:D="React Flow mini map",inversePan:j=!1,zoomStep:w=10,offsetScale:E=5}){const S=Rt(),H=u.useRef(null),{boundingRect:I,viewBB:$,rfId:Ne}=ve(vo,Ge),le=(e==null?void 0:e.width)??Co,te=(e==null?void 0:e.height)??xo,ke=I.width/le,oe=I.height/te,ne=Math.max(ke,oe),ce=ne*le,fe=ne*te,R=E*ne,ae=I.x-(ce-I.width)/2-R,he=I.y-(fe-I.height)/2-R,se=ce+R*2,Y=fe+R*2,L=`${bo}-${Ne}`,_=u.useRef(0);_.current=ne,u.useEffect(()=>{if(H.current){const T=Bt(H.current),Z=P=>{const{transform:U,d3Selection:J,d3Zoom:G}=S.getState();if(P.sourceEvent.type!=="wheel"||!J||!G)return;const pe=-P.sourceEvent.deltaY*(P.sourceEvent.deltaMode===1?.05:P.sourceEvent.deltaMode?1:.002)*w,me=U[2]*Math.pow(2,pe);G.scaleTo(J,me)},de=P=>{const{transform:U,d3Selection:J,d3Zoom:G,translateExtent:pe,width:me,height:ue}=S.getState();if(P.sourceEvent.type!=="mousemove"||!J||!G)return;const ie=_.current*Math.max(1,U[2])*(j?-1:1),X={x:U[0]-P.sourceEvent.movementX*ie,y:U[1]-P.sourceEvent.movementY*ie},Se=[[0,0],[me,ue]],Ae=Pt.translate(X.x,X.y).scale(U[2]),De=G.constrain()(Ae,Se,pe);G.transform(J,De)},Me=Lt().on("zoom",b?de:null).on("zoom.wheel",y?Z:null);return T.call(Me),()=>{T.on("zoom",null)}}},[b,y,j,w]);const W=C?T=>{const Z=Ot(T);C(T,{x:Z[0],y:Z[1]})}:void 0,je=g?(T,Z)=>{const de=S.getState().nodeInternals.get(Z);g(T,de)}:void 0;return q.createElement(_t,{position:x,style:e,className:Ue(["react-flow__minimap",o]),"data-testid":"rf__minimap"},q.createElement("svg",{width:le,height:te,viewBox:`${ae} ${he} ${se} ${Y}`,role:"img","aria-labelledby":L,ref:H,onClick:W},D&&q.createElement("title",{id:L},D),q.createElement(wo,{onClick:je,nodeColor:p,nodeStrokeColor:a,nodeBorderRadius:r,nodeClassName:m,nodeStrokeWidth:s,nodeComponent:d}),q.createElement("path",{className:"react-flow__minimap-mask",d:`M${ae-R},${he-R}h${se+R*2}v${Y+R*2}h${-se-R*2}z
        M${$.x},${$.y}h${$.width}v${$.height}h${-$.width}z`,fill:i,fillRule:"evenodd",stroke:l,strokeWidth:f,pointerEvents:"none"})))}Xe.displayName="MiniMap";var No=u.memo(Xe);const Re=({root:e,particles:o,decay:a,rotate:p,lifetime:m,fps:r,updateParticle:s,onFinish:d})=>{const i=m;let l=0,f=0;const x=1e3/r,C=g=>{f||(f=g);const b=g-f;if(b>=x&&(f=g-b%x,o.forEach(y=>s(y,l/i,a,p)),l+=1,l>=i)){o.forEach(y=>{y.element.parentNode===e&&e.removeChild(y.element)}),d();return}window.requestAnimationFrame(C)};window.requestAnimationFrame(C)},{PI:Ce}=Math,We=e=>e*(Ce/180),be=(e,o)=>{const a=Math.ceil(e),p=Math.floor(o);return Math.floor(Math.random()*(p-a))+a},Be=(e,o,a,p)=>{const m=We(e),r=We(o),{random:s}=Math;return{x:0,y:0,z:0,height:0,wobble:s()*10,velocity:a*.5+s()*a,angle2D:-m+(.5*r-s()*r),angle3D:-(Ce/4)+s()*(Ce/2),tiltAngle:s()*Ce,differentiator:p}},ko=e=>{const o=document.getElementById(e);return o||console.error(`Element with an ID of ${e} could not be found. Please provide a valid ID.`),o},jo=["#A45BF1","#25C6F6","#72F753","#F76C88","#F5F770"],Ke=[-.6,-.3,0,.3,.6],Mo=(e,o,a,p,m,r)=>Array.from({length:o}).map((s,d)=>{const i=document.createElement("span");return i.style["background-color"]=r[d%r.length],i.style.width=`${a}px`,i.style.height=`${a}px`,i.style.position=m,i.style.zIndex=`${p}`,e.appendChild(i),{element:i,differentiator:be(0,Ke.length)}}),So=(e,o,a)=>{const{x:p,y:m,tiltAngle:r,wobble:s,angle2D:d,angle3D:i,velocity:l,differentiator:f}=e.physics;e.physics.x+=Math.cos(d)*l,e.physics.y+=Math.sin(d)*l,e.physics.z+=Math.sin(i)*l,e.physics.wobble+=.05,e.physics.velocity*=a,e.physics.y+=3.5,e.physics.tiltAngle+=.15;const x=p+(Ke[f]*o*s*s+20*(f%2?Math.sin(s/4):Math.cos(s/4))),C=m+5*Math.sin(s);e.element.style.transform=`translate3d(${x}px, ${C}px, 0) rotate3d(1, 1, 1, ${f%2?r:-1*r}rad)`,e.element.style.scale=`${1-.2*o}`,o>.5&&(e.element.style.opacity=`${2-2*o}`)},Ao=(e,o,a)=>{const p=a||{},{elementCount:m=50,elementSize:r=8,colors:s=jo,angle:d=90,spread:i=45,decay:l=.94,lifetime:f=200,startVelocity:x=35,zIndex:C=0,position:g="fixed",fps:b=60,onAnimationComplete:y}=p,D=Mo(e,m,r,C,g,s).map(({element:j,differentiator:w})=>({element:j,physics:Be(d,i,x,w)}));Re({root:e,particles:D,decay:l,lifetime:f,fps:b,updateParticle:So,onFinish:()=>{typeof y=="function"&&y(),o()}})},Do=["🤓","😊","🥳"],Qe=[-.6,-.3,0,.3,.6],Eo=(e,o,a,p,m,r)=>Array.from({length:o}).map((s,d)=>{const i=document.createElement("span");return i.innerHTML=r[d%r.length],i.style.fontSize=`${a+be(0,4)}px`,i.style.position=m,i.style.zIndex=`${p}`,e.appendChild(i),{element:i,differentiator:be(0,Qe.length)}}),Fo=(e,o,a,p)=>{const{x:m,y:r,tiltAngle:s,angle2D:d,velocity:i,differentiator:l,wobble:f}=e.physics;e.physics.x+=Math.cos(d)*i,e.physics.y+=Math.sin(d)*i,e.physics.wobble+=0,e.physics.velocity*=a,e.physics.y+=5,e.physics.tiltAngle+=.05;const x=`translate3d(${m+(Qe[l]*o*f*f+20*Math.sin(f/4))}px, ${r}px, 0)`,C=p?`rotate3d(0, 0, 1, ${l%2?s:-1*s}rad)`:"";e.element.style.transform=[x,C].filter(Boolean).join(" "),o>.5&&(e.element.style.opacity=`${2-2*o}`)},Io=(e,o,a)=>{const p=a||{},{elementCount:m=20,elementSize:r=25,emoji:s=Do,angle:d=90,spread:i=45,decay:l=.94,lifetime:f=200,startVelocity:x=35,zIndex:C=0,position:g="fixed",rotate:b=!0,fps:y=60,onAnimationComplete:D}=p,j=Eo(e,m,r,C,g,s).map(({element:w,differentiator:E})=>({element:w,physics:Be(d,i,x,E)}));Re({root:e,particles:j,decay:l,rotate:b,lifetime:f,fps:y,updateParticle:Fo,onFinish:()=>{typeof D=="function"&&D(),o()}})};var $o=`<svg width="100%" viewBox="0 0 976 3040" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M489.693 1269.49C489.773 1378.79 410.493 1466.8 389.107 1571.11C384.147 1595.33 382.893 1620.12 386.187 1644.64C389.44 1668.83 399.28 1691.16 409.04 1713.29C419.253 1736.44 429.28 1760.11 429.453 1785.83C429.64 1812.27 416.307 1836.8 408.933 1861.59C396 1905.15 409.613 1948.88 425.213 1989.73C442.04 2033.83 461.387 2077.87 456.6 2126.17C453.92 2153.15 444.147 2179.13 434.2 2204.13C424.173 2229.35 413.72 2254.28 405.507 2280.17C389.213 2331.51 379.493 2385.83 378.267 2439.72C377.693 2464.89 380.333 2490.25 388.667 2514.11C397.053 2538.09 412.6 2558.75 424.733 2580.84C449.907 2626.64 458.453 2681 451.053 2732.52C443.853 2782.56 414.227 2825.99 408.893 2876.35C404.44 2918.39 416.733 2961.63 440.08 2996.53C450.373 3011.91 463.267 3025.44 477.867 3036.75C480.773 3039 484.88 3034.95 481.947 3032.68C446.147 3004.96 423.24 2964.2 415.907 2919.71C412.107 2896.61 413.627 2872.95 419.427 2850.35C426.053 2824.51 438.067 2800.36 446.667 2775.17C462.44 2729 463.147 2678.51 450.92 2631.45C444.733 2607.64 434.453 2585.4 421.893 2564.32C407.933 2540.91 394.307 2518.68 388.32 2491.71C382.493 2465.45 383.413 2438 385.56 2411.37C387.853 2382.85 392.467 2354.56 398.827 2326.67C405 2299.61 413.253 2273.05 423.107 2247.12C432.533 2222.27 443.533 2198.05 451.867 2172.8C459.707 2149.04 464.387 2124.29 463 2099.23C461.773 2077.19 455.64 2055.65 448.467 2034.89C433.587 1991.8 411.307 1949.77 409.413 1903.37C408.36 1877.76 417.12 1854.67 425.587 1830.97C433.68 1808.33 437.44 1786.41 432.787 1762.6C428.307 1739.63 417.333 1718.23 408.12 1696.91C397.267 1671.77 390.413 1646.41 390.013 1618.89C388.387 1509.52 469.707 1420.85 490.813 1316.72C493.973 1301.19 495.467 1285.33 495.453 1269.49C495.453 1265.77 489.693 1265.77 489.693 1269.49" stroke="#7A7E82" stroke-width="4"/>
<path d="M555.653 1298.41H423.52C415.173 1298.41 408.413 1305.17 408.413 1313.52C408.413 1321.85 415.173 1328.63 423.52 1328.63H555.653C564 1328.63 570.76 1321.85 570.76 1313.52C570.76 1305.17 564 1298.41 555.653 1298.41Z" fill="currentColor"/>
<path d="M555.653 1298.41H423.52C415.173 1298.41 408.413 1305.17 408.413 1313.52C408.413 1321.85 415.173 1328.63 423.52 1328.63H555.653C564 1328.63 570.76 1321.85 570.76 1313.52C570.76 1305.17 564 1298.41 555.653 1298.41Z" fill="black" fill-opacity="0.1"/>
<path d="M975.133 528.947C975.133 820.667 756.973 1255.43 487.853 1255.43C218.733 1255.43 0.559814 820.667 0.559814 528.947C0.559814 237.227 218.733 0.733359 487.853 0.733359C756.973 0.733359 975.133 237.227 975.133 528.947Z" fill="currentColor"/>
<path d="M549.04 1298.41C531.293 1285.91 519.893 1269.95 512.587 1254.2C504.387 1255.01 496.147 1255.43 487.853 1255.43C481.04 1255.43 474.28 1255.15 467.546 1254.6C460.226 1270.21 448.867 1286.01 431.253 1298.41H549.04Z" fill="currentColor"/>
<path d="M211.413 569.213C193.787 569.213 175.947 564.4 160.92 555.24C128.133 535.293 108.133 498.56 101.147 460.827C97.0133 438.533 96.9468 415.827 99.1068 393.214C120.627 308.28 168.453 234.48 233.467 183.733C246.947 173.213 261.16 163.693 276.027 155.267C280.347 152.813 284.72 150.467 289.147 148.2C291.707 147.373 294.347 146.92 297.12 146.92C301.347 146.92 305.907 147.974 311.067 150.414C332.773 160.64 334.36 192.213 323.693 213.72C313.04 235.226 294.187 251.8 283.413 273.253C262 315.88 276.48 366.707 287.347 413.147C298.213 459.6 302.427 515.373 267.8 548.187C252.707 562.48 232.227 569.213 211.413 569.213" fill="white" fill-opacity="0.2"/>
<path d="M785.133 110.4C863.72 204.187 911.613 328.747 911.613 465.414C911.613 757.147 693.44 1191.89 424.32 1191.89C350.973 1191.89 281.413 1159.6 219.013 1106.71C296.067 1196.16 388.48 1255.43 487.853 1255.43C756.973 1255.43 975.133 820.667 975.133 528.947C975.133 358.547 900.693 206.987 785.133 110.4Z" fill="black" fill-opacity="0.1"/>
</svg>`;const To=["#A45BF1","#25C6F6","#72F753","#F76C88","#F5F770"],et=[-.6,-.3,0,.3,.6],zo=(e,o,a)=>{o.parentNode===a&&a.removeChild(o)},Ro=(e,o,a,p,m,r)=>Array.from({length:o}).map((s,d)=>{const i=document.createElement("span");return i.innerHTML=$o,i.style.width=`${a}px`,i.style.position=m,i.style.color=r[d%r.length],i.style.zIndex=`${p}`,i.addEventListener("click",l=>{zo(l,i,e)},{once:!0}),e.appendChild(i),{element:i,differentiator:be(0,et.length)}}),Bo=(e,o,a)=>{const{x:p,y:m,tiltAngle:r,angle2D:s,velocity:d,differentiator:i,wobble:l}=e.physics;e.physics.x+=Math.cos(s)*.5*d,e.physics.y+=Math.sin(s)*.5*d,e.physics.wobble+=0,e.physics.velocity*=a,e.physics.tiltAngle+=.1;const f=p+(et[i]*o*l*l+20*Math.sin(l));e.element.style.transform=`translate3d(${f}px, ${m}px, 0) rotate3d(0, 0, 1, ${i%2?Math.sin(r/4)/3:Math.cos(r/4)/3}rad)`,e.element.style.scale=`${1-.2*o}`,o>.5&&(e.element.style.opacity=`${2-2*o}`)},Lo=(e,o,a)=>{const p=a||{},{angle:m=90,decay:r=.999,spread:s=50,startVelocity:d=3,elementCount:i=10,elementSize:l=20,lifetime:f=600,zIndex:x=0,position:C="fixed",colors:g=To,fps:b=60,onAnimationComplete:y}=p,D=Ro(e,i,l,x,C,g).map(({element:j,differentiator:w})=>({element:j,physics:Be(m,s,d,w)}));Re({root:e,particles:D,decay:r,lifetime:f,fps:b,updateParticle:Bo,onFinish:()=>{typeof y=="function"&&y(),o()}})},_o=(e,o,a)=>{const[p,m]=u.useState(!1),r=()=>{m(!1)};return{reward:u.useCallback(()=>{const s=ko(e);if(s)switch(m(!0),o){case"confetti":Ao(s,r,a);break;case"emoji":Io(s,r,a);break;case"balloons":Lo(s,r,a);break;default:console.error(`${o} is not a valid react-rewards type.`)}},[a,e,o]),isAnimating:p}};function tt({transform:e,isHumanInput:o,label:a,color:p}){return t.jsx("div",{style:{position:"absolute",background:"transparent",left:o?20:10,paddingTop:1,color:p,fontSize:"0.5rem",fontWeight:700,transform:e,zIndex:1e3},className:"nodrag nopan",children:a})}tt.propTypes={transform:z.string,isHumanInput:z.bool,label:z.string,color:z.string};const ot=({fromX:e,fromY:o,toX:a,toY:p,fromPosition:m,toPosition:r})=>{var g;const[s]=qt({sourceX:e,sourceY:o,sourcePosition:m,targetX:a,targetY:p,targetPosition:r}),{connectionHandleId:d}=ve(),i=ze(),l=(d||"").split("_")[0]||"",f=l==="humanInputAgentflow"||l==="conditionAgentflow"||l==="conditionAgentAgentflow",x=()=>{let b;if(l==="conditionAgentflow"||l==="conditionAgentAgentflow"){const y=d.split("-").pop();b=(isNaN(y)?0:y).toString()}if(l==="humanInputAgentflow"){const y=d.split("-").pop();b=(isNaN(y)?0:y).toString(),b=b==="0"?"proceed":"reject"}return b},C=((g=xe.find(b=>b.name===(d||"").split("_")[0]||""))==null?void 0:g.color)??i.palette.primary.main;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:C,strokeWidth:1.5,className:"animated",d:s}),t.jsxs("g",{transform:`translate(${a-10}, ${p-10}) scale(0.8)`,children:[t.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),t.jsx("path",{d:"M12 2c5.523 0 10 4.477 10 10a10 10 0 0 1 -20 0c0 -5.523 4.477 -10 10 -10m-.293 6.293a1 1 0 0 0 -1.414 0l-.083 .094a1 1 0 0 0 .083 1.32l2.292 2.293l-2.292 2.293a1 1 0 0 0 1.414 1.414l3 -3a1 1 0 0 0 0 -1.414z",fill:C})]}),f&&t.jsx(Yt,{children:t.jsx(tt,{color:C,isHumanInput:l==="humanInputAgentflow",label:x(),transform:`translate(-50%, 0%) translate(${e}px,${o}px)`})})]})};ot.propTypes={fromX:z.number,fromY:z.number,toX:z.number,toY:z.number,fromPosition:z.any,toPosition:z.any};const Po=u.memo(ot),Oo="/assets/validate_empty-BoEkQrnY.svg",Ho=e=>it.get(`/validation/${e}`),Wo={checkValidation:Ho},nt=({chatflowid:e,hidden:o})=>{const a=ze(),p=qe(),m=Te(w=>w.customization);Ye();const r=(...w)=>p(Ze(...w)),[s,d]=u.useState(!1),[i,l]=u.useState([]),[f,x]=u.useState(!1),C=u.useRef(null),g=u.useRef(s),b=w=>{C.current&&C.current.contains(w.target)||d(!1)},y=()=>{d(w=>!w)},D=async()=>{if(e)try{x(!0);const w=await Wo.checkValidation(e);l(w.data),w.data.length===0&&r({message:"No issues found in your flow!",options:{key:new Date().getTime()+Math.random(),variant:"success",autoHideDuration:3e3}})}catch(w){console.error(w),r({message:w.message||"Failed to validate flow",options:{key:new Date().getTime()+Math.random(),variant:"error",autoHideDuration:3e3}})}finally{x(!1)}};u.useEffect(()=>{g.current===!0&&s===!1&&C.current.focus(),g.current=s},[s,e]);const j=w=>{const E=w.name,S=xe.find(H=>H.name===E);return S?t.jsx(V,{sx:{width:"28px",height:"28px",borderRadius:"4px",backgroundColor:S.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:t.jsx(S.icon,{size:16})}):t.jsx(V,{sx:{width:"28px",height:"28px",borderRadius:"4px",backgroundColor:w.type==="LLM"?"#4747d1":"#f97316",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:w.type==="LLM"?t.jsx("span",{children:"ℓ"}):t.jsx(ro,{size:16})})};return t.jsxs(t.Fragment,{children:[!o&&t.jsx(ao,{sx:{position:"absolute",right:80,top:20},ref:C,size:"small",color:"teal","aria-label":"validation",title:"Validate Nodes",onClick:y,children:s?t.jsx(Q,{}):t.jsx(fo,{})}),t.jsx(rt,{placement:"bottom-end",open:s&&!o,anchorEl:C.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[80,14]}}]},sx:{zIndex:1e3},children:({TransitionProps:w})=>t.jsx(lt,{in:s,...w,children:t.jsx(Pe,{children:t.jsx(ct,{onClickAway:b,children:t.jsxs(dt,{elevation:16,border:!1,content:!1,sx:{p:2,width:"400px",maxWidth:"100%"},boxShadow:!0,shadow:a.shadows[16],children:[t.jsxs(pt,{variant:"h4",sx:{mt:1,mb:2},children:["Checklist (",i.length,")"]}),t.jsx(V,{sx:{maxHeight:"60vh",overflowY:"auto",pr:1,mr:-1},children:i.length>0?i.map((E,S)=>t.jsxs(Pe,{elevation:0,sx:{p:2,mb:2,backgroundColor:m.isDarkMode?a.palette.background.paper:a.palette.background.neutral,borderRadius:"8px",border:`1px solid ${mt("#FFB938",m.isDarkMode?.3:.5)}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[j(E),t.jsx("div",{style:{fontWeight:500},children:E.label||E.name})]}),t.jsx(V,{sx:{mt:2}}),E.issues.map((H,I)=>t.jsxs(V,{sx:{pt:2,px:2,pb:I===E.issues.length-1?2:1,backgroundColor:m.isDarkMode?ft("#FFB938",.85):ht("#FFB938",.9),display:"flex",alignItems:"center",gap:2},children:[t.jsx(io,{color:"#FFB938",size:20,style:{minWidth:"20px",width:"20px",height:"20px",flexShrink:0}}),t.jsx("span",{children:H})]},I))]},S)):t.jsx(V,{sx:{p:2,height:"auto",display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx("img",{style:{objectFit:"cover",height:"15vh",width:"auto"},src:Oo,alt:"validate_empty"})})}),t.jsx(V,{sx:{display:"flex",justifyContent:"center",mt:2,mb:1},children:t.jsx(ee,{variant:"contained",color:"teal",onClick:D,disabled:f,startIcon:f?null:t.jsx(po,{size:18}),sx:{color:"white",minWidth:"120px"},children:f?"Validating...":"Validate Flow"})})]})})})})})]})};nt.propTypes={chatflowid:z.string,hidden:z.bool};const Vo=u.memo(nt),qo={agentFlow:Tt,stickyNote:$t,iteration:It},Yo={agentFlow:Ft},Aa=()=>{const e=ze(),o=ut(),a=Te(n=>n.customization),{state:p}=gt(),m=p?p.templateFlowData:"",r=document.location.pathname.toString().split("/"),s=r[r.length-1]==="canvas"||r[r.length-1]==="agentcanvas"?"":r[r.length-1],d=r.includes("agentcanvas")?"Agent":"Chatflow",{confirm:i}=oo(),l=qe(),f=Te(n=>n.canvas),[x,C]=u.useState(f),[g,b]=u.useState(null),{reactFlowInstance:y,setReactFlowInstance:D}=u.useContext(yt);Ye();const j=(...n)=>l(Ze(...n)),w=(...n)=>l(Mt(...n)),[E,S,H]=Zt(),[I,$,Ne]=Ut(),[le,te]=u.useState(null),[ke,oe]=u.useState(!1),[ne,ce]=u.useState(!1),[fe,R]=u.useState({}),[ae,he]=u.useState(!1),se=u.useRef(null),Y=ge(lo.getAllNodes),L=ge(we.createNewChatflow),_=ge(we.updateChatflow),W=ge(we.getSpecificChatflow),je=n=>{var A,B;if(!Nt(n,y))return;const c=n.sourceHandle.split("_")[0],h=n.targetHandle.split("_")[0],v=((A=xe.find(F=>F.name===h))==null?void 0:A.color)??e.palette.primary.main,N=((B=xe.find(F=>F.name===c))==null?void 0:B.color)??e.palette.primary.main;let k;if(c==="conditionAgentflow"||c==="conditionAgentAgentflow"){const F=n.sourceHandle.split("-").pop();k=(isNaN(F)?0:F).toString()}c==="humanInputAgentflow"&&(k=n.sourceHandle.split("-").pop(),k=k==="0"?"proceed":"reject");const O=y.getNodes().find(F=>F.id===n.source),M=y.getNodes().find(F=>F.id===n.target),Ee=(O==null?void 0:O.parentNode)&&(M==null?void 0:M.parentNode)&&O.parentNode===M.parentNode,K={...n,data:{...n.data,sourceColor:N,targetColor:v,edgeLabel:k,isHumanInput:c==="humanInputAgentflow"},...Ee&&{zIndex:9999},type:"agentFlow",id:`${n.source}-${n.sourceHandle}-${n.target}-${n.targetHandle}`};$(F=>Jt(K,F))},T=n=>{try{const c=JSON.parse(n),h=c.nodes||[];S(h),$(c.edges||[]),setTimeout(()=>X(),0)}catch(c){console.error(c)}},Z=async()=>{const n={title:"Delete",description:`Delete ${d} ${g.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await i(n))try{await we.deleteChatflow(g.id),localStorage.removeItem(`${g.id}_INTERNAL`),o("/agentflows")}catch(h){j({message:typeof h.response.data=="object"?h.response.data.message:h.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:v=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(v),children:t.jsx(Q,{})})}})}},de=n=>{if(y){const c=y.getNodes().map(N=>{const k=re.cloneDeep(N.data);return Object.prototype.hasOwnProperty.call(k.inputs,Ie)&&(k.credential=k.inputs[Ie],k.inputs=re.omit(k.inputs,[Ie])),N.data={...k,selected:!1,status:void 0},N}),h=y.toObject();h.nodes=c;const v=JSON.stringify(h);if(g.id){const N={name:n,flowData:v};_.request(g.id,N)}else{const N={name:n,deployed:!1,isPublic:!1,flowData:v,type:"AGENTFLOW"};L.request(N)}}},Me=u.useCallback((n,c)=>{te(c),S(h=>h.map(v=>(v.id===c.id?v.data={...v.data,selected:!0}:v.data={...v.data,selected:!1},v)))}),P=u.useCallback((n,c)=>{if(!(!c||!c.data)&&c.data.name!=="stickyNoteAgentflow"){const h={data:c.data,inputParams:c.data.inputParams.filter(v=>!v.hidden)};R(h),ce(!0)}}),U=u.useCallback(n=>{n.preventDefault(),n.dataTransfer.dropEffect="move"},[]),J=u.useCallback(n=>{n.preventDefault();const c=se.current.getBoundingClientRect();let h=n.dataTransfer.getData("application/reactflow");if(typeof h>"u"||!h)return;h=JSON.parse(h);const v=y.project({x:n.clientX-c.left-100,y:n.clientY-c.top-50}),N=y.getNodes();if(h.name==="startAgentflow"&&N.find(A=>A.data.name==="startAgentflow")){j({message:"Only one start node is allowed",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:A=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(A),children:t.jsx(Q,{})})}});return}const k=wt(h,y.getNodes()),O=Ct(h,N),M={id:k,position:v,data:{...Oe(h,k,!0),label:O}};h.type==="Iteration"?M.type="iteration":h.type==="StickyNote"?M.type="stickyNote":M.type="agentFlow";const Ee=N.filter(A=>A.type==="iteration");let K=null;for(const A of Ee){const B=A.width||300,F=A.height||250,Le=A.position.x,at=Le+B,_e=A.position.y,st=_e+F;if(v.x>=Le&&v.x<=at&&v.y>=_e&&v.y<=st){if(K=A,h.name==="iterationAgentflow"){j({message:"Nested iteration node is not supported yet",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Fe=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(Fe),children:t.jsx(Q,{})})}});return}if(h.name==="humanInputAgentflow"){j({message:"Human input node is not supported inside Iteration node",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Fe=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(Fe),children:t.jsx(Q,{})})}});return}break}}K&&(M.parentNode=K.id,M.extent="parent",M.position={x:v.x-K.position.x,y:v.y-K.position.y}),te(M),S(A=>(A??[]).concat(M).map(B=>(B.id===M.id?B.data={...B.data,selected:!0}:B.data={...B.data,selected:!1},B))),setTimeout(()=>X(),0)},[y]),G=()=>{const n=f.componentNodes,c=re.cloneDeep(E),h=re.cloneDeep(I);let v=[];for(let N=0;N<c.length;N++){const k=c[N],O=n.find(M=>M.name===k.data.name);if(O&&O.version>k.data.version){const M=re.cloneDeep(O);c[N].data=kt(M,k.data,!0),v.push(...jt(c[N].data,h))}}S(c),$(h.filter(N=>!v.includes(N))),X(),oe(!1)},{reward:pe}=_o("canvasConfetti","confetti",{elementCount:150,spread:80,lifetime:300,startVelocity:40,zIndex:1e4,decay:.92,position:"fixed"}),me=()=>{setTimeout(()=>{pe()},50)},ue=()=>{l({type:He}),j({message:`${d} saved`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:n=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(n),children:t.jsx(Q,{})})}})},ie=n=>{j({message:n,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:c=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(c),children:t.jsx(Q,{})})}})},X=()=>{l({type:xt})},Se=n=>{const c=f.componentNodes;for(let h=0;h<n.length;h++){const v=n[h],N=c.find(k=>k.name===v.data.name);if(N&&N.version>v.data.version){oe(!0);return}}oe(!1)};u.useEffect(()=>{if(W.data){const n=W.data,c=n.flowData?JSON.parse(n.flowData):[];S(c.nodes||[]),$(c.edges||[]),l({type:ye,chatflow:n})}else W.error&&ie(`Failed to retrieve ${d}: ${W.error.response.data.message}`)},[W.data,W.error]),u.useEffect(()=>{if(L.data){const n=L.data;l({type:ye,chatflow:n}),ue(),window.history.replaceState(p,null,`/v2/agentcanvas/${n.id}`)}else L.error&&ie(`Failed to save ${d}: ${L.error.response.data.message}`)},[L.data,L.error]),u.useEffect(()=>{_.data?(l({type:ye,chatflow:_.data}),ue()):_.error&&ie(`Failed to save ${d}: ${_.error.response.data.message}`)},[_.data,_.error]),u.useEffect(()=>{if(b(x.chatflow),x.chatflow){const n=x.chatflow.flowData?JSON.parse(x.chatflow.flowData):[];Se(n.nodes||[])}},[x.chatflow]),u.useEffect(()=>(oe(!1),s?W.request(s):(localStorage.getItem("duplicatedFlowData")?(T(localStorage.getItem("duplicatedFlowData")),setTimeout(()=>localStorage.removeItem("duplicatedFlowData"),0)):(S([]),$([])),l({type:ye,chatflow:{name:`Untitled ${d}`}})),Y.request(),()=>{setTimeout(()=>l({type:He}),0)}),[]),u.useEffect(()=>{C(f)},[f]),u.useEffect(()=>{function n(c){const h=c.clipboardData.getData("text");h.includes('{"nodes":[')&&h.includes('],"edges":[')&&T(h)}return window.addEventListener("paste",n),()=>{window.removeEventListener("paste",n)}},[]),u.useEffect(()=>{m&&m.includes('"nodes":[')&&m.includes('],"edges":[')&&T(m)},[m]),Xt("You have unsaved changes! Do you want to navigate away?",x.isDirty);const[Ae,De]=u.useState(!1);return u.useEffect(()=>{if(!s&&!localStorage.getItem("duplicatedFlowData")&&Y.data&&E.length===0){const n=Y.data.find(c=>c.name==="startAgentflow");if(n){const c=re.cloneDeep(n);c.position={x:100,y:100};const h={id:"startAgentflow_0",type:"agentFlow",position:{x:100,y:100},data:{...Oe(c,"startAgentflow_0",!0),label:"Start"}};S([h]),$([])}}},[Y.data,s]),t.jsxs(t.Fragment,{children:[t.jsx("span",{id:"canvasConfetti",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"0",height:"0",zIndex:9999,pointerEvents:"none",background:"transparent"}}),t.jsxs(V,{children:[t.jsx(vt,{enableColorOnDark:!0,position:"fixed",color:"inherit",elevation:1,sx:{bgcolor:e.palette.background.default},children:t.jsx(bt,{children:t.jsx(Kt,{chatflow:g,handleSaveFlow:de,handleDeleteFlow:Z,handleLoadFlow:T,isAgentCanvas:!0,isAgentflowV2:!0})})}),t.jsx(V,{sx:{pt:"70px",height:"100vh",width:"100%"},children:t.jsx("div",{className:"reactflow-parent-wrapper",children:t.jsx("div",{className:"reactflow-wrapper",ref:se,children:t.jsxs(Gt,{nodes:E,edges:I,onNodesChange:H,onNodeClick:Me,onNodeDoubleClick:P,onEdgesChange:Ne,onDrop:J,onDragOver:U,onNodeDragStop:X,nodeTypes:qo,edgeTypes:Yo,onConnect:je,onInit:D,fitView:!0,deleteKeyCode:f.canvasDialogShow?null:["Delete"],minZoom:.5,snapGrid:[25,25],snapToGrid:ae,connectionLineComponent:Po,children:[t.jsx(St,{className:a.isDarkMode?"dark-mode-controls":"",style:{display:"flex",flexDirection:"row",left:"50%",transform:"translate(-50%, -50%)"},children:t.jsx("button",{className:"react-flow__controls-button react-flow__controls-interactive",onClick:()=>{he(!ae)},title:"toggle snapping","aria-label":"toggle snapping",children:ae?t.jsx(At,{}):t.jsx(Dt,{})})}),t.jsx(No,{nodeStrokeWidth:3,nodeColor:a.isDarkMode?"#2d2d2d":"#e2e2e2",nodeStrokeColor:a.isDarkMode?"#525252":"#fff",maskColor:a.isDarkMode?"rgb(45, 45, 45, 0.6)":"rgb(240, 240, 240, 0.6)",style:{backgroundColor:a.isDarkMode?e.palette.background.default:"#fff"}}),t.jsx(Et,{color:"#aaa",gap:16}),t.jsx(Qt,{isAgentCanvas:!0,isAgentflowv2:!0,nodesData:Y.data,node:le,onFlowGenerated:me}),t.jsx(zt,{show:ne,dialogProps:fe,onCancel:()=>ce(!1)}),ke&&t.jsx(so,{sx:{left:60,top:20,color:"white",background:"orange","&:hover":{background:"orange",backgroundImage:"linear-gradient(rgb(0 0 0/10%) 0 0)"}},size:"small","aria-label":"sync",title:"Sync Nodes",onClick:()=>G(),children:t.jsx(eo,{})}),t.jsx(to,{isAgentCanvas:!0,chatflowid:s,onOpenChange:De}),!Ae&&t.jsx(Vo,{isAgentCanvas:!0,chatflowid:s})]})})})}),t.jsx(no,{})]})]})};export{Aa as default};
