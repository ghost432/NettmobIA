import{a as T,f as J,t as Y,b7 as _,r as s,c as f,u as K,cM as Q,bh as X,bi as v,d5 as Z,cN as O,j as e,M as ee,S as x,q as g,o as l,Y as I,B as D,E as te}from"./index-B5bgjFPS.js";import{I as G}from"./Input-CajAyvOv.js";import{a as se}from"./auth-Bhw5H-7k.js";import{l as re}from"./loginmethod-CpJzrLw7.js";import{s as ae}from"./sso-BIcGhpUd.js";import{A as ie,G as oe,a as ne}from"./auth0-DQBmZI7E.js";import{G as le}from"./github-BtlA98as.js";import{A as M,I as ce}from"./IconExclamationCircle-Dzy6pM40.js";import{L as de}from"./LoadingButton-CJHvS9bV.js";import{I as j}from"./Icon-BpanFwP0.js";import"./ListItem-BfStHUI0.js";import"./FormControl-o0rphY-g.js";import"./Close-DT9tpzn1.js";const be=()=>{const n=T();J(t=>t.customization),Y();const{isEnterpriseLicensed:U,isCloud:b,isOpenSource:k}=_(),V={label:"Username",name:"username",type:"email",placeholder:"user@company.com"},q={label:"Password",name:"password",type:"password",placeholder:"********"},[S,B]=s.useState(""),[E,W]=s.useState(""),[r,H]=s.useState([]),[u,d]=s.useState(void 0),[N,y]=s.useState(!1),[P,w]=s.useState(!1),[A,R]=s.useState(""),a=f(se.login),o=f(ae.ssoLogin),h=f(re.getDefaultLoginMethods),L=K(),p=Q(),z=f(X.resendVerificationEmail),F=t=>{t.preventDefault(),y(!0);const i={email:S,password:E};a.request(i)};s.useEffect(()=>{a.error&&(y(!1),a.error.response.status===401&&a.error.response.data.redirectUrl?window.location.href=a.error.response.data.data.redirectUrl:d(a.error.response.data.message))},[a.error]),s.useEffect(()=>{v.dispatch(Z()),k||h.request()},[]),s.useEffect(()=>{const i=new URLSearchParams(p.search).get("error");if(!i)return;const c=JSON.parse(decodeURIComponent(i));d(c.message)},[p.search]),s.useEffect(()=>{var t;a.data&&(y(!1),v.dispatch(O(a.data)),L(((t=p.state)==null?void 0:t.path)||"/chatflows"))},[a.data]),s.useEffect(()=>{var t;o.data&&(v.dispatch(O(o.data)),L(((t=p.state)==null?void 0:t.path)||"/chatflows"))},[o.data]),s.useEffect(()=>{var t,i,c,C;o.error&&(((i=(t=o.error)==null?void 0:t.response)==null?void 0:i.status)===401&&((C=(c=o.error)==null?void 0:c.response)!=null&&C.data.redirectUrl)?window.location.href=o.error.response.data.redirectUrl:d(o.error.message))},[o.error]),s.useEffect(()=>{h.data&&h.data.providers&&H(h.data.providers.map(t=>t))},[h.data]),s.useEffect(()=>{w(u==="User Email Unverified")},[u]);const m=t=>{window.location.href=`/api/v1/${t}/login`},$=async()=>{var t,i;try{await z.request({email:S}),d(void 0),R("Verification email has been sent successfully."),w(!1)}catch(c){d(((i=(t=c.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to send verification email.")}};return e.jsx(e.Fragment,{children:e.jsx(ee,{maxWidth:"sm",children:e.jsxs(x,{flexDirection:"column",sx:{width:"480px",gap:3},children:[A&&e.jsx(M,{variant:"filled",severity:"success",onClose:()=>R(""),children:A}),u&&e.jsx(M,{icon:e.jsx(ce,{}),variant:"filled",severity:"error",children:u}),P&&e.jsx(x,{sx:{gap:1},children:e.jsx(g,{variant:"text",onClick:$,children:"Resend Verification Email"})}),e.jsxs(x,{sx:{gap:1},children:[e.jsx(l,{variant:"h1",children:"Sign In"}),b&&e.jsxs(l,{variant:"body2",sx:{color:n.palette.grey[600]},children:["Don't have an account?"," ",e.jsx(I,{style:{color:`${n.palette.primary.main}`},to:"/register",children:"Sign up for free"}),"."]}),U&&e.jsxs(l,{variant:"body2",sx:{color:n.palette.grey[600]},children:["Have an invite code?"," ",e.jsx(I,{style:{color:`${n.palette.primary.main}`},to:"/register",children:"Sign up for an account"}),"."]})]}),e.jsx("form",{onSubmit:F,children:e.jsxs(x,{sx:{width:"100%",flexDirection:"column",alignItems:"left",justifyContent:"center",gap:2},children:[e.jsxs(D,{sx:{p:0},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(l,{children:["Email",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(G,{inputParam:V,onChange:t=>B(t),value:S,showDialog:!1})]}),e.jsxs(D,{sx:{p:0},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(l,{children:["Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(G,{inputParam:q,onChange:t=>W(t),value:E}),e.jsx(l,{variant:"body2",sx:{color:n.palette.grey[600],mt:1,textAlign:"right"},children:e.jsx(I,{style:{color:n.palette.primary.main},to:"/forgot-password",children:"Forgot password?"})}),b&&e.jsx(l,{variant:"body2",sx:{color:n.palette.grey[600],mt:1,textAlign:"right"},children:e.jsx("a",{href:"https://docs.flowiseai.com/migration-guide/cloud-migration",target:"_blank",rel:"noopener noreferrer",style:{color:n.palette.primary.main},children:"Migrate from existing account?"})})]}),e.jsx(de,{loading:N,variant:"contained",style:{borderRadius:12,height:40,marginRight:5},type:"submit",children:"Login"}),r&&r.length>0&&e.jsx(te,{sx:{width:"100%"},children:"OR"}),r&&r.map(t=>t==="azure"&&e.jsx(g,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>m(t),startIcon:e.jsx(j,{children:e.jsx("img",{src:ie,alt:"MicrosoftSSO",width:20,height:20})}),children:"Sign In With Microsoft"},t)),r&&r.map(t=>t==="google"&&e.jsx(g,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>m(t),startIcon:e.jsx(j,{children:e.jsx("img",{src:oe,alt:"GoogleSSO",width:20,height:20})}),children:"Sign In With Google"},t)),r&&r.map(t=>t==="auth0"&&e.jsx(g,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>m(t),startIcon:e.jsx(j,{children:e.jsx("img",{src:ne,alt:"Auth0SSO",width:20,height:20})}),children:"Sign In With Auth0 by Okta"},t)),r&&r.map(t=>t==="github"&&e.jsx(g,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>m(t),startIcon:e.jsx(j,{children:e.jsx("img",{src:le,alt:"GithubSSO",width:20,height:20})}),children:"Sign In With Github"},t))]})})]})})})};export{be as default};
