import{a as N,t as P,b7 as U,u as Z,r as t,c as j,bi as k,cN as A,j as e,B as d,M as G,d3 as V,o as f,R as $,h as X,a8 as Y,a3 as J,d4 as L,q as W,E as K,aj as z,Y as Q}from"./index-B5bgjFPS.js";import{B as _}from"./BackdropLoader-Ch3nVEPr.js";import{a as ee}from"./auth-Bhw5H-7k.js";import{l as oe}from"./loginmethod-CpJzrLw7.js";import{s as re}from"./sso-BIcGhpUd.js";import{A as F,I as te}from"./IconExclamationCircle-Dzy6pM40.js";import{I as se}from"./IconCircleCheck-DFCqko6z.js";import{T as I}from"./TextField-OmGdqrIf.js";import{I as ie}from"./InputAdornment-v58Edx4J.js";import{o as ne,s as B}from"./schemas-3ZMdv4w1.js";import"./Close-DT9tpzn1.js";import"./InputLabel-BtU13bbu.js";import"./FormControl-o0rphY-g.js";const ae=ne({email:B().min(1,"L'adresse e-mail est requise").email("Adresse e-mail invalide"),password:B().min(1,"Le mot de passe est requis")}),ye=()=>{N(),P();const{isEnterpriseLicensed:le,isCloud:de,isOpenSource:v}=U(),h=Z(),[c,T]=t.useState({email:"",password:"",rememberMe:!1}),[g,R]=t.useState(!1),[a,b]=t.useState({}),[y,p]=t.useState(!1),[S,x]=t.useState(""),[E,D]=t.useState(void 0),[M,q]=t.useState([]),s=j(ee.login),l=j(re.ssoLogin),u=j(oe.getDefaultLoginMethods);t.useEffect(()=>{const o=document.body.style.overflow,r=document.documentElement.style.overflow,i=document.body.style.margin,n=document.documentElement.style.margin;return document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.body.style.margin="0",document.documentElement.style.margin="0",()=>{document.body.style.overflow=o,document.documentElement.style.overflow=r,document.body.style.margin=i,document.documentElement.style.margin=n}},[]);const w=o=>{const{name:r,value:i,type:n,checked:m}=o.target;T(C=>({...C,[r]:n==="checkbox"?m:i})),a[r]&&b(C=>({...C,[r]:""}))},O=async o=>{o.preventDefault(),x(""),b({}),p(!0);const r=ae.safeParse({email:c.email,password:c.password});if(!r.success){const n={};r.error.errors.forEach(m=>{n[m.path[0]]=m.message}),b(n),p(!1);return}const i={email:c.email,password:c.password};console.log("Sending login request:",i),s.request(i)},H=o=>{window.location.href=`/api/v1/${o}/login`};return t.useEffect(()=>{var o,r,i,n,m;s.error&&(console.error("Login API error:",s.error),p(!1),((o=s.error.response)==null?void 0:o.status)===401&&((i=(r=s.error.response)==null?void 0:r.data)!=null&&i.redirectUrl)?window.location.href=s.error.response.data.redirectUrl:x(((m=(n=s.error.response)==null?void 0:n.data)==null?void 0:m.message)||s.error.message||"Erreur lors de la connexion. Veuillez vérifier vos identifiants et réessayer."))},[s.error]),t.useEffect(()=>{v||u.request()},[v,u]),t.useEffect(()=>{l.data&&(k.dispatch(A(l.data)),h("/chatflows"))},[l.data,h]),t.useEffect(()=>{var o,r,i,n;l.error&&(((r=(o=l.error)==null?void 0:o.response)==null?void 0:r.status)===401&&((n=(i=l.error)==null?void 0:i.response)!=null&&n.data.redirectUrl)?window.location.href=l.error.response.data.redirectUrl:x(l.error.message))},[l.error]),t.useEffect(()=>{u.data&&u.data.providers&&q(u.data.providers.map(o=>o))},[u.data]),t.useEffect(()=>{s.data&&(console.log("Login successful:",s.data),p(!1),x(void 0),D("Connexion réussie ! Redirection en cours..."),k.dispatch(A(s.data)),setTimeout(()=>{h("/chatflows")},1e3))},[s.data,h]),e.jsxs(d,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f3f4f6",overflow:"hidden",margin:0,padding:0,boxSizing:"border-box"},children:[e.jsxs(G,{maxWidth:"md",sx:{width:"100%",maxWidth:"600px",border:"none",boxShadow:"none",backgroundColor:"transparent",margin:0,padding:0},children:[e.jsxs(d,{sx:{textAlign:"center",mb:4},children:[e.jsx(d,{sx:{mb:3},children:e.jsx("img",{alt:"Netmob",src:V,style:{height:"60px",width:"auto",margin:"0 auto",objectFit:"contain"}})}),e.jsx(f,{variant:"h4",sx:{fontWeight:"bold",color:"#111827",mb:0},children:"Connectez-vous à votre compte"})]}),S&&e.jsx(F,{icon:e.jsx(te,{}),variant:"filled",severity:"error",sx:{mb:2,borderRadius:1},children:S}),E&&e.jsx(F,{icon:e.jsx(se,{}),variant:"filled",severity:"success",sx:{mb:2,borderRadius:1},children:E}),e.jsxs($,{elevation:1,sx:{p:4,borderRadius:2,backgroundColor:"white",width:"100%",maxWidth:"100%",boxSizing:"border-box",overflow:"hidden",margin:0},children:[e.jsxs("form",{onSubmit:O,children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(f,{component:"label",htmlFor:"email",sx:{display:"block",fontSize:"0.875rem",fontWeight:500,color:"#111827",mb:1},children:"Adresse e-mail"}),e.jsx(I,{id:"email",name:"email",type:"text",required:!0,fullWidth:!0,autoComplete:"email",value:c.email,onChange:w,error:!!a.email,helperText:a.email,sx:{"& .MuiOutlinedInput-root":{borderRadius:1,backgroundColor:"white","& fieldset":{borderColor:a.email?"#EF4444":"#d1d5db"},"&:hover fieldset":{borderColor:a.email?"#EF4444":"#9ca3af"},"&.Mui-focused fieldset":{borderColor:a.email?"#EF4444":"#4f46e5",borderWidth:2}},"& .MuiFormHelperText-root":{color:"#EF4444",fontSize:"0.75rem",marginTop:.5},"& .MuiInputBase-input":{py:1.5,px:1.5,fontSize:"0.875rem",color:"#111827"}}})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(f,{component:"label",htmlFor:"password",sx:{display:"block",fontSize:"0.875rem",fontWeight:500,color:"#111827",mb:1},children:"Mot de passe"}),e.jsx(I,{id:"password",name:"password",type:g?"text":"password",required:!0,fullWidth:!0,autoComplete:"current-password",value:c.password,onChange:w,error:!!a.password,helperText:a.password,InputProps:{endAdornment:e.jsx(ie,{position:"end",children:e.jsx(X,{"aria-label":"toggle password visibility",onClick:()=>R(!g),edge:"end",sx:{color:"#6b7280"},children:g?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:1,backgroundColor:"white","& fieldset":{borderColor:a.password?"#EF4444":"#d1d5db"},"&:hover fieldset":{borderColor:a.password?"#EF4444":"#9ca3af"},"&.Mui-focused fieldset":{borderColor:a.password?"#EF4444":"#4f46e5",borderWidth:2}},"& .MuiFormHelperText-root":{color:"#EF4444",fontSize:"0.75rem",marginTop:.5},"& .MuiInputBase-input":{py:1.5,px:1.5,fontSize:"0.875rem",color:"#111827"}}})]}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(Y,{control:e.jsx(J,{name:"rememberMe",checked:c.rememberMe,onChange:w,sx:{color:"#4f46e5","&.Mui-checked":{color:"#4f46e5"}}}),label:e.jsx(f,{sx:{fontSize:"0.875rem",color:"#111827"},children:"Se souvenir de moi"})}),e.jsx(L,{href:"#",sx:{fontSize:"0.875rem",fontWeight:600,color:"#4f46e5",textDecoration:"none","&:hover":{color:"#4338ca"}},children:"Mot de passe oublié ?"})]}),e.jsx(W,{type:"submit",fullWidth:!0,variant:"contained",sx:{py:2,mb:3,borderRadius:1,backgroundColor:"#4f46e5",fontSize:"0.875rem",fontWeight:600,textTransform:"none",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)","&:hover":{backgroundColor:"#4338ca"},"&:focus":{outline:"2px solid #4f46e5",outlineOffset:"2px"}},children:"Se connecter"})]}),e.jsx(d,{sx:{my:3},children:e.jsx(K,{sx:{position:"relative"},children:e.jsx(f,{sx:{position:"absolute",left:"50%",transform:"translateX(-50%)",backgroundColor:"white",px:2,fontSize:"0.875rem",fontWeight:500,color:"#111827",whiteSpace:"nowrap"},children:"Ou continuer avec"})})}),M.length>0&&e.jsx(z,{container:!0,spacing:2,children:M.map(o=>e.jsx(z,{item:!0,xs:6,children:e.jsxs(W,{fullWidth:!0,variant:"outlined",onClick:()=>H(o),startIcon:o==="google"?e.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",style:{width:"20px",height:"20px"},children:[e.jsx("path",{d:"M12.0003 4.75C13.7703 4.75 15.3553 5.36002 16.6053 6.54998L20.0303 3.125C17.9502 1.19 15.2353 0 12.0003 0C7.31028 0 3.25527 2.69 1.28027 6.60998L5.27028 9.70498C6.21525 6.86002 8.87028 4.75 12.0003 4.75Z",fill:"#EA4335"}),e.jsx("path",{d:"M23.49 12.275C23.49 11.49 23.415 10.73 23.3 10H12V14.51H18.47C18.18 15.99 17.34 17.25 16.08 18.1L19.945 21.1C22.2 19.01 23.49 15.92 23.49 12.275Z",fill:"#4285F4"}),e.jsx("path",{d:"M5.26498 14.2949C5.02498 13.5699 4.88501 12.7999 4.88501 11.9999C4.88501 11.1999 5.01998 10.4299 5.26498 9.7049L1.275 6.60986C0.46 8.22986 0 10.0599 0 11.9999C0 13.9399 0.46 15.7699 1.28 17.3899L5.26498 14.2949Z",fill:"#FBBC05"}),e.jsx("path",{d:"M12.0004 24.0001C15.2404 24.0001 17.9654 22.935 19.9454 21.095L16.0804 18.095C15.0054 18.82 13.6204 19.245 12.0004 19.245C8.8704 19.245 6.21537 17.135 5.2654 14.29L1.27539 17.385C3.25539 21.31 7.3104 24.0001 12.0004 24.0001Z",fill:"#34A853"})]}):o==="github"?e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",style:{width:"20px",height:"20px",fill:"#24292F"},children:e.jsx("path",{d:"M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z",clipRule:"evenodd",fillRule:"evenodd"})}):null,sx:{py:1.5,borderRadius:1,borderColor:"#d1d5db",backgroundColor:"white",color:"#111827",fontSize:"0.875rem",fontWeight:600,textTransform:"none",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)","&:hover":{backgroundColor:"#f9fafb",borderColor:"#9ca3af"}},children:[o==="google"&&"Google",o==="azure"&&"Microsoft",o==="auth0"&&"Auth0",o==="github"&&"GitHub"]})},o))})]}),e.jsx(d,{sx:{textAlign:"center",mt:3},children:e.jsxs(f,{sx:{fontSize:"0.875rem",color:"#6b7280"},children:["Pas encore membre ?"," ",e.jsx(L,{component:Q,to:"/register2",sx:{fontWeight:600,color:"#4f46e5",textDecoration:"none","&:hover":{color:"#4338ca"}},children:"S'inscrire"})]})})]}),y&&e.jsx(_,{open:y})]})};export{ye as default};
