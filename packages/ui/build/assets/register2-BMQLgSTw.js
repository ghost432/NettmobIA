import{a as Z,t as _,b7 as ee,u as oe,d6 as re,r as i,c as T,bh as se,bi as te,cN as ie,j as e,B as d,M as ne,d3 as ae,o as c,R as le,h as L,a8 as de,d4 as R,a3 as ce,q as B,E as me,aj as O,Y as ue}from"./index-B5bgjFPS.js";import{B as pe}from"./BackdropLoader-Ch3nVEPr.js";import{l as fe}from"./loginmethod-CpJzrLw7.js";import{s as he}from"./sso-BIcGhpUd.js";import{p as U}from"./validation-D5cE1cK5.js";import{A as D,I as xe}from"./IconExclamationCircle-Dzy6pM40.js";import{I as ge}from"./IconCircleCheck-DFCqko6z.js";import{T as C}from"./TextField-OmGdqrIf.js";import{I as H}from"./InputAdornment-v58Edx4J.js";import{I as V}from"./IconEyeOff-CPUbKGOq.js";import{I as N}from"./IconEye-Ci4p6xvE.js";import{o as G,s as f}from"./schemas-3ZMdv4w1.js";import"./Close-DT9tpzn1.js";import"./InputLabel-BtU13bbu.js";import"./FormControl-o0rphY-g.js";const be=G({username:f().min(1,"Le nom complet est requis"),email:f().min(1,"L'adresse e-mail est requise").email("Adresse e-mail invalide"),password:U,confirmPassword:f().min(1,"La confirmation du mot de passe est requise"),token:f().min(1,"Le code d'invitation est requis")}).refine(a=>a.password===a.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),we=G({username:f().min(1,"Le nom complet est requis"),email:f().min(1,"L'adresse e-mail est requise").email("Adresse e-mail invalide"),password:U,confirmPassword:f().min(1,"La confirmation du mot de passe est requise")}).refine(a=>a.password===a.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),Ae=()=>{Z(),_();const{isEnterpriseLicensed:a,isCloud:w,isOpenSource:E}=ee(),j=oe(),[$]=re(),[s,P]=i.useState({username:"",email:"",password:"",confirmPassword:"",token:$.get("token")??"",acceptTerms:!1}),[S,J]=i.useState(!1),[k,X]=i.useState(!1),[M,h]=i.useState(!1),[I,m]=i.useState(""),[W,F]=i.useState(void 0),[z,Y]=i.useState([]),[o,y]=i.useState({}),u=T(se.registerAccount),p=T(he.ssoLogin),x=T(fe.getDefaultLoginMethods);i.useEffect(()=>{const r=document.body.style.overflow,n=document.documentElement.style.overflow,l=document.body.style.margin,t=document.documentElement.style.margin;return document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.body.style.margin="0",document.documentElement.style.margin="0",()=>{document.body.style.overflow=r,document.documentElement.style.overflow=n,document.body.style.margin=l,document.documentElement.style.margin=t}},[]);const g=r=>{const{name:n,value:l,type:t,checked:b}=r.target;P(v=>({...v,[n]:t==="checkbox"?b:l})),o[n]&&y(v=>({...v,[n]:""}))},K=async r=>{var n,l;r.preventDefault(),m(""),y({}),h(!0),console.log("Form submitted with data:",s),console.log("isEnterpriseLicensed:",a,"isCloud:",w,"isOpenSource:",E);try{if(!s.acceptTerms){y({acceptTerms:"Vous devez accepter les conditions d'utilisation"}),h(!1);return}let t=null,b=null;if(a?(t=be.safeParse({username:s.username,email:s.email,token:s.token,password:s.password,confirmPassword:s.confirmPassword}),t.success&&(b={user:{name:s.username,email:s.email,credential:s.password,tempToken:s.token}})):(t=we.safeParse({username:s.username,email:s.email,password:s.password,confirmPassword:s.confirmPassword}),t.success&&(b={user:{name:s.username,email:s.email,credential:s.password}})),!t.success){const q={};t.error.errors.forEach(A=>{q[A.path[0]]=A.message}),y(q),h(!1);return}console.log("Sending registration request:",b);const v=await u.request(b);console.log("Registration response:",v)}catch(t){console.error("Registration error:",t),h(!1),(l=(n=t.response)==null?void 0:n.data)!=null&&l.message?m(t.response.data.message):t.message?m(t.message):m("Une erreur est survenue lors de l'inscription. Veuillez réessayer.")}},Q=r=>{window.location.href=`/api/v1/${r}/login`};return i.useEffect(()=>{var r,n,l;u.error&&(console.error("Registration API error:",u.error),h(!1),m(a?`Erreur lors de l'inscription. Veuillez contacter votre administrateur. (${((l=(n=(r=u.error)==null?void 0:r.response)==null?void 0:n.data)==null?void 0:l.message)||u.error.message})`:"Erreur lors de l'inscription. Veuillez réessayer."))},[u.error,a,w]),i.useEffect(()=>{E||x.request()},[E,x]),i.useEffect(()=>{var r;p.data&&(te.dispatch(ie(p.data)),j(((r=location.state)==null?void 0:r.path)||"/chatflows"))},[p.data,j]),i.useEffect(()=>{var r,n,l,t;p.error&&(((n=(r=p.error)==null?void 0:r.response)==null?void 0:n.status)===401&&((t=(l=p.error)==null?void 0:l.response)!=null&&t.data.redirectUrl)?window.location.href=p.error.response.data.redirectUrl:m(p.error.message))},[p.error]),i.useEffect(()=>{x.data&&x.data.providers&&Y(x.data.providers.map(r=>r))},[x.data]),i.useEffect(()=>{u.data&&(console.log("Registration successful:",u.data),h(!1),m(void 0),P({username:"",email:"",password:"",confirmPassword:"",token:"",acceptTerms:!1}),F(a?"Inscription réussie. Vous allez être redirigé vers la page de connexion dans quelques instants.":w?"Pour finaliser votre inscription, veuillez cliquer sur le lien de vérification que nous avons envoyé à votre adresse e-mail.":"Inscription réussie. Vous allez être redirigé vers la page de connexion dans quelques instants."),setTimeout(()=>{j("/login2")},3e3))},[u.data,a,w,j]),e.jsxs(e.Fragment,{children:[e.jsx(d,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f3f4f6",overflow:"hidden",margin:0,padding:0,boxSizing:"border-box"},children:e.jsxs(ne,{maxWidth:"md",sx:{width:"100%",maxWidth:"600px",border:"none",boxShadow:"none",backgroundColor:"transparent",margin:0,padding:0},children:[e.jsxs(d,{sx:{textAlign:"center",mb:4},children:[e.jsx(d,{sx:{mb:3},children:e.jsx("img",{alt:"Netmob",src:ae,style:{height:"60px",width:"auto",margin:"0 auto",objectFit:"contain"}})}),e.jsx(c,{variant:"h4",sx:{fontWeight:"bold",color:"#111827",mb:0},children:"Créer un compte"})]}),I&&e.jsx(D,{icon:e.jsx(xe,{}),variant:"filled",severity:"error",sx:{mb:2,borderRadius:1},children:I}),W&&e.jsx(D,{icon:e.jsx(ge,{}),variant:"filled",severity:"success",sx:{mb:2,borderRadius:1},children:W}),e.jsxs(le,{elevation:1,sx:{p:4,borderRadius:2,backgroundColor:"white",width:"100%",maxWidth:"100%",boxSizing:"border-box",overflow:"hidden",margin:0},children:[e.jsxs("form",{onSubmit:K,children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(c,{component:"label",htmlFor:"username",sx:{display:"block",fontSize:"0.875rem",fontWeight:500,color:"#111827",mb:1},children:"Nom complet"}),e.jsx(C,{id:"username",name:"username",type:"text",required:!0,fullWidth:!0,placeholder:"Jean Dupont",value:s.username,onChange:g,error:!!o.username,helperText:o.username,sx:{"& .MuiOutlinedInput-root":{borderRadius:1,backgroundColor:"white","& fieldset":{borderColor:o.username?"#EF4444":"#d1d5db"},"&:hover fieldset":{borderColor:o.username?"#EF4444":"#9ca3af"},"&.Mui-focused fieldset":{borderColor:o.username?"#EF4444":"#4f46e5",borderWidth:2}},"& .MuiFormHelperText-root":{color:"#EF4444",fontSize:"0.75rem",marginTop:.5},"& .MuiInputBase-input":{py:1.5,px:1.5,fontSize:"0.875rem",color:"#111827"}}})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(c,{component:"label",htmlFor:"email",sx:{display:"block",fontSize:"0.875rem",fontWeight:500,color:"#111827",mb:1},children:"Adresse e-mail"}),e.jsx(C,{id:"email",name:"email",type:"text",required:!0,fullWidth:!0,autoComplete:"email",placeholder:"jean@exemple.com",value:s.email,onChange:g,error:!!o.email,helperText:o.email,sx:{"& .MuiOutlinedInput-root":{borderRadius:1,backgroundColor:"white","& fieldset":{borderColor:o.email?"#EF4444":"#d1d5db"},"&:hover fieldset":{borderColor:o.email?"#EF4444":"#9ca3af"},"&.Mui-focused fieldset":{borderColor:o.email?"#EF4444":"#4f46e5",borderWidth:2}},"& .MuiFormHelperText-root":{color:"#EF4444",fontSize:"0.75rem",marginTop:.5},"& .MuiInputBase-input":{py:1.5,px:1.5,fontSize:"0.875rem",color:"#111827"}}})]}),a&&e.jsxs(d,{sx:{mb:3},children:[e.jsx(c,{component:"label",htmlFor:"token",sx:{display:"block",fontSize:"0.875rem",fontWeight:500,color:"#111827",mb:1},children:"Code d'invitation"}),e.jsx(C,{id:"token",name:"token",type:"text",required:!0,fullWidth:!0,placeholder:"Collez le code d'invitation",value:s.token,onChange:g,error:!!o.token,helperText:o.token,sx:{"& .MuiOutlinedInput-root":{borderRadius:1,backgroundColor:"white","& fieldset":{borderColor:o.token?"#EF4444":"#d1d5db"},"&:hover fieldset":{borderColor:o.token?"#EF4444":"#9ca3af"},"&.Mui-focused fieldset":{borderColor:o.token?"#EF4444":"#4f46e5",borderWidth:2}},"& .MuiFormHelperText-root":{color:"#EF4444",fontSize:"0.75rem",marginTop:.5},"& .MuiInputBase-input":{py:1.5,px:1.5,fontSize:"0.875rem",color:"#111827"}}})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(c,{component:"label",htmlFor:"password",sx:{display:"block",fontSize:"0.875rem",fontWeight:500,color:"#111827",mb:1},children:"Mot de passe"}),e.jsx(C,{id:"password",name:"password",type:S?"text":"password",required:!0,fullWidth:!0,autoComplete:"new-password",placeholder:"••••••••",value:s.password,onChange:g,error:!!o.password,helperText:o.password,InputProps:{endAdornment:e.jsx(H,{position:"end",children:e.jsx(L,{"aria-label":"toggle password visibility",onClick:()=>J(!S),edge:"end",sx:{color:"#6b7280"},children:S?e.jsx(V,{size:20}):e.jsx(N,{size:20})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:1,backgroundColor:"white","& fieldset":{borderColor:o.password?"#EF4444":"#d1d5db"},"&:hover fieldset":{borderColor:o.password?"#EF4444":"#9ca3af"},"&.Mui-focused fieldset":{borderColor:o.password?"#EF4444":"#4f46e5",borderWidth:2}},"& .MuiFormHelperText-root":{color:"#EF4444",fontSize:"0.75rem",marginTop:.5},"& .MuiInputBase-input":{py:1.5,px:1.5,fontSize:"0.875rem",color:"#111827"}}})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(c,{component:"label",htmlFor:"confirmPassword",sx:{display:"block",fontSize:"0.875rem",fontWeight:500,color:"#111827",mb:1},children:"Confirmer le mot de passe"}),e.jsx(C,{id:"confirmPassword",name:"confirmPassword",type:k?"text":"password",required:!0,fullWidth:!0,autoComplete:"new-password",placeholder:"••••••••",value:s.confirmPassword,onChange:g,error:!!o.confirmPassword,helperText:o.confirmPassword,InputProps:{endAdornment:e.jsx(H,{position:"end",children:e.jsx(L,{"aria-label":"toggle confirm password visibility",onClick:()=>X(!k),edge:"end",sx:{color:"#6b7280"},children:k?e.jsx(V,{size:20}):e.jsx(N,{size:20})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:1,backgroundColor:"white","& fieldset":{borderColor:o.confirmPassword?"#EF4444":"#d1d5db"},"&:hover fieldset":{borderColor:o.confirmPassword?"#EF4444":"#9ca3af"},"&.Mui-focused fieldset":{borderColor:o.confirmPassword?"#EF4444":"#4f46e5",borderWidth:2}},"& .MuiFormHelperText-root":{color:"#EF4444",fontSize:"0.75rem",marginTop:.5},"& .MuiInputBase-input":{py:1.5,px:1.5,fontSize:"0.875rem",color:"#111827"}}})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(de,{control:e.jsx(ce,{name:"acceptTerms",checked:s.acceptTerms,onChange:g,sx:{color:o.acceptTerms?"#EF4444":"#4f46e5","&.Mui-checked":{color:o.acceptTerms?"#EF4444":"#4f46e5"}}}),label:e.jsxs(c,{sx:{fontSize:"0.875rem",color:"#111827"},children:["J'accepte les"," ",e.jsx(R,{href:"#",sx:{color:"#4f46e5",textDecoration:"none","&:hover":{color:"#4338ca"}},children:"conditions d'utilisation"})]})}),o.acceptTerms&&e.jsx(c,{sx:{color:"#EF4444",fontSize:"0.75rem",marginTop:.5,marginLeft:4},children:o.acceptTerms})]}),e.jsx(B,{type:"submit",fullWidth:!0,variant:"contained",sx:{py:2,mb:3,borderRadius:1,backgroundColor:"#4f46e5",fontSize:"0.875rem",fontWeight:600,textTransform:"none",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)","&:hover":{backgroundColor:"#4338ca"},"&:focus":{outline:"2px solid #4f46e5",outlineOffset:"2px"},"&:disabled":{backgroundColor:"#9ca3af",color:"#6b7280"}},children:"Créer un compte"})]}),z.length>0&&e.jsx(d,{sx:{my:3},children:e.jsx(me,{sx:{position:"relative"},children:e.jsx(c,{sx:{position:"absolute",left:"50%",transform:"translateX(-50%)",backgroundColor:"white",px:2,fontSize:"0.875rem",fontWeight:500,color:"#111827",whiteSpace:"nowrap"},children:"Ou continuer avec"})})}),z.length>0&&e.jsx(O,{container:!0,spacing:2,children:z.map(r=>e.jsx(O,{item:!0,xs:6,children:e.jsxs(B,{fullWidth:!0,variant:"outlined",onClick:()=>Q(r),sx:{py:1.5,borderRadius:1,borderColor:"#d1d5db",backgroundColor:"white",color:"#111827",fontSize:"0.875rem",fontWeight:600,textTransform:"none",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)","&:hover":{backgroundColor:"#f9fafb",borderColor:"#9ca3af"}},children:[r==="google"&&"Google",r==="azure"&&"Microsoft",r==="auth0"&&"Auth0",r==="github"&&"GitHub"]})},r))})]}),e.jsx(d,{sx:{textAlign:"center",mt:3},children:e.jsxs(c,{sx:{fontSize:"0.875rem",color:"#6b7280"},children:["Vous avez déjà un compte ?"," ",e.jsx(R,{component:ue,to:"/login2",sx:{fontWeight:600,color:"#4f46e5",textDecoration:"none","&:hover":{color:"#4338ca"}},children:"Se connecter"})]})})]})}),M&&e.jsx(pe,{open:M})]})};export{Ae as default};
