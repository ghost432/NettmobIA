import{s as Z,t as J,r as i,v as ge,H as z,j as e,D as K,m as ee,aw as ae,n as te,B,o as H,a5 as O,p as ve,aa as ye,w as se,q as v,i as A,L as ie,N as re,P as g,a as De,f as we,b as Ve,c as Ce,M as Se,S as U,e as Te,Q as Ae,R as Ie,U as ke,V as Ee,W as le,y as ne,a7 as u,X as Be,C as Ne,Z as q,h as Q,_ as Re,$ as X}from"./index-B5bgjFPS.js";import{C as oe,u as Me}from"./ConfirmDialog-Dfe34hOz.js";import{v as N,r as Le}from"./suggestionOption-DCQ-1oAJ.js";import{D as Pe}from"./Dropdown-D8Rr64ju.js";import{C as $}from"./CodeEditor-BbQJOBPh.js";import{V as _e}from"./ViewHeader-t5dVj9Vk.js";import{E as Fe}from"./ErrorBoundary-x4bZaoHs.js";import{D as He,T as $e}from"./TablePagination-DXVFzOgw.js";import{I as Ge}from"./IconPlus-j8jP5X4Z.js";import{S as o}from"./Skeleton-DJP3nnUt.js";import{I as Ye}from"./IconSearch-4bUU90FL.js";import{I as We}from"./IconTrash-CekgWF9B.js";import"./index-C-cusT-F.js";import"./ListItem-BfStHUI0.js";import"./FormControl-o0rphY-g.js";import"./Autocomplete-CinIIKT5.js";import"./Close-DT9tpzn1.js";import"./TextField-OmGdqrIf.js";import"./InputLabel-BtU13bbu.js";import"./StyledFab-DFomU4Vk.js";import"./IconCopy-bbAsun7S.js";import"./Pagination-BU6C4W3P.js";import"./LastPage--XaxDP-k.js";const ze=[{label:"Static",name:"static",description:"Variable value will be read from the value entered below"},{label:"Runtime",name:"runtime",description:"Variable value will be read from .env file"}],ce=({show:r,dialogProps:l,onCancel:p,onConfirm:j,setError:y})=>{const k=document.getElementById("portal"),h=Z();J();const b=(...s)=>h(ie(...s)),D=(...s)=>h(re(...s)),[w,x]=i.useState(""),[V,f]=i.useState(""),[d,C]=i.useState("static"),[R,S]=i.useState("ADD"),[M,c]=i.useState({});i.useEffect(()=>(l.type==="EDIT"&&l.data?(x(l.data.name),f(l.data.value),C(l.data.type),S("EDIT"),c(l.data)):l.type==="ADD"&&(x(""),f(""),C("static"),S("ADD"),c({})),()=>{x(""),f(""),C("static"),S("ADD"),c({})}),[l]),i.useEffect(()=>(h(r?{type:ge}:{type:z}),()=>h({type:z})),[r,h]);const L=async()=>{try{const s={name:w,value:V,type:d},n=await N.createVariable(s);n.data&&(b({message:"New Variable added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:I=>e.jsx(v,{style:{color:"white"},onClick:()=>D(I),children:e.jsx(A,{})})}}),j(n.data.id))}catch(s){y&&y(s),b({message:`Failed to add new Variable: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:n=>e.jsx(v,{style:{color:"white"},onClick:()=>D(n),children:e.jsx(A,{})})}}),p()}},P=async()=>{try{const s={name:w,value:V,type:d},n=await N.updateVariable(M.id,s);n.data&&(b({message:"Variable saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:I=>e.jsx(v,{style:{color:"white"},onClick:()=>D(I),children:e.jsx(A,{})})}}),j(n.data.id))}catch(s){y&&y(s),b({message:`Failed to save Variable: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:n=>e.jsx(v,{style:{color:"white"},onClick:()=>D(n),children:e.jsx(A,{})})}}),p()}},T=r?e.jsxs(K,{fullWidth:!0,maxWidth:"sm",open:r,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ee,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(ae,{style:{marginRight:"10px"}}),l.type==="ADD"?"Add Variable":"Edit Variable"]})}),e.jsxs(te,{children:[e.jsxs(B,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(H,{children:["Variable Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(O,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,onChange:s=>x(s.target.value),value:w??"",id:"txtInput_variableName"},"variableName")]}),e.jsxs(B,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(H,{children:["Type",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(Pe,{name:"variableType",options:ze,onSelect:s=>C(s),value:d??"choose an option",id:"dropdown_variableType"},d)]}),d==="static"&&e.jsxs(B,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(H,{children:["Value",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(O,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,onChange:s=>f(s.target.value),value:V??"",id:"txtInput_variableValue"},"variableValue")]})]}),e.jsx(ve,{children:e.jsx(ye,{disabled:!w||!d||d==="static"&&!V,variant:"contained",onClick:()=>R==="ADD"?L():P(),id:"btn_confirmAddingNewVariable",children:l.confirmButtonName})}),e.jsx(oe,{})]}):null;return se.createPortal(T,k)};ce.propTypes={show:g.bool,dialogProps:g.object,onCancel:g.func,onConfirm:g.func,setError:g.func};const Oe=`{
    overrideConfig: {
        vars: {
            var1: 'abc'
        }
    }
}`,de=({show:r,onCancel:l})=>{const p=document.getElementById("portal"),j=r?e.jsxs(K,{onClose:l,open:r,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ee,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"How To Use Variables"}),e.jsxs(te,{children:[e.jsx("p",{style:{marginBottom:"10px"},children:"Variables can be used in Custom Tool, Custom Function, Custom Loader, If Else Function with the $ prefix."}),e.jsx($,{disabled:!0,value:"$vars.<variable-name>",height:"50px",theme:"dark",lang:"js",basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1}}),e.jsx("p",{style:{marginBottom:"10px"},children:"Variables can also be used in Text Field parameter of any node. For example, in System Message of Agent:"}),e.jsx($,{disabled:!0,value:"You are a {{$vars.personality}} AI assistant",height:"50px",theme:"dark",lang:"js",basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1}}),e.jsx("p",{style:{marginBottom:"10px"},children:"If variable type is Static, the value will be retrieved as it is. If variable type is Runtime, the value will be retrieved from .env file."}),e.jsxs("p",{style:{marginBottom:"10px"},children:["You can also override variable values in API overrideConfig using ",e.jsx("b",{children:"vars"}),":"]}),e.jsx($,{disabled:!0,value:Oe,height:"170px",theme:"dark",lang:"js",basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1}}),e.jsxs("p",{children:["Read more from"," ",e.jsx("a",{target:"_blank",rel:"noreferrer",href:"https://docs.flowiseai.com/using-flowise/variables",children:"docs"})]})]})]}):null;return se.createPortal(j,p)};de.propTypes={show:g.bool,onCancel:g.func};const Ue="/assets/variables_empty-BRQPFrO4.svg",t=ne(Re)(({theme:r})=>({borderColor:r.palette.grey[900]+25,[`&.${X.head}`]:{color:r.palette.grey[900]},[`&.${X.body}`]:{fontSize:14,height:64}})),G=ne(le)(()=>({"&:last-child td, &:last-child th":{border:0}})),ba=()=>{const r=De(),l=we(a=>a.customization),p=Z();J();const{error:j,setError:y}=Ve(),k=(...a)=>p(ie(...a)),h=(...a)=>p(re(...a)),[b,D]=i.useState(!0),[w,x]=i.useState(!1),[V,f]=i.useState({}),[d,C]=i.useState([]),[R,S]=i.useState(!1),{confirm:M}=Me(),c=Ce(N.getAllVariables),[L,P]=i.useState(""),[T,s]=i.useState(1),[n,I]=i.useState(He),[he,xe]=i.useState(0),me=(a,m)=>{s(a),I(m),_(a,m)},_=(a,m)=>{const W={page:a||T,limit:m||n};c.request(W)},pe=a=>{P(a.target.value)};function ue(a){return a.name.toLowerCase().indexOf(L.toLowerCase())>-1}const je=()=>{f({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",customBtnId:"btn_confirmAddingVariable",data:{}}),x(!0)},be=a=>{f({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",data:a}),x(!0)},fe=async a=>{const m={title:"Delete",description:`Delete variable ${a.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await M(m))try{(await N.deleteVariable(a.id)).data&&(k({message:"Variable deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:F=>e.jsx(v,{style:{color:"white"},onClick:()=>h(F),children:e.jsx(A,{})})}}),Y())}catch(E){k({message:`Failed to delete Variable: ${typeof E.response.data=="object"?E.response.data.message:E.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:F=>e.jsx(v,{style:{color:"white"},onClick:()=>h(F),children:e.jsx(A,{})})}})}},Y=()=>{x(!1),_(T,n),Le()};return i.useEffect(()=>{_(T,n)},[]),i.useEffect(()=>{D(c.loading)},[c.loading]),i.useEffect(()=>{c.data&&(C(c.data.data),xe(c.data.total))},[c.data]),e.jsxs(e.Fragment,{children:[e.jsx(Se,{children:j?e.jsx(Fe,{error:j}):e.jsxs(U,{flexDirection:"column",sx:{gap:3},children:[e.jsxs(_e,{onSearchChange:pe,search:!0,searchPlaceholder:"Search Variables",title:"Variables",description:"Create and manage global variables",children:[e.jsx(v,{variant:"outlined",sx:{borderRadius:2,height:"100%"},onClick:()=>S(!0),children:"How To Use"}),e.jsx(Te,{permissionId:"variables:create",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:je,startIcon:e.jsx(Ge,{}),id:"btn_createVariable",children:"Add Variable"})]}),!b&&d.length===0?e.jsxs(U,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(B,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:Ue,alt:"VariablesEmptySVG"})}),e.jsx("div",{children:"No Variables Yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{sx:{border:1,borderColor:r.palette.grey[900]+25,borderRadius:2},component:Ie,children:e.jsxs(ke,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Ee,{sx:{backgroundColor:l.isDarkMode?r.palette.common.black:r.palette.grey[100],height:56},children:e.jsxs(le,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Value"}),e.jsx(t,{children:"Type"}),e.jsx(t,{children:"Last Updated"}),e.jsx(t,{children:"Created"}),e.jsx(u,{permissionId:"variables:update",children:e.jsx(t,{children:" "})}),e.jsx(u,{permissionId:"variables:delete",children:e.jsx(t,{children:" "})})]})}),e.jsx(Be,{children:b?e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(u,{permission:"variables:create,variables:update",children:e.jsx(t,{children:e.jsx(o,{variant:"text"})})}),e.jsx(u,{permission:"variables:delete",children:e.jsx(t,{children:e.jsx(o,{variant:"text"})})})]}),e.jsxs(G,{children:[e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(t,{children:e.jsx(o,{variant:"text"})}),e.jsx(u,{permission:"variables:create,variables:update",children:e.jsx(t,{children:e.jsx(o,{variant:"text"})})}),e.jsx(u,{permission:"variables:delete",children:e.jsx(t,{children:e.jsx(o,{variant:"text"})})})]})]}):e.jsx(e.Fragment,{children:d.filter(ue).map((a,m)=>e.jsxs(G,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{component:"th",scope:"row",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:25,height:25,marginRight:10,borderRadius:"50%"},children:e.jsx(ae,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain"}})}),a.name]})}),e.jsx(t,{children:a.value}),e.jsx(t,{children:e.jsx(Ne,{color:a.type==="static"?"info":"secondary",size:"small",label:a.type})}),e.jsx(t,{children:q(a.updatedDate).format("MMMM Do, YYYY HH:mm:ss")}),e.jsx(t,{children:q(a.createdDate).format("MMMM Do, YYYY HH:mm:ss")}),e.jsx(u,{permission:"variables:create,variables:update",children:e.jsx(t,{children:e.jsx(Q,{title:"Edit",color:"primary",onClick:()=>be(a),children:e.jsx(Ye,{})})})}),e.jsx(u,{permission:"variables:delete",children:e.jsx(t,{children:e.jsx(Q,{title:"Delete",color:"error",onClick:()=>fe(a),children:e.jsx(We,{})})})})]},m))})})]})}),e.jsx($e,{currentPage:T,limit:n,total:he,onChange:me})]})]})}),e.jsx(ce,{show:w,dialogProps:V,onCancel:()=>x(!1),onConfirm:Y,setError:y}),e.jsx(de,{show:R,onCancel:()=>S(!1)}),e.jsx(oe,{})]})};export{ba as default};
