import{a as ie,f as ce,r as l,j as e,Q as De,R as Se,U as Ie,V as Ee,W as de,y as ue,a3 as ae,X as be,B as Z,Z as se,_ as ye,$ as ne,P as O,c as W,aq as re,M as Ce,S as U,aj as I,a1 as Te,a2 as E,q as $,a7 as ve,h as ke,D as we,m as Ne,n as Oe,p as Me}from"./index-B5bgjFPS.js";import{e as le}from"./react-datepicker-B1KQuNsR.js";import{E as Ae}from"./ErrorBoundary-x4bZaoHs.js";import{V as Pe}from"./ViewHeader-t5dVj9Vk.js";import{d as Re,a as Fe,e as H}from"./NodeExecutionDetails-DG6IJuTk.js";import{d as ze,I as $e}from"./StopCircle-Dr72dSBy.js";import{T as G}from"./TableSortLabel-jpzZZy1Y.js";import{S as p}from"./Skeleton-DJP3nnUt.js";import{I as qe}from"./IconCircleXFilled-6uNExu9P.js";import{E as Be}from"./ExecutionDetails-B4nB6XtJ.js";import{D as oe,T as Le}from"./TablePagination-DXVFzOgw.js";import{F as _e}from"./FormControl-o0rphY-g.js";import{I as Ye}from"./InputLabel-BtU13bbu.js";import{T as q}from"./TextField-OmGdqrIf.js";import{T as We}from"./Tooltip-CXmeiPEa.js";import{I as Ue}from"./IconTrash-CekgWF9B.js";import{D as He}from"./DialogContentText-BpMKEgw2.js";import"./toPropertyKey-C9c9JG92.js";import"./unsupportedIterableToArray-Bh0GkvIo.js";import"./IconCopy-bbAsun7S.js";import"./StyledFab-DFomU4Vk.js";import"./IconSearch-4bUU90FL.js";import"./createStyled-DlEbU-rO.js";import"./MemoizedReactMarkdown-mGWPD7hJ.js";import"./index-D--Rb2MU.js";import"./SourceDocDialog-U52onwWn.js";import"./main-Dw2W3SKo.js";import"./CodeEditor-BbQJOBPh.js";import"./index-C-cusT-F.js";import"./IconClock-Be61hWTr.js";import"./ToggleButtonGroup-RXBzXyLf.js";import"./IconShare-D3uBFiqr.js";import"./IconRefresh-CtZoTUkg.js";import"./Pagination-BU6C4W3P.js";import"./LastPage--XaxDP-k.js";const Ge="/assets/executions_empty-DFi9-LFe.svg",r=ue(ye)(({theme:c})=>({borderColor:c.palette.grey[900]+25,[`&.${ne.head}`]:{color:c.palette.grey[900]},[`&.${ne.body}`]:{fontSize:14,height:64}})),V=ue(de)(()=>({"&:last-child td, &:last-child th":{border:0}})),Ve=(c,b)=>{switch(c){case"FINISHED":return Fe;case"ERROR":case"TIMEOUT":return Re;case"TERMINATED":return d=>{const n=x=>e.jsx(qe,{...x,color:b.palette.error.main});return n.displayName="TerminatedIcon",e.jsx(n,{...d})};case"STOPPED":return ze;case"INPROGRESS":return d=>{const n=x=>e.jsx($e,{...x,color:b.palette.warning.dark,className:`spin-animation ${x.className||""}`});return n.displayName="InProgressIcon",e.jsx(n,{...d})}}},Ze=c=>{switch(c){case"FINISHED":return"success.dark";case"ERROR":case"TIMEOUT":return"error.main";case"TERMINATED":case"STOPPED":return"error.main";case"INPROGRESS":return"warning.main"}},J=({data:c,isLoading:b,onExecutionRowClick:d,onSelectionChange:n})=>{const x=ie(),y=ce(s=>s.customization),T="executions_order",M="executions_orderBy",[g,A]=l.useState(localStorage.getItem(T)||"desc"),[m,B]=l.useState(localStorage.getItem(M)||"updatedDate"),[h,j]=l.useState([]),v=s=>{const o=m===s&&g==="asc"?"desc":"asc";A(o),B(s),localStorage.setItem(T,o),localStorage.setItem(M,s)},P=s=>{if(s.target.checked){const i=c.map(o=>o.id);j(i),n&&n(i)}else j([]),n&&n([])},R=(s,i)=>{s.stopPropagation();const o=h.indexOf(i);let a=[];o===-1?a=a.concat(h,i):o===0?a=a.concat(h.slice(1)):o===h.length-1?a=a.concat(h.slice(0,-1)):o>0&&(a=a.concat(h.slice(0,o),h.slice(o+1))),j(a),n&&n(a)},F=s=>h.indexOf(s)!==-1,f=c?[...c].sort((s,i)=>m==="name"?g==="asc"?(s.name||"").localeCompare(i.name||""):(i.name||"").localeCompare(s.name||""):m==="updatedDate"?g==="asc"?new Date(s.updatedDate)-new Date(i.updatedDate):new Date(i.updatedDate)-new Date(s.updatedDate):0):[];return e.jsx(e.Fragment,{children:e.jsx(De,{sx:{border:1,borderColor:x.palette.grey[900]+25,borderRadius:2},component:Se,children:e.jsxs(Ie,{sx:{minWidth:650},size:"small","aria-label":"a dense table",children:[e.jsx(Ee,{sx:{backgroundColor:y.isDarkMode?x.palette.common.black:x.palette.grey[100],height:56},children:e.jsxs(de,{children:[e.jsx(r,{padding:"checkbox",children:e.jsx(ae,{color:"primary",indeterminate:h.length>0&&h.length<c.length,checked:c.length>0&&h.length===c.length,onChange:P,inputProps:{"aria-label":"select all executions"}})}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:e.jsx(G,{active:m==="updatedDate",direction:g,onClick:()=>v("updatedDate"),children:"Last Updated"})}),e.jsx(r,{component:"th",scope:"row",children:e.jsx(G,{active:m==="name",direction:g,onClick:()=>v("name"),children:"Agentflow"})}),e.jsx(r,{children:"Session"}),e.jsx(r,{children:e.jsx(G,{active:m==="createdDate",direction:g,onClick:()=>v("createdDate"),children:"Created"})})]})}),e.jsx(be,{children:b?e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(r,{padding:"checkbox",children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})})]}),e.jsxs(V,{children:[e.jsx(r,{padding:"checkbox",children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:f.map((s,i)=>{var C;const o=F(s.id),a=`enhanced-table-checkbox-${i}`;return e.jsxs(V,{hover:!0,sx:{cursor:"pointer","&:last-child td, &:last-child th":{border:0}},children:[e.jsx(r,{padding:"checkbox",children:e.jsx(ae,{color:"primary",checked:o,onClick:k=>R(k,s.id),inputProps:{"aria-labelledby":a}})}),e.jsx(r,{onClick:()=>d(s),children:e.jsx(Z,{component:Ve(s.state,x),className:"labelIcon",color:Ze(s.state)})}),e.jsx(r,{onClick:()=>d(s),children:se(s.updatedDate).format("MMM D, YYYY h:mm A")}),e.jsx(r,{onClick:()=>d(s),children:(C=s.agentflow)==null?void 0:C.name}),e.jsx(r,{onClick:()=>d(s),children:s.sessionId}),e.jsx(r,{onClick:()=>d(s),children:se(s.createdDate).format("MMM D, YYYY h:mm A")})]},i)})})})]})})})};J.propTypes={data:O.array,isLoading:O.bool,onExecutionRowClick:O.func,onSelectionChange:O.func,className:O.string};J.displayName="ExecutionsListTable";const Mt=()=>{const c=ie(),b=ce(t=>t.customization),d=c.palette.grey[900]+25,n=W(H.getAllExecutions),x=W(H.deleteExecutions),y=W(H.getExecutionById),[T,M]=l.useState(null),[g,A]=l.useState(!0),[m,B]=l.useState([]),[h,j]=l.useState(!1),[v,P]=l.useState([]),[R,F]=l.useState({}),[f,s]=l.useState([]),[i,o]=l.useState(!1),[a,C]=l.useState({state:"",startDate:null,endDate:null,agentflowId:"",agentflowName:"",sessionId:""}),k=(t,u)=>{C({...a,[t]:u})},K=(t,u)=>{const N=new Date(u);N.setHours(0,0,0,0),C({...a,[t]:N})},[z,X]=l.useState(1),[w,xe]=l.useState(oe),[Q,me]=l.useState(0),he=(t,u)=>{X(t),xe(u),ee(t,u)},ee=(t,u)=>{A(!0);const D={page:typeof t=="number"?t:z,limit:typeof u=="number"?u:w};if(a.state&&(D.state=a.state),a.startDate){const S=new Date(a.startDate),L=S.getFullYear(),_=String(S.getMonth()+1).padStart(2,"0"),Y=String(S.getDate()).padStart(2,"0");D.startDate=`${L}-${_}-${Y}T00:00:00.000Z`}if(a.endDate){const S=new Date(a.endDate),L=S.getFullYear(),_=String(S.getMonth()+1).padStart(2,"0"),Y=String(S.getDate()).padStart(2,"0");D.endDate=`${L}-${_}-${Y}T23:59:59.999Z`}a.agentflowId&&(D.agentflowId=a.agentflowId),a.agentflowName&&(D.agentflowName=a.agentflowName),a.sessionId&&(D.sessionId=a.sessionId),n.request(D)},pe=()=>{C({state:"",startDate:null,endDate:null,agentflowId:"",agentflowName:"",sessionId:""}),X(1),n.request({page:1,limit:w})},ge=t=>{s(t)},je=()=>{f.length>0&&o(!0)},te=()=>{o(!1)},fe=()=>{x.request(f),o(!1)};return l.useEffect(()=>{n.request({page:1,limit:oe})},[]),l.useEffect(()=>{if(n.data)try{const{data:t,total:u}=n.data;if(!Array.isArray(t))return;B(t),me(u)}catch(t){console.error(t)}},[n.data]),l.useEffect(()=>{A(n.loading)},[n.loading]),l.useEffect(()=>{M(n.error)},[n.error]),l.useEffect(()=>{x.data&&(n.request({page:z,limit:w}),s([]))},[x.data]),l.useEffect(()=>{if(y.data){const t=y.data,u=typeof t.executionData=="string"?JSON.parse(t.executionData):t.executionData;P(u);const N={...re.omit(t,["executionData"]),agentflow:{...R.agentflow}};F(N)}},[y.data]),e.jsx(Ce,{children:T?e.jsx(Ae,{error:T}):e.jsxs(U,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Pe,{title:"Agent Executions",description:"Monitor and manage agentflows executions"}),e.jsx(Z,{sx:{mb:2,width:"100%"},children:e.jsxs(I,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(I,{item:!0,xs:12,md:2,children:e.jsxs(_e,{fullWidth:!0,size:"small",children:[e.jsx(Ye,{id:"state-select-label",children:"State"}),e.jsxs(Te,{labelId:"state-select-label",value:a.state,label:"State",onChange:t=>k("state",t.target.value),size:"small",sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:d},"& .MuiSvgIcon-root":{color:b.isDarkMode?"#fff":"inherit"}},children:[e.jsx(E,{value:"",children:"All"}),e.jsx(E,{value:"INPROGRESS",children:"In Progress"}),e.jsx(E,{value:"FINISHED",children:"Finished"}),e.jsx(E,{value:"ERROR",children:"Error"}),e.jsx(E,{value:"TERMINATED",children:"Terminated"}),e.jsx(E,{value:"TIMEOUT",children:"Timeout"}),e.jsx(E,{value:"STOPPED",children:"Stopped"})]})]})}),e.jsx(I,{item:!0,xs:12,md:2,children:e.jsx(le,{selected:a.startDate,onChange:t=>K("startDate",t),selectsStart:!0,startDate:a.startDate,className:"form-control",wrapperClassName:"datePicker",maxDate:new Date,customInput:e.jsx(q,{size:"small",label:"Start date",fullWidth:!0,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:d}}})})}),e.jsx(I,{sx:{ml:-1},item:!0,xs:12,md:2,children:e.jsx(le,{selected:a.endDate,onChange:t=>K("endDate",t),selectsEnd:!0,endDate:a.endDate,className:"form-control",wrapperClassName:"datePicker",minDate:a.startDate,maxDate:new Date,customInput:e.jsx(q,{size:"small",label:"End date",fullWidth:!0,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:d}}})})}),e.jsx(I,{sx:{ml:-1},item:!0,xs:12,md:2,children:e.jsx(q,{fullWidth:!0,label:"Agentflow",value:a.agentflowName,onChange:t=>k("agentflowName",t.target.value),size:"small",sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:d}}})}),e.jsx(I,{sx:{ml:-1},item:!0,xs:12,md:2,children:e.jsx(q,{fullWidth:!0,label:"Session ID",value:a.sessionId,onChange:t=>k("sessionId",t.target.value),size:"small",sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:d}}})}),e.jsx(I,{item:!0,xs:12,md:2,children:e.jsxs(U,{direction:"row",spacing:1,children:[e.jsx($,{variant:"contained",color:"primary",onClick:()=>ee(z,w),size:"small",children:"Apply"}),e.jsx($,{variant:"outlined",onClick:pe,size:"small",children:"Reset"}),e.jsx(ve,{permissions:["executions:delete"],children:e.jsx(We,{title:"Delete selected executions",children:e.jsx("span",{children:e.jsx(ke,{sx:{height:30,width:30},size:"small",color:"error",onClick:je,edge:"end",disabled:f.length===0,children:e.jsx(Ue,{})})})})})]})})]})}),(m==null?void 0:m.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(J,{data:m,isLoading:g,onSelectionChange:ge,onExecutionRowClick:t=>{j(!0);const u=typeof t.executionData=="string"?JSON.parse(t.executionData):t.executionData;P(u),F(re.omit(t,["executionData"]))}}),!g&&Q>0&&e.jsx(Le,{currentPage:z,limit:w,total:Q,onChange:he}),e.jsx(Be,{open:h,execution:v,metadata:R,onClose:()=>j(!1),onProceedSuccess:()=>{j(!1),n.request()},onUpdateSharing:()=>{n.request()},onRefresh:t=>{n.request(),y.request(t)}})]}),e.jsxs(we,{open:i,onClose:te,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ne,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(Oe,{children:e.jsxs(He,{id:"alert-dialog-description",children:["Are you sure you want to delete ",f.length," execution",f.length!==1?"s":"","? This action cannot be undone."]})}),e.jsxs(Me,{children:[e.jsx($,{onClick:te,color:"primary",children:"Cancel"}),e.jsx($,{onClick:fe,color:"error",children:"Delete"})]})]}),!g&&(!m||m.length===0)&&e.jsxs(U,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(Z,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:Ge,alt:"execution_empty"})}),e.jsx("div",{children:"No Executions Yet"})]})]})})};export{Mt as default};
